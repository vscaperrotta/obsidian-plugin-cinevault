/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => CineVaultPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian7 = require("obsidian");

// src/constants.ts
var VIEW_TYPE = "CineVaultView";

// src/views/CineVaultView.ts
var import_obsidian5 = require("obsidian");

// src/ui/onboarding.ts
function renderOnboarding(container, onCreate, onLink) {
  const onboarding = container.createDiv({
    cls: "cinevault-onboarding"
  });
  const actions = onboarding.createDiv({ cls: "cinevault-onboarding-actions" });
  const createButton = actions.createEl("button", { text: "Create new library" });
  if (onLink) {
    actions.createEl("p", { text: "or" });
    const linkButton = actions.createEl("button", { text: "Link existing library" });
    linkButton.addEventListener("click", () => {
      onLink();
    });
  }
  createButton.addEventListener("click", () => {
    onCreate();
  });
}

// src/ui/modals/CineVaultMovieActionModal.ts
var import_obsidian = require("obsidian");
var CineVaultMovieActionModal = class extends import_obsidian.Modal {
  constructor(app, movie, onSave) {
    super(app);
    this.movie = movie;
    this.onSave = onSave;
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.createEl("h3", { text: this.movie.title });
    contentEl.createEl("p", { text: `${this.movie.year} \u2022 ${this.movie.type}` });
    if (this.movie.poster) {
      contentEl.createEl("img", { cls: "cinevault-modal-poster" }).setAttribute("src", this.movie.poster);
    }
    contentEl.createEl("p", { text: this.movie.plot });
    const actions = contentEl.createDiv({ cls: "cinevault-modal-actions" });
    const watchedButton = actions.createEl("button", { text: "Mark as watched" });
    const toWatchButton = actions.createEl("button", { text: "To watch" });
    watchedButton.addEventListener("click", () => {
      this.onSave(true);
      this.close();
    });
    toWatchButton.addEventListener("click", () => {
      this.onSave(false);
      this.close();
    });
  }
};

// src/ui/modals/CineVaultMovieDetailModal.ts
var import_obsidian2 = require("obsidian");

// src/ui/starRating.ts
function createStarRating(container, rating, readOnly, onChange) {
  const stars = container.createDiv({ cls: "cinevault-stars" });
  const starElements = [];
  let currentRating = rating;
  for (let i = 1; i <= 5; i += 1) {
    const star = stars.createEl("span", { text: "\u2605", cls: "cinevault-star" });
    if (i <= rating)
      star.classList.add("active");
    starElements.push(star);
    if (!readOnly) {
      star.addEventListener("click", () => {
        if (currentRating === i) {
          currentRating = 0;
          starElements.forEach((element) => {
            element.classList.remove("active");
          });
        } else {
          currentRating = i;
          starElements.forEach((element, index) => {
            element.classList.toggle("active", index < i);
          });
        }
        onChange == null ? void 0 : onChange(currentRating);
      });
    } else {
      star.classList.add("readonly");
    }
  }
  return stars;
}

// src/utils.ts
function nullSafe(func, fallbackValue = null) {
  try {
    const value = func();
    return value === null || value === void 0 ? fallbackValue : value;
  } catch (e) {
    return fallbackValue;
  }
}

// src/ui/modals/CineVaultMovieDetailModal.ts
var CineVaultMovieDetailModal = class extends import_obsidian2.Modal {
  constructor(app, movie, onRate, onRemove, onToggleWatched) {
    super(app);
    this.movie = movie;
    this.onRate = onRate;
    this.onRemove = onRemove;
    this.onToggleWatched = onToggleWatched;
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    const modalContainer = contentEl.createDiv({
      cls: "cinevault-modal-container"
    });
    modalContainer.createEl("h1", {
      text: this.movie.title,
      cls: "cinevault-modal-title"
    });
    const type = nullSafe(() => this.movie.type[0].toUpperCase() + this.movie.type.slice(1), null);
    const year = nullSafe(() => this.movie.year, null);
    modalContainer.createEl("p", {
      text: `${year} - ${type}`
    });
    if (this.movie.poster) {
      modalContainer.createEl("img", { cls: "cinevault-modal-poster" }).setAttribute("src", this.movie.poster);
    }
    if (this.movie.plot) {
      const plotContainer = modalContainer.createEl("div", { cls: "cinevault-modal-plot-container" });
      const plotEl = plotContainer.createEl("p", {
        text: this.movie.plot,
        cls: "cinevault-modal-plot"
      });
      const showMoreButton = plotContainer.createEl("button", {
        text: "Show more",
        cls: "cinevault-modal-show-more"
      });
      showMoreButton.style.display = "none";
      showMoreButton.addEventListener("click", () => {
        const isExpanded = plotEl.classList.toggle("expanded-plot");
        showMoreButton.setText(isExpanded ? "Show less" : "Show more");
      });
      requestAnimationFrame(() => {
        if (plotEl.scrollHeight > plotEl.clientHeight + 1) {
          showMoreButton.style.display = "inline-block";
        }
      });
    }
    function rederDetailSection(type2, value) {
      const detailElement = modalContainer.createEl("div", { cls: "cinevault-modal-detail-container" });
      detailElement.createEl("p", {
        text: `${type2}:`,
        cls: "cinevault-modal-detail-label"
      });
      detailElement.createEl("p", {
        text: value,
        cls: "cinevault-modal-detail-value"
      });
    }
    modalContainer.createEl("hr");
    if (this.movie.genre) {
      rederDetailSection("Genre", this.movie.genre);
    }
    if (this.movie.director) {
      rederDetailSection("Director", this.movie.director);
    }
    if (this.movie.actors) {
      rederDetailSection("Actors", this.movie.actors);
    }
    modalContainer.createEl("hr");
    const ratingContainer = modalContainer.createDiv({
      cls: "cinevault-modal-rating-container"
    });
    ratingContainer.createEl("div", { text: "Rating", cls: "cinevault-modal-rating-label" });
    const stars = createStarRating(ratingContainer, this.movie.starRating, false, (rating) => {
      this.onRate(rating);
    });
    stars.classList.add("cinevault-modal-stars");
    if (this.movie.ratings) {
      const externalRatingsContainer = modalContainer.createDiv({
        cls: "cinevault-modal-external-ratings"
      });
      console.log("this.movie.ratings", this.movie.ratings);
      for (const rating of this.movie.ratings) {
        const ratingEl = externalRatingsContainer.createDiv({ cls: "cinevault-modal-external-rating-element" });
        ratingEl.createEl("div", { text: rating.Source, cls: "cinevault-modal-external-rating-source" });
        ratingEl.createEl("div", { text: rating.Value, cls: "cinevault-modal-external-rating-value" });
      }
    }
    const actions = modalContainer.createDiv({ cls: "cinevault-modal-actions" });
    const toggleWatchedLabel = this.movie.watched ? "Mark as to watch" : "Mark as watched";
    const toggleWatchedButton = actions.createEl("button", { text: toggleWatchedLabel });
    const removeButton = actions.createEl("button", { text: "Remove", cls: "cinevault-danger" });
    toggleWatchedButton.addEventListener("click", () => {
      this.onToggleWatched();
      this.close();
    });
    removeButton.addEventListener("click", () => {
      this.onRemove();
      this.close();
    });
  }
};

// src/ui/JsonFileSuggestModal.ts
var import_obsidian3 = require("obsidian");
var JsonFileSuggestModal = class extends import_obsidian3.SuggestModal {
  constructor(app, onSelect) {
    super(app);
    this.onSelect = onSelect;
    this.jsonFiles = this.app.vault.getFiles().filter((f) => f.extension === "json");
    this.setPlaceholder("Select a JSON file from your vault...");
  }
  getSuggestions(query) {
    const lowerQuery = query.toLowerCase();
    return this.jsonFiles.filter(
      (file) => file.path.toLowerCase().includes(lowerQuery)
    );
  }
  renderSuggestion(file, el) {
    el.createEl("div", { text: file.path });
  }
  onChooseSuggestion(file, evt) {
    this.onSelect(file);
  }
};

// src/services/libraryStorage.ts
var FOLDER = "cinevault-json";
var DEFAULT_NAME = "cinevault.json";
function getDefaultPath() {
  return `${FOLDER}/${DEFAULT_NAME}`;
}
function getFolder() {
  return FOLDER;
}
function createEmptyMovie() {
  return {
    id: crypto.randomUUID(),
    imdbId: "",
    title: "",
    year: "",
    rated: "",
    released: "",
    runtime: "",
    genre: "",
    director: "",
    writer: "",
    actors: "",
    plot: "",
    language: "",
    country: "",
    awards: "",
    poster: "",
    posterLocal: "",
    ratings: [],
    metascore: "",
    imdbRating: "",
    imdbVotes: "",
    type: "",
    dvd: "",
    boxOffice: "",
    production: "",
    website: "",
    totalSeasons: "",
    tomatoURL: "",
    tomatoMeter: "",
    tomatoImage: "",
    tomatoRating: "",
    tomatoReviews: "",
    tomatoFresh: "",
    tomatoRotten: "",
    tomatoConsensus: "",
    tomatoUserMeter: "",
    tomatoUserRating: "",
    tomatoUserReviews: "",
    starRating: 0,
    watched: false,
    notes: ""
  };
}
function createDefaultData() {
  const now = new Date().toISOString();
  return {
    schemaVersion: 1,
    createdAt: now,
    updatedAt: now,
    libraryName: "CineVault",
    owner: "",
    source: "CineVault",
    movies: []
  };
}
function normalizeData(data) {
  return {
    ...data,
    movies: data.movies.map((movie) => ({
      ...createEmptyMovie(),
      ...movie,
      year: movie.year ? String(movie.year) : "",
      starRating: typeof movie.starRating === "number" ? movie.starRating : 0
    }))
  };
}
async function ensureFolder(app) {
  if (!app.vault.getAbstractFileByPath(FOLDER)) {
    await app.vault.createFolder(FOLDER);
  }
}
async function createJsonFile(app) {
  await ensureFolder(app);
  const existing = app.vault.getAbstractFileByPath(getDefaultPath());
  const filename = existing ? `cinevault-${Date.now()}.json` : DEFAULT_NAME;
  const path = `${FOLDER}/${filename}`;
  return app.vault.create(path, JSON.stringify(createDefaultData(), null, 2));
}
async function loadLocalFile(app, file) {
  const raw = await app.vault.read(file);
  const parsed = JSON.parse(raw);
  if (!parsed || !Array.isArray(parsed.movies)) {
    throw new Error("Formato JSON non valido");
  }
  return normalizeData(parsed);
}
async function saveLocalData(app, file, data) {
  await app.vault.modify(file, JSON.stringify(data, null, 2));
}

// src/services/omdbService.ts
var import_obsidian4 = require("obsidian");
async function searchOmdb(query, apiKey) {
  if (!apiKey) {
    return [];
  }
  try {
    const url = `https://www.omdbapi.com/?apikey=${apiKey}&s=${encodeURIComponent(query)}`;
    const response = await (0, import_obsidian4.requestUrl)(url);
    const data = response.json;
    if (data == null ? void 0 : data.Search) {
      return data.Search.map((item) => ({
        imdbId: item.imdbID,
        title: item.Title,
        year: item.Year,
        type: item.Type,
        poster: item.Poster && item.Poster !== "N/A" ? item.Poster : "",
        plot: ""
      }));
    }
    return [];
  } catch (error) {
    console.error("Error searching OMDb:", error);
    return [];
  }
}
async function getOmdbDetails(imdbId, apiKey, depth = 0) {
  if (depth >= 3) {
    console.error(`Failed to fetch movie details after ${depth} attempts`);
    return null;
  }
  if (!apiKey) {
    return null;
  }
  try {
    const url = `https://www.omdbapi.com/?apikey=${apiKey}&i=${imdbId}&plot=full&tomatoes=true`;
    const response = await (0, import_obsidian4.requestUrl)(url);
    const data = response.json;
    if (data.Response !== "True") {
      console.error("OMDb API returned error response", data);
      return null;
    }
    return data;
  } catch (error) {
    console.error("Error fetching movie details, retrying...", error);
    return getOmdbDetails(imdbId, apiKey, depth + 1);
  }
}

// src/views/CineVaultView.ts
var CineVaultView = class extends import_obsidian5.ItemView {
  constructor(leaf, plugin) {
    super(leaf);
    this.file = null;
    this.data = null;
    this.activeTab = "toWatch";
    this.moviesContainer = null;
    this.viewMode = "grid";
    this.plugin = plugin;
  }
  getViewType() {
    return VIEW_TYPE;
  }
  getDisplayText() {
    return "CineVault";
  }
  // Provide a custom icon for the view's tab
  getIcon() {
    return "clapperboard";
  }
  async onOpen() {
    var _a;
    this.viewMode = (_a = this.plugin.viewMode) != null ? _a : "grid";
    await this.initializeData();
    await this.render();
  }
  async render() {
    const container = this.containerEl.children[1];
    container.empty();
    const header = container.createDiv({ cls: "cinevault-header" });
    header.createEl("h1", {
      text: "CineVault",
      cls: "cinevault-title"
    });
    header.createEl("p", {
      text: "CineVault turns your Obsidian vault into a personal movie and TV library. Search OMDb, rate titles, and store your collection in a JSON file within your vault.",
      cls: "cinevault-header-text"
    });
    if (!this.data) {
      renderOnboarding(container, async () => {
        this.file = await createJsonFile(this.plugin.app);
        if (this.file) {
          await this.plugin.setLocalJsonPath(this.file.path);
        }
        await this.loadFile(this.file);
        await this.render();
      }, () => {
        new JsonFileSuggestModal(this.plugin.app, async (file) => {
          await this.loadFile(file);
          await this.render();
        }).open();
      });
      return;
    }
    const searchBox = container.createDiv({ cls: "cinevault-search" });
    const searchInput = searchBox.createEl("input", {
      cls: "cinevault-search-input",
      attr: {
        placeholder: "Search"
      }
    });
    const resultsList = searchBox.createDiv({ cls: "cinevault-search-results" });
    const content = container.createDiv({ cls: "cinevault-content" });
    this.moviesContainer = content;
    this.renderMovies(content);
    let searchTimeout = null;
    searchInput.addEventListener("input", () => {
      if (searchTimeout)
        window.clearTimeout(searchTimeout);
      searchTimeout = window.setTimeout(async () => {
        const query = searchInput.value.trim();
        await this.renderSearchResults(resultsList, query);
      }, 350);
    });
  }
  renderMovies(container) {
    container.empty();
    if (!this.data) {
      container.createEl("p", { text: "No library loaded." });
      return;
    }
    const watched = this.data.movies.filter((movie) => movie.watched);
    const toWatch = this.data.movies.filter((movie) => !movie.watched);
    const tabsContainer = container.createDiv({ cls: "cinevault-tabs-container" });
    const tabHeader = tabsContainer.createDiv({ cls: "cinevault-tab-header" });
    const tabButtons = tabHeader.createDiv({ cls: "cinevault-tab-buttons" });
    const viewToggle = tabHeader.createDiv({ cls: "cinevault-view-toggle" });
    const toWatchButton = tabButtons.createEl("button", {
      cls: "cinevault-tab-button",
      text: `To Watch (${toWatch.length})`
    });
    const watchedButton = tabButtons.createEl("button", {
      cls: "cinevault-tab-button",
      text: `Watched (${watched.length})`
    });
    const gridButton = viewToggle.createEl("button", {
      cls: "cinevault-view-button",
      attr: { "aria-label": "Grid view", title: "Grid view" }
    });
    const listButton = viewToggle.createEl("button", {
      cls: "cinevault-view-button",
      attr: { "aria-label": "List view", title: "List view" }
    });
    (0, import_obsidian5.setIcon)(gridButton, "layout-grid");
    (0, import_obsidian5.setIcon)(listButton, "list");
    if (this.activeTab === "toWatch") {
      toWatchButton.classList.add("cinevault-tab-button-active");
    } else {
      watchedButton.classList.add("cinevault-tab-button-active");
    }
    if (this.viewMode === "grid") {
      gridButton.classList.add("cinevault-view-button-active");
    } else {
      listButton.classList.add("cinevault-view-button-active");
    }
    const tabContent = tabsContainer.createDiv({ cls: "cinevault-tab-content" });
    const activeMovies = this.activeTab === "toWatch" ? toWatch : watched;
    const activeTitle = this.activeTab === "toWatch" ? "To Watch" : "Watched";
    this.renderMovieSection(tabContent, activeTitle, activeMovies);
    toWatchButton.addEventListener("click", () => {
      if (this.activeTab === "toWatch")
        return;
      this.activeTab = "toWatch";
      this.renderMovies(container);
    });
    watchedButton.addEventListener("click", () => {
      if (this.activeTab === "watched")
        return;
      this.activeTab = "watched";
      this.renderMovies(container);
    });
    gridButton.addEventListener("click", async () => {
      if (this.viewMode === "grid")
        return;
      this.viewMode = "grid";
      await this.plugin.setViewMode("grid");
      this.renderMovies(container);
    });
    listButton.addEventListener("click", async () => {
      if (this.viewMode === "list")
        return;
      this.viewMode = "list";
      await this.plugin.setViewMode("list");
      this.renderMovies(container);
    });
  }
  renderMovieSection(container, title, movies) {
    const section = container.createDiv({ cls: "cinevault-section" });
    section.createEl("h3", { text: title });
    if (movies.length === 0) {
      section.createEl("p", { text: "No movies in this list." });
      return;
    }
    const list = section.createDiv({
      cls: this.viewMode === "grid" ? "cinevault-movie-grid" : "cinevault-movie-list"
    });
    if (this.viewMode === "grid") {
      this.renderMovieGrid(list, movies);
    } else {
      this.renderMovieList(list, movies);
    }
  }
  renderMovieGrid(container, movies) {
    movies.forEach((movie) => {
      const card = container.createDiv({ cls: "cinevault-movie-card" });
      card.createEl("img", { cls: "cinevault-movie-poster" }).setAttribute("src", movie.poster);
      card.createEl("div", { text: movie.title, cls: "cinevault-movie-title" });
      const type = nullSafe(() => movie.type[0].toUpperCase() + movie.type.slice(1), null);
      const year = nullSafe(() => movie.year, null);
      card.createEl("div", { text: `${year} - ${type}` || "", cls: "cinevault-movie-year" });
      card.addEventListener("click", () => this.openMovieDetails(movie));
    });
  }
  renderMovieList(container, movies) {
    movies.forEach((movie) => {
      const row = container.createDiv({ cls: "cinevault-movie-row" });
      const poster = row.createEl("img", { cls: "cinevault-movie-thumbnail" });
      poster.setAttribute("src", movie.poster || "");
      const info = row.createDiv({ cls: "cinevault-movie-info" });
      info.createEl("div", { text: movie.title, cls: "cinevault-movie-title" });
      const type = nullSafe(() => movie.type[0].toUpperCase() + movie.type.slice(1), null);
      const year = nullSafe(() => movie.year, null);
      info.createEl("div", { text: `${year} - ${type}` || "", cls: "cinevault-movie-year" });
      row.addEventListener("click", () => this.openMovieDetails(movie));
    });
  }
  openMovieDetails(movie) {
    new CineVaultMovieDetailModal(this.plugin.app, movie, async (rating) => {
      if (!this.data)
        return;
      movie.starRating = rating;
      await this.saveData();
      this.refreshMovies();
    }, async () => {
      if (!this.data)
        return;
      this.data.movies = this.data.movies.filter((item) => item.id !== movie.id);
      await this.saveData();
      this.refreshMovies();
    }, async () => {
      if (!this.data)
        return;
      movie.watched = !movie.watched;
      await this.saveData();
      this.refreshMovies();
    }).open();
  }
  refreshMovies() {
    if (!this.moviesContainer)
      return;
    this.renderMovies(this.moviesContainer);
  }
  getJsonFiles() {
    return this.plugin.app.vault.getFiles().filter((file) => file.extension === "json");
  }
  async initializeData() {
    const localPath = this.plugin.localJsonPath;
    if (localPath) {
      const localFile = this.plugin.app.vault.getAbstractFileByPath(localPath);
      if (localFile instanceof import_obsidian5.TFile) {
        await this.loadFile(localFile);
        return;
      }
    }
    this.file = null;
    this.data = null;
  }
  async loadFile(file) {
    try {
      const parsed = await loadLocalFile(this.plugin.app, file);
      this.file = file;
      this.data = parsed;
      await this.plugin.setLocalJsonPath(file.path);
    } catch (error) {
      this.data = null;
      this.file = null;
      new import_obsidian5.Notice("Unable to read the JSON file.");
    }
  }
  async saveData() {
    if (!this.data)
      return;
    this.data.updatedAt = new Date().toISOString();
    if (this.file) {
      await saveLocalData(this.plugin.app, this.file, this.data);
    }
  }
  async renderSearchResults(container, query) {
    container.empty();
    if (!query || query.length < 2)
      return;
    const results = await searchOmdb(query, this.plugin.omdbApiKey);
    if (results.length === 0) {
      container.createEl("div", { text: "No results found.", cls: "cinevault-search-empty" });
      return;
    }
    results.forEach((result) => {
      const item = container.createDiv({ cls: "cinevault-search-item" });
      if (result.poster) {
        item.createEl("img", { cls: "cinevault-search-poster" }).setAttribute("src", result.poster);
      }
      const info = item.createDiv({ cls: "cinevault-search-info" });
      info.createEl("div", { text: result.title, cls: "cinevault-search-title" });
      info.createEl("div", { text: result.year, cls: "cinevault-search-year" });
      item.addEventListener("click", () => {
        new CineVaultMovieActionModal(this.plugin.app, result, async (watched) => {
          if (!this.data)
            return;
          const existing = this.data.movies.find((movie) => movie.imdbId === result.imdbId);
          if (existing) {
            existing.watched = watched;
          } else {
            new import_obsidian5.Notice(`Loading details for ${result.title}...`);
            const details = await getOmdbDetails(result.imdbId, this.plugin.omdbApiKey);
            if (!details) {
              new import_obsidian5.Notice("Unable to load movie details.");
              return;
            }
            const newMovie = createEmptyMovie();
            newMovie.imdbId = details.imdbID || result.imdbId;
            newMovie.title = details.Title || result.title;
            newMovie.year = details.Year || result.year;
            newMovie.rated = details.Rated || "";
            newMovie.released = details.Released || "";
            newMovie.runtime = details.Runtime || "";
            newMovie.genre = details.Genre || "";
            newMovie.director = details.Director || "";
            newMovie.writer = details.Writer || "";
            newMovie.actors = details.Actors || "";
            newMovie.plot = details.Plot || result.plot;
            newMovie.language = details.Language || "";
            newMovie.country = details.Country || "";
            newMovie.awards = details.Awards || "";
            newMovie.poster = details.Poster && details.Poster !== "N/A" ? details.Poster : result.poster;
            newMovie.posterLocal = "";
            newMovie.ratings = details.Ratings || [];
            newMovie.metascore = details.Metascore || "";
            newMovie.imdbRating = details.imdbRating || "";
            newMovie.imdbVotes = details.imdbVotes || "";
            newMovie.type = details.Type || result.type;
            newMovie.dvd = details.DVD || "";
            newMovie.boxOffice = details.BoxOffice || "";
            newMovie.production = details.Production || "";
            newMovie.website = details.Website || "";
            newMovie.totalSeasons = details.totalSeasons || "";
            newMovie.watched = watched;
            this.data.movies.push(newMovie);
          }
          await this.saveData();
          this.render();
        }).open();
      });
    });
  }
};

// src/settings/CineVaultSettingTab.ts
var import_obsidian6 = require("obsidian");
var CineVaultSettingTab = class extends import_obsidian6.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    new import_obsidian6.Setting(containerEl).setName("Settings").setHeading();
    new import_obsidian6.Setting(containerEl).setName("OMDb API key").setDesc("Enter your OMDb API key. You can get one for free at omdbapi.com").addText((text) => text.setPlaceholder("Enter your API key").setValue(this.plugin.omdbApiKey).onChange(async (value) => {
      await this.plugin.setOmdbApiKey(value);
    }));
    new import_obsidian6.Setting(containerEl).setName("Linked local library").setDesc(
      this.plugin.localJsonPath ? `Local file: ${this.plugin.localJsonPath}` : "No local library linked"
    ).addDropdown((drop) => {
      var _a;
      const files = this.app.vault.getFiles().filter((f) => f.extension === "json");
      const options = { "": "-- None --" };
      files.forEach((f) => options[f.path] = f.path);
      drop.addOptions(options).setValue((_a = this.plugin.localJsonPath) != null ? _a : "").onChange(async (value) => {
        const path = value || null;
        await this.plugin.setLocalJsonPath(path);
        await this.refreshOpenViews();
        this.display();
      });
    }).addButton((button) => button.setButtonText("Unlink local").setDisabled(!this.plugin.localJsonPath).onClick(async () => {
      await this.plugin.setLocalJsonPath(null);
      await this.refreshOpenViews();
      this.display();
    }));
    new import_obsidian6.Setting(containerEl).setName("Create new library").setDesc("Create a new empty local library from scratch. This will unlink any external library.").addButton((button) => button.setButtonText("Create library").onClick(async () => {
      await this.createNewLibrary();
    }));
    new import_obsidian6.Setting(containerEl).setName("Export library").setDesc("Save a copy of your library JSON to a file.").addButton((button) => button.setButtonText("Export JSON").onClick(async () => {
      await this.exportLibraryJson();
    }));
    new import_obsidian6.Setting(containerEl).setName("Bugfix").setHeading();
    new import_obsidian6.Setting(containerEl).setName("Report issues").setDesc("If you encounter any issues with the plugin, please report them on GitHub. Your feedback is invaluable for improving CineVault!").addButton((button) => button.setButtonText("GitHub").onClick(() => {
      window.open("https://github.com/vscaperrotta/obsidian-plugin-cinevault/issues", "_blank");
    }));
    new import_obsidian6.Setting(containerEl).setName("Support").setHeading();
    new import_obsidian6.Setting(containerEl).setName("Donate").setDesc(
      "If you like this Plugin, consider donating to support continued development."
    ).addButton((bt) => {
      bt.buttonEl.outerHTML = "<a href='https://ko-fi.com/T6T01TX807' target='_blank'><img height='36' style='border:0px;height:36px;' src='https://storage.ko-fi.com/cdn/kofi6.png?v=6' border='0' alt='Buy Me a Coffee at ko-fi.com' /></a>";
    });
  }
  async exportLibraryJson() {
    try {
      const content = await this.getLibraryJsonContent();
      if (!content) {
        new import_obsidian6.Notice("No library file found to export.");
        return;
      }
      const timestamp = new Date().toISOString().replace(/[:.]/g, "-").slice(0, 19);
      const exportPath = `cinevault-export-${timestamp}.json`;
      let finalPath = exportPath;
      let counter = 1;
      while (this.app.vault.getAbstractFileByPath(finalPath)) {
        finalPath = `cinevault-export-${timestamp}-${counter}.json`;
        counter++;
      }
      await this.app.vault.create(finalPath, content);
      new import_obsidian6.Notice(`Library exported to ${finalPath}`);
    } catch (error) {
      console.error("[CineVault] Export library error", error);
      new import_obsidian6.Notice("Unable to export the library.");
    }
  }
  async createNewLibrary() {
    const confirmed = window.confirm(
      "Create a new empty CineVault library? This will unlink any external library and reset your local library data."
    );
    if (!confirmed)
      return;
    try {
      const defaultFile = this.app.vault.getAbstractFileByPath(getDefaultPath());
      let createdFile;
      if (defaultFile instanceof import_obsidian6.TFile) {
        await saveLocalData(this.app, defaultFile, createDefaultData());
        createdFile = defaultFile;
      } else {
        createdFile = await createJsonFile(this.app);
      }
      if (createdFile) {
        await this.plugin.setLocalJsonPath(createdFile.path);
      }
      await this.refreshOpenViews();
      this.display();
      new import_obsidian6.Notice("New library created.");
    } catch (error) {
      console.error("[CineVault] Create new library error", error);
      new import_obsidian6.Notice("Unable to create a new library.");
    }
  }
  async getLibraryJsonContent() {
    if (this.plugin.localJsonPath) {
      const localPath = this.plugin.localJsonPath;
      const file = this.app.vault.getAbstractFileByPath(localPath);
      if (file instanceof import_obsidian6.TFile) {
        return this.app.vault.read(file);
      }
    }
    const defaultFile = this.app.vault.getAbstractFileByPath(getDefaultPath());
    if (defaultFile instanceof import_obsidian6.TFile) {
      return this.app.vault.read(defaultFile);
    }
    const folder = getFolder();
    const fallback = this.app.vault.getFiles().find((file) => file.extension === "json" && file.path.startsWith(`${folder}/`));
    if (fallback) {
      return this.app.vault.read(fallback);
    }
    return null;
  }
  async refreshOpenViews() {
    const leaves = this.app.workspace.getLeavesOfType(VIEW_TYPE);
    for (const leaf of leaves) {
      if (leaf.view instanceof CineVaultView) {
        await leaf.view.onOpen();
      }
    }
  }
};

// src/main.ts
var CineVaultPlugin = class extends import_obsidian7.Plugin {
  constructor() {
    super(...arguments);
    this.localJsonPath = null;
    this.omdbApiKey = "";
    this.viewMode = "grid";
  }
  // Initialize the plugin and set up event listeners
  async onload() {
    await this.loadPluginData();
    this.addSettingTab(new CineVaultSettingTab(this.app, this));
    this.registerView(
      VIEW_TYPE,
      (leaf) => new CineVaultView(leaf, this)
    );
    this.addRibbonIcon("clapperboard", "CineVault", async () => {
      await this.openNewTab();
    });
  }
  // Unmount the status bar element when the plugin is disabled
  onunload() {
  }
  async loadPluginData() {
    var _a, _b, _c;
    const data = await this.loadData();
    this.localJsonPath = (_a = data == null ? void 0 : data.localJsonPath) != null ? _a : null;
    this.omdbApiKey = (_b = data == null ? void 0 : data.omdbApiKey) != null ? _b : "";
    this.viewMode = (_c = data == null ? void 0 : data.viewMode) != null ? _c : "grid";
  }
  // externalJsonPath removed; no-op placeholder removed
  async setOmdbApiKey(apiKey) {
    this.omdbApiKey = apiKey;
    await this.savePluginData();
  }
  async setViewMode(viewMode) {
    this.viewMode = viewMode;
    await this.savePluginData();
  }
  async savePluginData() {
    const data = {
      omdbApiKey: this.omdbApiKey,
      viewMode: this.viewMode
    };
    if (this.localJsonPath) {
      data.localJsonPath = this.localJsonPath;
    }
    await this.saveData(data);
  }
  async setLocalJsonPath(path) {
    this.localJsonPath = path;
    await this.savePluginData();
  }
  // Open a new tab with the "CineVault" view type
  async openNewTab() {
    const existingLeaves = this.app.workspace.getLeavesOfType(VIEW_TYPE);
    if (existingLeaves.length > 0) {
      this.app.workspace.revealLeaf(existingLeaves[0]);
      return;
    }
    const leaf = this.app.workspace.getLeaf(true);
    await leaf.setViewState({
      type: VIEW_TYPE,
      active: true
    });
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL21haW4udHMiLCAic3JjL2NvbnN0YW50cy50cyIsICJzcmMvdmlld3MvQ2luZVZhdWx0Vmlldy50cyIsICJzcmMvdWkvb25ib2FyZGluZy50cyIsICJzcmMvdWkvbW9kYWxzL0NpbmVWYXVsdE1vdmllQWN0aW9uTW9kYWwudHMiLCAic3JjL3VpL21vZGFscy9DaW5lVmF1bHRNb3ZpZURldGFpbE1vZGFsLnRzIiwgInNyYy91aS9zdGFyUmF0aW5nLnRzIiwgInNyYy91dGlscy50cyIsICJzcmMvdWkvSnNvbkZpbGVTdWdnZXN0TW9kYWwudHMiLCAic3JjL3NlcnZpY2VzL2xpYnJhcnlTdG9yYWdlLnRzIiwgInNyYy9zZXJ2aWNlcy9vbWRiU2VydmljZS50cyIsICJzcmMvc2V0dGluZ3MvQ2luZVZhdWx0U2V0dGluZ1RhYi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgUGx1Z2luIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBWSUVXX1RZUEUgfSBmcm9tIFwiLi9jb25zdGFudHNcIjtcbmltcG9ydCBDaW5lVmF1bHRWaWV3IGZyb20gXCIuL3ZpZXdzL0NpbmVWYXVsdFZpZXdcIjtcbmltcG9ydCBDaW5lVmF1bHRTZXR0aW5nVGFiIGZyb20gXCIuL3NldHRpbmdzL0NpbmVWYXVsdFNldHRpbmdUYWJcIjtcblxudHlwZSBDaW5lVmF1bHRQbHVnaW5EYXRhID0ge1xuXHRsb2NhbEpzb25QYXRoPzogc3RyaW5nO1xuXHRvbWRiQXBpS2V5Pzogc3RyaW5nO1xuXHR2aWV3TW9kZT86IFwiZ3JpZFwiIHwgXCJsaXN0XCI7XG5cdG9wZW4/OiBib29sZWFuO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2luZVZhdWx0UGx1Z2luIGV4dGVuZHMgUGx1Z2luIHtcblx0bG9jYWxKc29uUGF0aDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG5cdG9tZGJBcGlLZXk6IHN0cmluZyA9IFwiXCI7XG5cdHZpZXdNb2RlOiBcImdyaWRcIiB8IFwibGlzdFwiID0gXCJncmlkXCI7XG5cblx0Ly8gSW5pdGlhbGl6ZSB0aGUgcGx1Z2luIGFuZCBzZXQgdXAgZXZlbnQgbGlzdGVuZXJzXG5cdGFzeW5jIG9ubG9hZCgpIHtcblx0XHRhd2FpdCB0aGlzLmxvYWRQbHVnaW5EYXRhKCk7XG5cblx0XHQvLyBBZGQgc2V0dGluZ3MgdGFiXG5cdFx0dGhpcy5hZGRTZXR0aW5nVGFiKG5ldyBDaW5lVmF1bHRTZXR0aW5nVGFiKHRoaXMuYXBwLCB0aGlzKSk7XG5cblx0XHQvLyBSZWdpc3RlciBuZXcgdmlld1xuXHRcdHRoaXMucmVnaXN0ZXJWaWV3KFxuXHRcdFx0VklFV19UWVBFLFxuXHRcdFx0KGxlYWYpID0+IG5ldyBDaW5lVmF1bHRWaWV3KGxlYWYsIHRoaXMpXG5cdFx0KTtcblxuXHRcdHRoaXMuYWRkUmliYm9uSWNvbihcImNsYXBwZXJib2FyZFwiLCBcIkNpbmVWYXVsdFwiLCBhc3luYyAoKSA9PiB7XG5cdFx0XHRhd2FpdCB0aGlzLm9wZW5OZXdUYWIoKTtcblx0XHR9KTtcblx0fVxuXG5cdC8vIFVubW91bnQgdGhlIHN0YXR1cyBiYXIgZWxlbWVudCB3aGVuIHRoZSBwbHVnaW4gaXMgZGlzYWJsZWRcblx0b251bmxvYWQoKSB7XG5cdH1cblxuXHRwcml2YXRlIGFzeW5jIGxvYWRQbHVnaW5EYXRhKCkge1xuXHRcdGNvbnN0IGRhdGEgPSAoYXdhaXQgdGhpcy5sb2FkRGF0YSgpKSBhcyBDaW5lVmF1bHRQbHVnaW5EYXRhIHwgbnVsbDtcblx0XHR0aGlzLmxvY2FsSnNvblBhdGggPSBkYXRhPy5sb2NhbEpzb25QYXRoID8/IG51bGw7XG5cdFx0dGhpcy5vbWRiQXBpS2V5ID0gZGF0YT8ub21kYkFwaUtleSA/PyBcIlwiO1xuXHRcdHRoaXMudmlld01vZGUgPSBkYXRhPy52aWV3TW9kZSA/PyBcImdyaWRcIjtcblx0fVxuXG5cdC8vIGV4dGVybmFsSnNvblBhdGggcmVtb3ZlZDsgbm8tb3AgcGxhY2Vob2xkZXIgcmVtb3ZlZFxuXG5cdGFzeW5jIHNldE9tZGJBcGlLZXkoYXBpS2V5OiBzdHJpbmcpIHtcblx0XHR0aGlzLm9tZGJBcGlLZXkgPSBhcGlLZXk7XG5cdFx0YXdhaXQgdGhpcy5zYXZlUGx1Z2luRGF0YSgpO1xuXHR9XG5cblx0YXN5bmMgc2V0Vmlld01vZGUodmlld01vZGU6IFwiZ3JpZFwiIHwgXCJsaXN0XCIpIHtcblx0XHR0aGlzLnZpZXdNb2RlID0gdmlld01vZGU7XG5cdFx0YXdhaXQgdGhpcy5zYXZlUGx1Z2luRGF0YSgpO1xuXHR9XG5cblx0cHJpdmF0ZSBhc3luYyBzYXZlUGx1Z2luRGF0YSgpIHtcblx0XHRjb25zdCBkYXRhOiBDaW5lVmF1bHRQbHVnaW5EYXRhID0ge1xuXHRcdFx0b21kYkFwaUtleTogdGhpcy5vbWRiQXBpS2V5LFxuXHRcdFx0dmlld01vZGU6IHRoaXMudmlld01vZGVcblx0XHR9O1xuXHRcdGlmICh0aGlzLmxvY2FsSnNvblBhdGgpIHtcblx0XHRcdGRhdGEubG9jYWxKc29uUGF0aCA9IHRoaXMubG9jYWxKc29uUGF0aDtcblx0XHR9XG5cdFx0YXdhaXQgdGhpcy5zYXZlRGF0YShkYXRhKTtcblx0fVxuXG5cdGFzeW5jIHNldExvY2FsSnNvblBhdGgocGF0aDogc3RyaW5nIHwgbnVsbCkge1xuXHRcdHRoaXMubG9jYWxKc29uUGF0aCA9IHBhdGg7XG5cdFx0YXdhaXQgdGhpcy5zYXZlUGx1Z2luRGF0YSgpO1xuXHR9XG5cblx0Ly8gT3BlbiBhIG5ldyB0YWIgd2l0aCB0aGUgXCJDaW5lVmF1bHRcIiB2aWV3IHR5cGVcblx0cHJpdmF0ZSBhc3luYyBvcGVuTmV3VGFiKCkge1xuXHRcdGNvbnN0IGV4aXN0aW5nTGVhdmVzID0gdGhpcy5hcHAud29ya3NwYWNlLmdldExlYXZlc09mVHlwZShWSUVXX1RZUEUpO1xuXHRcdGlmIChleGlzdGluZ0xlYXZlcy5sZW5ndGggPiAwKSB7XG5cdFx0XHR0aGlzLmFwcC53b3Jrc3BhY2UucmV2ZWFsTGVhZihleGlzdGluZ0xlYXZlc1swXSk7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0Y29uc3QgbGVhZiA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWFmKHRydWUpO1xuXHRcdGF3YWl0IGxlYWYuc2V0Vmlld1N0YXRlKHtcblx0XHRcdHR5cGU6IFZJRVdfVFlQRSxcblx0XHRcdGFjdGl2ZTogdHJ1ZVxuXHRcdH0pO1xuXHR9XG59IiwgImV4cG9ydCBjb25zdCBWSUVXX1RZUEUgPSBcIkNpbmVWYXVsdFZpZXdcIjsiLCAiaW1wb3J0IHsgSXRlbVZpZXcsIFdvcmtzcGFjZUxlYWYsIFRGaWxlLCBOb3RpY2UsIHNldEljb24gfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCBDaW5lVmF1bHRQbHVnaW4gZnJvbSBcIi4uL21haW5cIjtcbmltcG9ydCB7IFZJRVdfVFlQRSB9IGZyb20gXCIuLi9jb25zdGFudHNcIjtcbmltcG9ydCB0eXBlIHsgQ2luZVZhdWx0RGF0YSwgQ2luZVZhdWx0TW92aWUgfSBmcm9tIFwiLi4vdHlwZXMvY2luZXZhdWx0XCI7XG5pbXBvcnQgeyByZW5kZXJPbmJvYXJkaW5nIH0gZnJvbSBcIi4uL3VpL29uYm9hcmRpbmdcIjtcbmltcG9ydCB7IENpbmVWYXVsdE1vdmllQWN0aW9uTW9kYWwgfSBmcm9tIFwiLi4vdWkvbW9kYWxzL0NpbmVWYXVsdE1vdmllQWN0aW9uTW9kYWxcIjtcbmltcG9ydCB7IENpbmVWYXVsdE1vdmllRGV0YWlsTW9kYWwgfSBmcm9tIFwiLi4vdWkvbW9kYWxzL0NpbmVWYXVsdE1vdmllRGV0YWlsTW9kYWxcIjtcbmltcG9ydCB7IEpzb25GaWxlU3VnZ2VzdE1vZGFsIH0gZnJvbSBcIi4uL3VpL0pzb25GaWxlU3VnZ2VzdE1vZGFsXCI7XG5pbXBvcnQge1xuICBjcmVhdGVFbXB0eU1vdmllLFxuICBjcmVhdGVKc29uRmlsZSxcbiAgZ2V0RGVmYXVsdFBhdGgsXG4gIGdldEZvbGRlcixcbiAgbG9hZExvY2FsRmlsZSxcbiAgc2F2ZUxvY2FsRGF0YVxufSBmcm9tIFwiLi4vc2VydmljZXMvbGlicmFyeVN0b3JhZ2VcIjtcbmltcG9ydCB7IHNlYXJjaE9tZGIsIGdldE9tZGJEZXRhaWxzIH0gZnJvbSBcIi4uL3NlcnZpY2VzL29tZGJTZXJ2aWNlXCI7XG5pbXBvcnQgeyBudWxsU2FmZSB9IGZyb20gXCJzcmMvdXRpbHNcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2luZVZhdWx0VmlldyBleHRlbmRzIEl0ZW1WaWV3IHtcblxuICBwbHVnaW46IENpbmVWYXVsdFBsdWdpbjtcbiAgZmlsZTogVEZpbGUgfCBudWxsID0gbnVsbDtcbiAgZGF0YTogQ2luZVZhdWx0RGF0YSB8IG51bGwgPSBudWxsO1xuICBhY3RpdmVUYWI6IFwidG9XYXRjaFwiIHwgXCJ3YXRjaGVkXCIgPSBcInRvV2F0Y2hcIjtcbiAgbW92aWVzQ29udGFpbmVyOiBIVE1MRWxlbWVudCB8IG51bGwgPSBudWxsO1xuICB2aWV3TW9kZTogXCJncmlkXCIgfCBcImxpc3RcIiA9IFwiZ3JpZFwiO1xuXG4gIGNvbnN0cnVjdG9yKGxlYWY6IFdvcmtzcGFjZUxlYWYsIHBsdWdpbjogQ2luZVZhdWx0UGx1Z2luKSB7XG4gICAgc3VwZXIobGVhZik7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gIH1cblxuICBnZXRWaWV3VHlwZSgpIHtcbiAgICByZXR1cm4gVklFV19UWVBFO1xuICB9XG5cbiAgZ2V0RGlzcGxheVRleHQoKSB7XG4gICAgcmV0dXJuIFwiQ2luZVZhdWx0XCI7XG4gIH1cblxuICAvLyBQcm92aWRlIGEgY3VzdG9tIGljb24gZm9yIHRoZSB2aWV3J3MgdGFiXG4gIGdldEljb24oKTogc3RyaW5nIHtcbiAgICByZXR1cm4gXCJjbGFwcGVyYm9hcmRcIjtcbiAgfVxuXG4gIGFzeW5jIG9uT3BlbigpIHtcbiAgICB0aGlzLnZpZXdNb2RlID0gdGhpcy5wbHVnaW4udmlld01vZGUgPz8gXCJncmlkXCI7XG4gICAgYXdhaXQgdGhpcy5pbml0aWFsaXplRGF0YSgpO1xuICAgIGF3YWl0IHRoaXMucmVuZGVyKCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHJlbmRlcigpIHtcbiAgICBjb25zdCBjb250YWluZXIgPSB0aGlzLmNvbnRhaW5lckVsLmNoaWxkcmVuWzFdIGFzIEhUTUxFbGVtZW50O1xuICAgIGNvbnRhaW5lci5lbXB0eSgpO1xuXG4gICAgY29uc3QgaGVhZGVyID0gY29udGFpbmVyLmNyZWF0ZURpdih7IGNsczogXCJjaW5ldmF1bHQtaGVhZGVyXCIgfSk7XG4gICAgaGVhZGVyLmNyZWF0ZUVsKFwiaDFcIiwge1xuICAgICAgdGV4dDogXCJDaW5lVmF1bHRcIixcbiAgICAgIGNsczogXCJjaW5ldmF1bHQtdGl0bGVcIlxuICAgIH0pO1xuXG4gICAgaGVhZGVyLmNyZWF0ZUVsKFwicFwiLCB7XG4gICAgICB0ZXh0OiBcIkNpbmVWYXVsdCB0dXJucyB5b3VyIE9ic2lkaWFuIHZhdWx0IGludG8gYSBwZXJzb25hbCBtb3ZpZSBhbmQgVFYgbGlicmFyeS4gU2VhcmNoIE9NRGIsIHJhdGUgdGl0bGVzLCBhbmQgc3RvcmUgeW91ciBjb2xsZWN0aW9uIGluIGEgSlNPTiBmaWxlIHdpdGhpbiB5b3VyIHZhdWx0LlwiLFxuICAgICAgY2xzOiBcImNpbmV2YXVsdC1oZWFkZXItdGV4dFwiXG4gICAgfSk7XG5cbiAgICBpZiAoIXRoaXMuZGF0YSkge1xuICAgICAgcmVuZGVyT25ib2FyZGluZyhjb250YWluZXIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgdGhpcy5maWxlID0gYXdhaXQgY3JlYXRlSnNvbkZpbGUodGhpcy5wbHVnaW4uYXBwKTtcbiAgICAgICAgaWYgKHRoaXMuZmlsZSkge1xuICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNldExvY2FsSnNvblBhdGgodGhpcy5maWxlLnBhdGgpO1xuICAgICAgICB9XG4gICAgICAgIGF3YWl0IHRoaXMubG9hZEZpbGUodGhpcy5maWxlKTtcbiAgICAgICAgYXdhaXQgdGhpcy5yZW5kZXIoKTtcbiAgICAgIH0sICgpID0+IHtcbiAgICAgICAgLy8gT3BlbiBtb2RhbCB0byBzZWxlY3QgSlNPTiBmaWxlIGZyb20gdmF1bHRcbiAgICAgICAgbmV3IEpzb25GaWxlU3VnZ2VzdE1vZGFsKHRoaXMucGx1Z2luLmFwcCwgYXN5bmMgKGZpbGUpID0+IHtcbiAgICAgICAgICBhd2FpdCB0aGlzLmxvYWRGaWxlKGZpbGUpO1xuICAgICAgICAgIGF3YWl0IHRoaXMucmVuZGVyKCk7XG4gICAgICAgIH0pLm9wZW4oKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHNlYXJjaEJveCA9IGNvbnRhaW5lci5jcmVhdGVEaXYoeyBjbHM6IFwiY2luZXZhdWx0LXNlYXJjaFwiIH0pO1xuICAgIGNvbnN0IHNlYXJjaElucHV0ID0gc2VhcmNoQm94LmNyZWF0ZUVsKFwiaW5wdXRcIiwge1xuICAgICAgY2xzOiBcImNpbmV2YXVsdC1zZWFyY2gtaW5wdXRcIixcbiAgICAgIGF0dHI6IHtcbiAgICAgICAgcGxhY2Vob2xkZXI6IFwiU2VhcmNoXCJcbiAgICAgIH1cbiAgICB9KTtcbiAgICBjb25zdCByZXN1bHRzTGlzdCA9IHNlYXJjaEJveC5jcmVhdGVEaXYoeyBjbHM6IFwiY2luZXZhdWx0LXNlYXJjaC1yZXN1bHRzXCIgfSk7XG5cbiAgICBjb25zdCBjb250ZW50ID0gY29udGFpbmVyLmNyZWF0ZURpdih7IGNsczogXCJjaW5ldmF1bHQtY29udGVudFwiIH0pO1xuICAgIHRoaXMubW92aWVzQ29udGFpbmVyID0gY29udGVudDtcblxuICAgIHRoaXMucmVuZGVyTW92aWVzKGNvbnRlbnQpO1xuXG4gICAgbGV0IHNlYXJjaFRpbWVvdXQ6IG51bWJlciB8IG51bGwgPSBudWxsO1xuICAgIHNlYXJjaElucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgICBpZiAoc2VhcmNoVGltZW91dCkgd2luZG93LmNsZWFyVGltZW91dChzZWFyY2hUaW1lb3V0KTtcbiAgICAgIHNlYXJjaFRpbWVvdXQgPSB3aW5kb3cuc2V0VGltZW91dChhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHF1ZXJ5ID0gc2VhcmNoSW5wdXQudmFsdWUudHJpbSgpO1xuICAgICAgICBhd2FpdCB0aGlzLnJlbmRlclNlYXJjaFJlc3VsdHMocmVzdWx0c0xpc3QsIHF1ZXJ5KTtcbiAgICAgIH0sIDM1MCk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHJlbmRlck1vdmllcyhjb250YWluZXI6IEhUTUxFbGVtZW50KSB7XG4gICAgY29udGFpbmVyLmVtcHR5KCk7XG5cbiAgICBpZiAoIXRoaXMuZGF0YSkge1xuICAgICAgY29udGFpbmVyLmNyZWF0ZUVsKFwicFwiLCB7IHRleHQ6IFwiTm8gbGlicmFyeSBsb2FkZWQuXCIgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3Qgd2F0Y2hlZCA9IHRoaXMuZGF0YS5tb3ZpZXMuZmlsdGVyKChtb3ZpZSkgPT4gbW92aWUud2F0Y2hlZCk7XG4gICAgY29uc3QgdG9XYXRjaCA9IHRoaXMuZGF0YS5tb3ZpZXMuZmlsdGVyKChtb3ZpZSkgPT4gIW1vdmllLndhdGNoZWQpO1xuXG4gICAgY29uc3QgdGFic0NvbnRhaW5lciA9IGNvbnRhaW5lci5jcmVhdGVEaXYoeyBjbHM6IFwiY2luZXZhdWx0LXRhYnMtY29udGFpbmVyXCIgfSk7XG4gICAgY29uc3QgdGFiSGVhZGVyID0gdGFic0NvbnRhaW5lci5jcmVhdGVEaXYoeyBjbHM6IFwiY2luZXZhdWx0LXRhYi1oZWFkZXJcIiB9KTtcblxuICAgIGNvbnN0IHRhYkJ1dHRvbnMgPSB0YWJIZWFkZXIuY3JlYXRlRGl2KHsgY2xzOiBcImNpbmV2YXVsdC10YWItYnV0dG9uc1wiIH0pO1xuICAgIGNvbnN0IHZpZXdUb2dnbGUgPSB0YWJIZWFkZXIuY3JlYXRlRGl2KHsgY2xzOiBcImNpbmV2YXVsdC12aWV3LXRvZ2dsZVwiIH0pO1xuXG4gICAgY29uc3QgdG9XYXRjaEJ1dHRvbiA9IHRhYkJ1dHRvbnMuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcImNpbmV2YXVsdC10YWItYnV0dG9uXCIsXG4gICAgICB0ZXh0OiBgVG8gV2F0Y2ggKCR7dG9XYXRjaC5sZW5ndGh9KWBcbiAgICB9KTtcbiAgICBjb25zdCB3YXRjaGVkQnV0dG9uID0gdGFiQnV0dG9ucy5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwiY2luZXZhdWx0LXRhYi1idXR0b25cIixcbiAgICAgIHRleHQ6IGBXYXRjaGVkICgke3dhdGNoZWQubGVuZ3RofSlgXG4gICAgfSk7XG5cbiAgICBjb25zdCBncmlkQnV0dG9uID0gdmlld1RvZ2dsZS5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwiY2luZXZhdWx0LXZpZXctYnV0dG9uXCIsXG4gICAgICBhdHRyOiB7IFwiYXJpYS1sYWJlbFwiOiBcIkdyaWQgdmlld1wiLCB0aXRsZTogXCJHcmlkIHZpZXdcIiB9XG4gICAgfSk7XG4gICAgY29uc3QgbGlzdEJ1dHRvbiA9IHZpZXdUb2dnbGUuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgY2xzOiBcImNpbmV2YXVsdC12aWV3LWJ1dHRvblwiLFxuICAgICAgYXR0cjogeyBcImFyaWEtbGFiZWxcIjogXCJMaXN0IHZpZXdcIiwgdGl0bGU6IFwiTGlzdCB2aWV3XCIgfVxuICAgIH0pO1xuXG4gICAgc2V0SWNvbihncmlkQnV0dG9uLCBcImxheW91dC1ncmlkXCIpO1xuICAgIHNldEljb24obGlzdEJ1dHRvbiwgXCJsaXN0XCIpO1xuXG4gICAgaWYgKHRoaXMuYWN0aXZlVGFiID09PSBcInRvV2F0Y2hcIikge1xuICAgICAgdG9XYXRjaEJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwiY2luZXZhdWx0LXRhYi1idXR0b24tYWN0aXZlXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICB3YXRjaGVkQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJjaW5ldmF1bHQtdGFiLWJ1dHRvbi1hY3RpdmVcIik7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMudmlld01vZGUgPT09IFwiZ3JpZFwiKSB7XG4gICAgICBncmlkQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJjaW5ldmF1bHQtdmlldy1idXR0b24tYWN0aXZlXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBsaXN0QnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJjaW5ldmF1bHQtdmlldy1idXR0b24tYWN0aXZlXCIpO1xuICAgIH1cblxuICAgIGNvbnN0IHRhYkNvbnRlbnQgPSB0YWJzQ29udGFpbmVyLmNyZWF0ZURpdih7IGNsczogXCJjaW5ldmF1bHQtdGFiLWNvbnRlbnRcIiB9KTtcbiAgICBjb25zdCBhY3RpdmVNb3ZpZXMgPSB0aGlzLmFjdGl2ZVRhYiA9PT0gXCJ0b1dhdGNoXCIgPyB0b1dhdGNoIDogd2F0Y2hlZDtcbiAgICBjb25zdCBhY3RpdmVUaXRsZSA9IHRoaXMuYWN0aXZlVGFiID09PSBcInRvV2F0Y2hcIiA/IFwiVG8gV2F0Y2hcIiA6IFwiV2F0Y2hlZFwiO1xuICAgIHRoaXMucmVuZGVyTW92aWVTZWN0aW9uKHRhYkNvbnRlbnQsIGFjdGl2ZVRpdGxlLCBhY3RpdmVNb3ZpZXMpO1xuXG4gICAgdG9XYXRjaEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgaWYgKHRoaXMuYWN0aXZlVGFiID09PSBcInRvV2F0Y2hcIikgcmV0dXJuO1xuICAgICAgdGhpcy5hY3RpdmVUYWIgPSBcInRvV2F0Y2hcIjtcbiAgICAgIHRoaXMucmVuZGVyTW92aWVzKGNvbnRhaW5lcik7XG4gICAgfSk7XG5cbiAgICB3YXRjaGVkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBpZiAodGhpcy5hY3RpdmVUYWIgPT09IFwid2F0Y2hlZFwiKSByZXR1cm47XG4gICAgICB0aGlzLmFjdGl2ZVRhYiA9IFwid2F0Y2hlZFwiO1xuICAgICAgdGhpcy5yZW5kZXJNb3ZpZXMoY29udGFpbmVyKTtcbiAgICB9KTtcblxuICAgIGdyaWRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGlmICh0aGlzLnZpZXdNb2RlID09PSBcImdyaWRcIikgcmV0dXJuO1xuICAgICAgdGhpcy52aWV3TW9kZSA9IFwiZ3JpZFwiO1xuICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2V0Vmlld01vZGUoXCJncmlkXCIpO1xuICAgICAgdGhpcy5yZW5kZXJNb3ZpZXMoY29udGFpbmVyKTtcbiAgICB9KTtcblxuICAgIGxpc3RCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGlmICh0aGlzLnZpZXdNb2RlID09PSBcImxpc3RcIikgcmV0dXJuO1xuICAgICAgdGhpcy52aWV3TW9kZSA9IFwibGlzdFwiO1xuICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2V0Vmlld01vZGUoXCJsaXN0XCIpO1xuICAgICAgdGhpcy5yZW5kZXJNb3ZpZXMoY29udGFpbmVyKTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgcmVuZGVyTW92aWVTZWN0aW9uKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIHRpdGxlOiBzdHJpbmcsIG1vdmllczogQ2luZVZhdWx0TW92aWVbXSkge1xuICAgIGNvbnN0IHNlY3Rpb24gPSBjb250YWluZXIuY3JlYXRlRGl2KHsgY2xzOiBcImNpbmV2YXVsdC1zZWN0aW9uXCIgfSk7XG4gICAgc2VjdGlvbi5jcmVhdGVFbChcImgzXCIsIHsgdGV4dDogdGl0bGUgfSk7XG5cbiAgICBpZiAobW92aWVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgc2VjdGlvbi5jcmVhdGVFbChcInBcIiwgeyB0ZXh0OiBcIk5vIG1vdmllcyBpbiB0aGlzIGxpc3QuXCIgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgbGlzdCA9IHNlY3Rpb24uY3JlYXRlRGl2KHtcbiAgICAgIGNsczogdGhpcy52aWV3TW9kZSA9PT0gXCJncmlkXCIgPyBcImNpbmV2YXVsdC1tb3ZpZS1ncmlkXCIgOiBcImNpbmV2YXVsdC1tb3ZpZS1saXN0XCJcbiAgICB9KTtcblxuICAgIGlmICh0aGlzLnZpZXdNb2RlID09PSBcImdyaWRcIikge1xuICAgICAgdGhpcy5yZW5kZXJNb3ZpZUdyaWQobGlzdCwgbW92aWVzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5yZW5kZXJNb3ZpZUxpc3QobGlzdCwgbW92aWVzKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlbmRlck1vdmllR3JpZChjb250YWluZXI6IEhUTUxFbGVtZW50LCBtb3ZpZXM6IENpbmVWYXVsdE1vdmllW10pIHtcbiAgICBtb3ZpZXMuZm9yRWFjaCgobW92aWUpID0+IHtcbiAgICAgIGNvbnN0IGNhcmQgPSBjb250YWluZXIuY3JlYXRlRGl2KHsgY2xzOiBcImNpbmV2YXVsdC1tb3ZpZS1jYXJkXCIgfSk7XG4gICAgICBjYXJkLmNyZWF0ZUVsKFwiaW1nXCIsIHsgY2xzOiBcImNpbmV2YXVsdC1tb3ZpZS1wb3N0ZXJcIiB9KS5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgbW92aWUucG9zdGVyKTtcbiAgICAgIGNhcmQuY3JlYXRlRWwoXCJkaXZcIiwgeyB0ZXh0OiBtb3ZpZS50aXRsZSwgY2xzOiBcImNpbmV2YXVsdC1tb3ZpZS10aXRsZVwiIH0pO1xuXG4gICAgICBjb25zdCB0eXBlID0gbnVsbFNhZmUoKCkgPT4gbW92aWUudHlwZVswXS50b1VwcGVyQ2FzZSgpICsgbW92aWUudHlwZS5zbGljZSgxKSwgbnVsbCk7XG4gICAgICBjb25zdCB5ZWFyID0gbnVsbFNhZmUoKCkgPT4gbW92aWUueWVhciwgbnVsbCk7XG4gICAgICBjYXJkLmNyZWF0ZUVsKFwiZGl2XCIsIHsgdGV4dDogYCR7eWVhcn0gLSAke3R5cGV9YCB8fCBcIlwiLCBjbHM6IFwiY2luZXZhdWx0LW1vdmllLXllYXJcIiB9KTtcblxuICAgICAgY2FyZC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gdGhpcy5vcGVuTW92aWVEZXRhaWxzKG1vdmllKSk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHJlbmRlck1vdmllTGlzdChjb250YWluZXI6IEhUTUxFbGVtZW50LCBtb3ZpZXM6IENpbmVWYXVsdE1vdmllW10pIHtcbiAgICBtb3ZpZXMuZm9yRWFjaCgobW92aWUpID0+IHtcbiAgICAgIGNvbnN0IHJvdyA9IGNvbnRhaW5lci5jcmVhdGVEaXYoeyBjbHM6IFwiY2luZXZhdWx0LW1vdmllLXJvd1wiIH0pO1xuICAgICAgY29uc3QgcG9zdGVyID0gcm93LmNyZWF0ZUVsKFwiaW1nXCIsIHsgY2xzOiBcImNpbmV2YXVsdC1tb3ZpZS10aHVtYm5haWxcIiB9KTtcbiAgICAgIHBvc3Rlci5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgbW92aWUucG9zdGVyIHx8IFwiXCIpO1xuXG4gICAgICBjb25zdCBpbmZvID0gcm93LmNyZWF0ZURpdih7IGNsczogXCJjaW5ldmF1bHQtbW92aWUtaW5mb1wiIH0pO1xuICAgICAgaW5mby5jcmVhdGVFbChcImRpdlwiLCB7IHRleHQ6IG1vdmllLnRpdGxlLCBjbHM6IFwiY2luZXZhdWx0LW1vdmllLXRpdGxlXCIgfSk7XG5cbiAgICAgIGNvbnN0IHR5cGUgPSBudWxsU2FmZSgoKSA9PiBtb3ZpZS50eXBlWzBdLnRvVXBwZXJDYXNlKCkgKyBtb3ZpZS50eXBlLnNsaWNlKDEpLCBudWxsKTtcbiAgICAgIGNvbnN0IHllYXIgPSBudWxsU2FmZSgoKSA9PiBtb3ZpZS55ZWFyLCBudWxsKTtcbiAgICAgIGluZm8uY3JlYXRlRWwoXCJkaXZcIiwgeyB0ZXh0OiBgJHt5ZWFyfSAtICR7dHlwZX1gIHx8IFwiXCIsIGNsczogXCJjaW5ldmF1bHQtbW92aWUteWVhclwiIH0pO1xuXG4gICAgICByb3cuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHRoaXMub3Blbk1vdmllRGV0YWlscyhtb3ZpZSkpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBvcGVuTW92aWVEZXRhaWxzKG1vdmllOiBDaW5lVmF1bHRNb3ZpZSkge1xuICAgIG5ldyBDaW5lVmF1bHRNb3ZpZURldGFpbE1vZGFsKHRoaXMucGx1Z2luLmFwcCwgbW92aWUsIGFzeW5jIChyYXRpbmcpID0+IHtcbiAgICAgIGlmICghdGhpcy5kYXRhKSByZXR1cm47XG4gICAgICBtb3ZpZS5zdGFyUmF0aW5nID0gcmF0aW5nO1xuICAgICAgYXdhaXQgdGhpcy5zYXZlRGF0YSgpO1xuICAgICAgdGhpcy5yZWZyZXNoTW92aWVzKCk7XG4gICAgfSwgYXN5bmMgKCkgPT4ge1xuICAgICAgaWYgKCF0aGlzLmRhdGEpIHJldHVybjtcbiAgICAgIHRoaXMuZGF0YS5tb3ZpZXMgPSB0aGlzLmRhdGEubW92aWVzLmZpbHRlcigoaXRlbSkgPT4gaXRlbS5pZCAhPT0gbW92aWUuaWQpO1xuICAgICAgYXdhaXQgdGhpcy5zYXZlRGF0YSgpO1xuICAgICAgdGhpcy5yZWZyZXNoTW92aWVzKCk7XG4gICAgfSwgYXN5bmMgKCkgPT4ge1xuICAgICAgaWYgKCF0aGlzLmRhdGEpIHJldHVybjtcbiAgICAgIG1vdmllLndhdGNoZWQgPSAhbW92aWUud2F0Y2hlZDtcbiAgICAgIGF3YWl0IHRoaXMuc2F2ZURhdGEoKTtcbiAgICAgIHRoaXMucmVmcmVzaE1vdmllcygpO1xuICAgIH0pLm9wZW4oKTtcbiAgfVxuXG4gIHByaXZhdGUgcmVmcmVzaE1vdmllcygpIHtcbiAgICBpZiAoIXRoaXMubW92aWVzQ29udGFpbmVyKSByZXR1cm47XG4gICAgdGhpcy5yZW5kZXJNb3ZpZXModGhpcy5tb3ZpZXNDb250YWluZXIpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRKc29uRmlsZXMoKTogVEZpbGVbXSB7XG4gICAgcmV0dXJuIHRoaXMucGx1Z2luLmFwcC52YXVsdC5nZXRGaWxlcygpLmZpbHRlcigoZmlsZSkgPT4gZmlsZS5leHRlbnNpb24gPT09IFwianNvblwiKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgaW5pdGlhbGl6ZURhdGEoKSB7XG4gICAgLy8gUHJlZmVyIGEgbG9jYWxseSBsaW5rZWQgZmlsZSBpbnNpZGUgdGhlIHZhdWx0IGlmIGNvbmZpZ3VyZWRcbiAgICBjb25zdCBsb2NhbFBhdGggPSB0aGlzLnBsdWdpbi5sb2NhbEpzb25QYXRoO1xuICAgIGlmIChsb2NhbFBhdGgpIHtcbiAgICAgIGNvbnN0IGxvY2FsRmlsZSA9IHRoaXMucGx1Z2luLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgobG9jYWxQYXRoKTtcbiAgICAgIGlmIChsb2NhbEZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICBhd2FpdCB0aGlzLmxvYWRGaWxlKGxvY2FsRmlsZSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBObyBsaW5rZWQgZmlsZXMgZm91bmQgXHUyMDE0IGRvbid0IGNyZWF0ZSBmb2xkZXJzL2ZpbGVzIGF1dG9tYXRpY2FsbHkuIFNob3cgb25ib2FyZGluZy5cbiAgICB0aGlzLmZpbGUgPSBudWxsO1xuICAgIHRoaXMuZGF0YSA9IG51bGw7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGxvYWRGaWxlKGZpbGU6IFRGaWxlKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHBhcnNlZCA9IGF3YWl0IGxvYWRMb2NhbEZpbGUodGhpcy5wbHVnaW4uYXBwLCBmaWxlKTtcbiAgICAgIHRoaXMuZmlsZSA9IGZpbGU7XG4gICAgICB0aGlzLmRhdGEgPSBwYXJzZWQ7XG4gICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zZXRMb2NhbEpzb25QYXRoKGZpbGUucGF0aCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMuZGF0YSA9IG51bGw7XG4gICAgICB0aGlzLmZpbGUgPSBudWxsO1xuICAgICAgbmV3IE5vdGljZShcIlVuYWJsZSB0byByZWFkIHRoZSBKU09OIGZpbGUuXCIpO1xuICAgIH1cbiAgfVxuICBwcml2YXRlIGFzeW5jIHNhdmVEYXRhKCkge1xuICAgIGlmICghdGhpcy5kYXRhKSByZXR1cm47XG4gICAgdGhpcy5kYXRhLnVwZGF0ZWRBdCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICBpZiAodGhpcy5maWxlKSB7XG4gICAgICBhd2FpdCBzYXZlTG9jYWxEYXRhKHRoaXMucGx1Z2luLmFwcCwgdGhpcy5maWxlLCB0aGlzLmRhdGEpO1xuICAgIH1cbiAgfVxuXG5cbiAgcHJpdmF0ZSBhc3luYyByZW5kZXJTZWFyY2hSZXN1bHRzKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIHF1ZXJ5OiBzdHJpbmcpIHtcbiAgICBjb250YWluZXIuZW1wdHkoKTtcbiAgICBpZiAoIXF1ZXJ5IHx8IHF1ZXJ5Lmxlbmd0aCA8IDIpIHJldHVybjtcblxuICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBzZWFyY2hPbWRiKHF1ZXJ5LCB0aGlzLnBsdWdpbi5vbWRiQXBpS2V5KTtcbiAgICBpZiAocmVzdWx0cy5sZW5ndGggPT09IDApIHtcbiAgICAgIGNvbnRhaW5lci5jcmVhdGVFbChcImRpdlwiLCB7IHRleHQ6IFwiTm8gcmVzdWx0cyBmb3VuZC5cIiwgY2xzOiBcImNpbmV2YXVsdC1zZWFyY2gtZW1wdHlcIiB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICByZXN1bHRzLmZvckVhY2goKHJlc3VsdCkgPT4ge1xuICAgICAgY29uc3QgaXRlbSA9IGNvbnRhaW5lci5jcmVhdGVEaXYoeyBjbHM6IFwiY2luZXZhdWx0LXNlYXJjaC1pdGVtXCIgfSk7XG4gICAgICBpZiAocmVzdWx0LnBvc3Rlcikge1xuICAgICAgICBpdGVtLmNyZWF0ZUVsKFwiaW1nXCIsIHsgY2xzOiBcImNpbmV2YXVsdC1zZWFyY2gtcG9zdGVyXCIgfSkuc2V0QXR0cmlidXRlKFwic3JjXCIsIHJlc3VsdC5wb3N0ZXIpO1xuICAgICAgfVxuICAgICAgY29uc3QgaW5mbyA9IGl0ZW0uY3JlYXRlRGl2KHsgY2xzOiBcImNpbmV2YXVsdC1zZWFyY2gtaW5mb1wiIH0pO1xuICAgICAgaW5mby5jcmVhdGVFbChcImRpdlwiLCB7IHRleHQ6IHJlc3VsdC50aXRsZSwgY2xzOiBcImNpbmV2YXVsdC1zZWFyY2gtdGl0bGVcIiB9KTtcbiAgICAgIGluZm8uY3JlYXRlRWwoXCJkaXZcIiwgeyB0ZXh0OiByZXN1bHQueWVhciwgY2xzOiBcImNpbmV2YXVsdC1zZWFyY2gteWVhclwiIH0pO1xuXG4gICAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgIG5ldyBDaW5lVmF1bHRNb3ZpZUFjdGlvbk1vZGFsKHRoaXMucGx1Z2luLmFwcCwgcmVzdWx0LCBhc3luYyAod2F0Y2hlZCkgPT4ge1xuICAgICAgICAgIGlmICghdGhpcy5kYXRhKSByZXR1cm47XG5cbiAgICAgICAgICBjb25zdCBleGlzdGluZyA9IHRoaXMuZGF0YS5tb3ZpZXMuZmluZCgobW92aWUpID0+IG1vdmllLmltZGJJZCA9PT0gcmVzdWx0LmltZGJJZCk7XG4gICAgICAgICAgaWYgKGV4aXN0aW5nKSB7XG4gICAgICAgICAgICBleGlzdGluZy53YXRjaGVkID0gd2F0Y2hlZDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gRmV0Y2ggZnVsbCBtb3ZpZSBkZXRhaWxzIGZyb20gT01EYlxuICAgICAgICAgICAgbmV3IE5vdGljZShgTG9hZGluZyBkZXRhaWxzIGZvciAke3Jlc3VsdC50aXRsZX0uLi5gKTtcbiAgICAgICAgICAgIGNvbnN0IGRldGFpbHMgPSBhd2FpdCBnZXRPbWRiRGV0YWlscyhyZXN1bHQuaW1kYklkLCB0aGlzLnBsdWdpbi5vbWRiQXBpS2V5KTtcblxuICAgICAgICAgICAgaWYgKCFkZXRhaWxzKSB7XG4gICAgICAgICAgICAgIG5ldyBOb3RpY2UoXCJVbmFibGUgdG8gbG9hZCBtb3ZpZSBkZXRhaWxzLlwiKTtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBuZXdNb3ZpZSA9IGNyZWF0ZUVtcHR5TW92aWUoKTtcbiAgICAgICAgICAgIG5ld01vdmllLmltZGJJZCA9IGRldGFpbHMuaW1kYklEIHx8IHJlc3VsdC5pbWRiSWQ7XG4gICAgICAgICAgICBuZXdNb3ZpZS50aXRsZSA9IGRldGFpbHMuVGl0bGUgfHwgcmVzdWx0LnRpdGxlO1xuICAgICAgICAgICAgbmV3TW92aWUueWVhciA9IGRldGFpbHMuWWVhciB8fCByZXN1bHQueWVhcjtcbiAgICAgICAgICAgIG5ld01vdmllLnJhdGVkID0gZGV0YWlscy5SYXRlZCB8fCBcIlwiO1xuICAgICAgICAgICAgbmV3TW92aWUucmVsZWFzZWQgPSBkZXRhaWxzLlJlbGVhc2VkIHx8IFwiXCI7XG4gICAgICAgICAgICBuZXdNb3ZpZS5ydW50aW1lID0gZGV0YWlscy5SdW50aW1lIHx8IFwiXCI7XG4gICAgICAgICAgICBuZXdNb3ZpZS5nZW5yZSA9IGRldGFpbHMuR2VucmUgfHwgXCJcIjtcbiAgICAgICAgICAgIG5ld01vdmllLmRpcmVjdG9yID0gZGV0YWlscy5EaXJlY3RvciB8fCBcIlwiO1xuICAgICAgICAgICAgbmV3TW92aWUud3JpdGVyID0gZGV0YWlscy5Xcml0ZXIgfHwgXCJcIjtcbiAgICAgICAgICAgIG5ld01vdmllLmFjdG9ycyA9IGRldGFpbHMuQWN0b3JzIHx8IFwiXCI7XG4gICAgICAgICAgICBuZXdNb3ZpZS5wbG90ID0gZGV0YWlscy5QbG90IHx8IHJlc3VsdC5wbG90O1xuICAgICAgICAgICAgbmV3TW92aWUubGFuZ3VhZ2UgPSBkZXRhaWxzLkxhbmd1YWdlIHx8IFwiXCI7XG4gICAgICAgICAgICBuZXdNb3ZpZS5jb3VudHJ5ID0gZGV0YWlscy5Db3VudHJ5IHx8IFwiXCI7XG4gICAgICAgICAgICBuZXdNb3ZpZS5hd2FyZHMgPSBkZXRhaWxzLkF3YXJkcyB8fCBcIlwiO1xuICAgICAgICAgICAgbmV3TW92aWUucG9zdGVyID0gZGV0YWlscy5Qb3N0ZXIgJiYgZGV0YWlscy5Qb3N0ZXIgIT09IFwiTi9BXCIgPyBkZXRhaWxzLlBvc3RlciA6IHJlc3VsdC5wb3N0ZXI7XG4gICAgICAgICAgICBuZXdNb3ZpZS5wb3N0ZXJMb2NhbCA9IFwiXCI7XG4gICAgICAgICAgICBuZXdNb3ZpZS5yYXRpbmdzID0gZGV0YWlscy5SYXRpbmdzIHx8IFtdO1xuICAgICAgICAgICAgbmV3TW92aWUubWV0YXNjb3JlID0gZGV0YWlscy5NZXRhc2NvcmUgfHwgXCJcIjtcbiAgICAgICAgICAgIG5ld01vdmllLmltZGJSYXRpbmcgPSBkZXRhaWxzLmltZGJSYXRpbmcgfHwgXCJcIjtcbiAgICAgICAgICAgIG5ld01vdmllLmltZGJWb3RlcyA9IGRldGFpbHMuaW1kYlZvdGVzIHx8IFwiXCI7XG4gICAgICAgICAgICBuZXdNb3ZpZS50eXBlID0gZGV0YWlscy5UeXBlIHx8IHJlc3VsdC50eXBlO1xuICAgICAgICAgICAgbmV3TW92aWUuZHZkID0gZGV0YWlscy5EVkQgfHwgXCJcIjtcbiAgICAgICAgICAgIG5ld01vdmllLmJveE9mZmljZSA9IGRldGFpbHMuQm94T2ZmaWNlIHx8IFwiXCI7XG4gICAgICAgICAgICBuZXdNb3ZpZS5wcm9kdWN0aW9uID0gZGV0YWlscy5Qcm9kdWN0aW9uIHx8IFwiXCI7XG4gICAgICAgICAgICBuZXdNb3ZpZS53ZWJzaXRlID0gZGV0YWlscy5XZWJzaXRlIHx8IFwiXCI7XG4gICAgICAgICAgICBuZXdNb3ZpZS50b3RhbFNlYXNvbnMgPSBkZXRhaWxzLnRvdGFsU2Vhc29ucyB8fCBcIlwiO1xuICAgICAgICAgICAgbmV3TW92aWUud2F0Y2hlZCA9IHdhdGNoZWQ7XG5cbiAgICAgICAgICAgIHRoaXMuZGF0YS5tb3ZpZXMucHVzaChuZXdNb3ZpZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGF3YWl0IHRoaXMuc2F2ZURhdGEoKTtcbiAgICAgICAgICB0aGlzLnJlbmRlcigpO1xuICAgICAgICB9KS5vcGVuKCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxufSIsICJleHBvcnQgZnVuY3Rpb24gcmVuZGVyT25ib2FyZGluZyhcbiAgY29udGFpbmVyOiBIVE1MRWxlbWVudCxcbiAgb25DcmVhdGU6ICgpID0+IHZvaWQsXG4gIG9uTGluaz86ICgpID0+IHZvaWRcbikge1xuICBjb25zdCBvbmJvYXJkaW5nID0gY29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgY2xzOiBcImNpbmV2YXVsdC1vbmJvYXJkaW5nXCJcbiAgfSk7XG5cbiAgY29uc3QgYWN0aW9ucyA9IG9uYm9hcmRpbmcuY3JlYXRlRGl2KHsgY2xzOiBcImNpbmV2YXVsdC1vbmJvYXJkaW5nLWFjdGlvbnNcIiB9KTtcbiAgY29uc3QgY3JlYXRlQnV0dG9uID0gYWN0aW9ucy5jcmVhdGVFbChcImJ1dHRvblwiLCB7IHRleHQ6IFwiQ3JlYXRlIG5ldyBsaWJyYXJ5XCIgfSk7XG5cbiAgaWYgKG9uTGluaykge1xuICAgIGFjdGlvbnMuY3JlYXRlRWwoXCJwXCIsIHsgdGV4dDogXCJvclwiIH0pO1xuICAgIGNvbnN0IGxpbmtCdXR0b24gPSBhY3Rpb25zLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHsgdGV4dDogXCJMaW5rIGV4aXN0aW5nIGxpYnJhcnlcIiB9KTtcbiAgICBsaW5rQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBvbkxpbmsoKTtcbiAgICB9KTtcbiAgfVxuXG4gIGNyZWF0ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIG9uQ3JlYXRlKCk7XG4gIH0pO1xufVxuIiwgImltcG9ydCB7IE1vZGFsIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgdHlwZSB7IENpbmVWYXVsdFNlYXJjaEl0ZW0gfSBmcm9tIFwiLi4vLi4vdHlwZXMvY2luZXZhdWx0XCI7XG5cbmV4cG9ydCBjbGFzcyBDaW5lVmF1bHRNb3ZpZUFjdGlvbk1vZGFsIGV4dGVuZHMgTW9kYWwge1xuICBwcml2YXRlIG1vdmllOiBDaW5lVmF1bHRTZWFyY2hJdGVtO1xuICBwcml2YXRlIG9uU2F2ZTogKHdhdGNoZWQ6IGJvb2xlYW4pID0+IHZvaWQ7XG5cbiAgY29uc3RydWN0b3IoYXBwOiBNb2RhbFtcImFwcFwiXSwgbW92aWU6IENpbmVWYXVsdFNlYXJjaEl0ZW0sIG9uU2F2ZTogKHdhdGNoZWQ6IGJvb2xlYW4pID0+IHZvaWQpIHtcbiAgICBzdXBlcihhcHApO1xuICAgIHRoaXMubW92aWUgPSBtb3ZpZTtcbiAgICB0aGlzLm9uU2F2ZSA9IG9uU2F2ZTtcbiAgfVxuXG4gIG9uT3BlbigpIHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcblxuICAgIGNvbnRlbnRFbC5jcmVhdGVFbChcImgzXCIsIHsgdGV4dDogdGhpcy5tb3ZpZS50aXRsZSB9KTtcbiAgICBjb250ZW50RWwuY3JlYXRlRWwoXCJwXCIsIHsgdGV4dDogYCR7dGhpcy5tb3ZpZS55ZWFyfSBcdTIwMjIgJHt0aGlzLm1vdmllLnR5cGV9YCB9KTtcbiAgICBpZiAodGhpcy5tb3ZpZS5wb3N0ZXIpIHtcbiAgICAgIGNvbnRlbnRFbC5jcmVhdGVFbChcImltZ1wiLCB7IGNsczogXCJjaW5ldmF1bHQtbW9kYWwtcG9zdGVyXCIgfSkuc2V0QXR0cmlidXRlKFwic3JjXCIsIHRoaXMubW92aWUucG9zdGVyKTtcbiAgICB9XG4gICAgY29udGVudEVsLmNyZWF0ZUVsKFwicFwiLCB7IHRleHQ6IHRoaXMubW92aWUucGxvdCB9KTtcblxuICAgIGNvbnN0IGFjdGlvbnMgPSBjb250ZW50RWwuY3JlYXRlRGl2KHsgY2xzOiBcImNpbmV2YXVsdC1tb2RhbC1hY3Rpb25zXCIgfSk7XG4gICAgY29uc3Qgd2F0Y2hlZEJ1dHRvbiA9IGFjdGlvbnMuY3JlYXRlRWwoXCJidXR0b25cIiwgeyB0ZXh0OiBcIk1hcmsgYXMgd2F0Y2hlZFwiIH0pO1xuICAgIGNvbnN0IHRvV2F0Y2hCdXR0b24gPSBhY3Rpb25zLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHsgdGV4dDogXCJUbyB3YXRjaFwiIH0pO1xuXG4gICAgd2F0Y2hlZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5vblNhdmUodHJ1ZSk7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfSk7XG5cbiAgICB0b1dhdGNoQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLm9uU2F2ZShmYWxzZSk7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfSk7XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBNb2RhbCB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHR5cGUgeyBDaW5lVmF1bHRNb3ZpZSB9IGZyb20gXCIuLi8uLi90eXBlcy9jaW5ldmF1bHRcIjtcbmltcG9ydCB7IGNyZWF0ZVN0YXJSYXRpbmcgfSBmcm9tIFwiLi4vc3RhclJhdGluZ1wiO1xuaW1wb3J0IHsgbnVsbFNhZmUgfSBmcm9tIFwic3JjL3V0aWxzXCI7XG5cbmV4cG9ydCBjbGFzcyBDaW5lVmF1bHRNb3ZpZURldGFpbE1vZGFsIGV4dGVuZHMgTW9kYWwge1xuICBwcml2YXRlIG1vdmllOiBDaW5lVmF1bHRNb3ZpZTtcbiAgcHJpdmF0ZSBvblJhdGU6IChyYXRpbmc6IG51bWJlcikgPT4gdm9pZDtcbiAgcHJpdmF0ZSBvblJlbW92ZTogKCkgPT4gdm9pZDtcbiAgcHJpdmF0ZSBvblRvZ2dsZVdhdGNoZWQ6ICgpID0+IHZvaWQ7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgYXBwOiBNb2RhbFtcImFwcFwiXSxcbiAgICBtb3ZpZTogQ2luZVZhdWx0TW92aWUsXG4gICAgb25SYXRlOiAocmF0aW5nOiBudW1iZXIpID0+IHZvaWQsXG4gICAgb25SZW1vdmU6ICgpID0+IHZvaWQsXG4gICAgb25Ub2dnbGVXYXRjaGVkOiAoKSA9PiB2b2lkXG4gICkge1xuICAgIHN1cGVyKGFwcCk7XG4gICAgdGhpcy5tb3ZpZSA9IG1vdmllO1xuICAgIHRoaXMub25SYXRlID0gb25SYXRlO1xuICAgIHRoaXMub25SZW1vdmUgPSBvblJlbW92ZTtcbiAgICB0aGlzLm9uVG9nZ2xlV2F0Y2hlZCA9IG9uVG9nZ2xlV2F0Y2hlZDtcbiAgfVxuXG4gIG9uT3BlbigpIHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcblxuICAgIGNvbnN0IG1vZGFsQ29udGFpbmVyID0gY29udGVudEVsLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwiY2luZXZhdWx0LW1vZGFsLWNvbnRhaW5lclwiXG4gICAgfSk7XG5cbiAgICBtb2RhbENvbnRhaW5lci5jcmVhdGVFbChcImgxXCIsIHtcbiAgICAgIHRleHQ6IHRoaXMubW92aWUudGl0bGUsXG4gICAgICBjbHM6IFwiY2luZXZhdWx0LW1vZGFsLXRpdGxlXCJcbiAgICB9KTtcblxuICAgIC8vIFllYXIgYW5kIFR5cGVcbiAgICBjb25zdCB0eXBlID0gbnVsbFNhZmUoKCkgPT4gdGhpcy5tb3ZpZS50eXBlWzBdLnRvVXBwZXJDYXNlKCkgKyB0aGlzLm1vdmllLnR5cGUuc2xpY2UoMSksIG51bGwpO1xuICAgIGNvbnN0IHllYXIgPSBudWxsU2FmZSgoKSA9PiB0aGlzLm1vdmllLnllYXIsIG51bGwpO1xuICAgIG1vZGFsQ29udGFpbmVyLmNyZWF0ZUVsKFwicFwiLCB7XG4gICAgICB0ZXh0OiBgJHt5ZWFyfSAtICR7dHlwZX1gLFxuICAgIH0pO1xuXG4gICAgLy8gUG9zdGVyXG4gICAgaWYgKHRoaXMubW92aWUucG9zdGVyKSB7XG4gICAgICBtb2RhbENvbnRhaW5lci5jcmVhdGVFbChcImltZ1wiLCB7IGNsczogXCJjaW5ldmF1bHQtbW9kYWwtcG9zdGVyXCIgfSkuc2V0QXR0cmlidXRlKFwic3JjXCIsIHRoaXMubW92aWUucG9zdGVyKTtcbiAgICB9XG5cbiAgICAvLyBQbG90XG4gICAgaWYgKHRoaXMubW92aWUucGxvdCkge1xuICAgICAgY29uc3QgcGxvdENvbnRhaW5lciA9IG1vZGFsQ29udGFpbmVyLmNyZWF0ZUVsKFwiZGl2XCIsIHsgY2xzOiBcImNpbmV2YXVsdC1tb2RhbC1wbG90LWNvbnRhaW5lclwiIH0pO1xuXG4gICAgICBjb25zdCBwbG90RWwgPSBwbG90Q29udGFpbmVyLmNyZWF0ZUVsKFwicFwiLCB7XG4gICAgICAgIHRleHQ6IHRoaXMubW92aWUucGxvdCxcbiAgICAgICAgY2xzOiBcImNpbmV2YXVsdC1tb2RhbC1wbG90XCJcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBzaG93TW9yZUJ1dHRvbiA9IHBsb3RDb250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgICB0ZXh0OiBcIlNob3cgbW9yZVwiLFxuICAgICAgICBjbHM6IFwiY2luZXZhdWx0LW1vZGFsLXNob3ctbW9yZVwiXG4gICAgICB9KTtcblxuICAgICAgLy8gSGlkZSBidXR0b24gYnkgZGVmYXVsdDsgcmV2ZWFsIG9ubHkgaWYgdGhlIHBsb3QgaXMgYWN0dWFsbHkgdHJ1bmNhdGVkXG4gICAgICBzaG93TW9yZUJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cbiAgICAgIHNob3dNb3JlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGlzRXhwYW5kZWQgPSBwbG90RWwuY2xhc3NMaXN0LnRvZ2dsZShcImV4cGFuZGVkLXBsb3RcIik7XG4gICAgICAgIHNob3dNb3JlQnV0dG9uLnNldFRleHQoaXNFeHBhbmRlZCA/IFwiU2hvdyBsZXNzXCIgOiBcIlNob3cgbW9yZVwiKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBXYWl0IGZvciBsYXlvdXQgc28gd2UgY2FuIG1lYXN1cmUgb3ZlcmZsb3dcbiAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG4gICAgICAgIC8vIElmIGNvbnRlbnQgaGVpZ2h0IGV4Y2VlZHMgY29udGFpbmVyIGhlaWdodCwgaXQncyB0cnVuY2F0ZWRcbiAgICAgICAgaWYgKHBsb3RFbC5zY3JvbGxIZWlnaHQgPiBwbG90RWwuY2xpZW50SGVpZ2h0ICsgMSkge1xuICAgICAgICAgIHNob3dNb3JlQnV0dG9uLnN0eWxlLmRpc3BsYXkgPSBcImlubGluZS1ibG9ja1wiO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBHZW5lcmF0ZSBkZXRhaWxzIHNlY3Rpb24gb25seSBpZiBhdCBsZWFzdCBvbmUgZGV0YWlsIGlzIGF2YWlsYWJsZVxuICAgIGZ1bmN0aW9uIHJlZGVyRGV0YWlsU2VjdGlvbih0eXBlOiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgIGNvbnN0IGRldGFpbEVsZW1lbnQgPSBtb2RhbENvbnRhaW5lci5jcmVhdGVFbChcImRpdlwiLCB7IGNsczogXCJjaW5ldmF1bHQtbW9kYWwtZGV0YWlsLWNvbnRhaW5lclwiIH0pO1xuICAgICAgZGV0YWlsRWxlbWVudC5jcmVhdGVFbChcInBcIiwge1xuICAgICAgICB0ZXh0OiBgJHt0eXBlfTpgLFxuICAgICAgICBjbHM6IFwiY2luZXZhdWx0LW1vZGFsLWRldGFpbC1sYWJlbFwiXG4gICAgICB9KTtcbiAgICAgIGRldGFpbEVsZW1lbnQuY3JlYXRlRWwoXCJwXCIsIHtcbiAgICAgICAgdGV4dDogdmFsdWUsXG4gICAgICAgIGNsczogXCJjaW5ldmF1bHQtbW9kYWwtZGV0YWlsLXZhbHVlXCJcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIG1vZGFsQ29udGFpbmVyLmNyZWF0ZUVsKFwiaHJcIik7XG5cbiAgICAvLyBHZW5yZVxuICAgIGlmICh0aGlzLm1vdmllLmdlbnJlKSB7XG4gICAgICByZWRlckRldGFpbFNlY3Rpb24oXCJHZW5yZVwiLCB0aGlzLm1vdmllLmdlbnJlKTtcbiAgICB9XG5cbiAgICAvLyBEaXJlY3RvclxuICAgIGlmICh0aGlzLm1vdmllLmRpcmVjdG9yKSB7XG4gICAgICByZWRlckRldGFpbFNlY3Rpb24oXCJEaXJlY3RvclwiLCB0aGlzLm1vdmllLmRpcmVjdG9yKTtcbiAgICB9XG5cbiAgICAvLyBBY3RvcnNcbiAgICBpZiAodGhpcy5tb3ZpZS5hY3RvcnMpIHtcbiAgICAgIHJlZGVyRGV0YWlsU2VjdGlvbihcIkFjdG9yc1wiLCB0aGlzLm1vdmllLmFjdG9ycyk7XG4gICAgfVxuXG4gICAgbW9kYWxDb250YWluZXIuY3JlYXRlRWwoXCJoclwiKTtcblxuICAgIC8vIFBlcnNvbmFsIFJhdGluZ1xuICAgIGNvbnN0IHJhdGluZ0NvbnRhaW5lciA9IG1vZGFsQ29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwiY2luZXZhdWx0LW1vZGFsLXJhdGluZy1jb250YWluZXJcIlxuICAgIH0pO1xuXG4gICAgcmF0aW5nQ29udGFpbmVyLmNyZWF0ZUVsKFwiZGl2XCIsIHsgdGV4dDogXCJSYXRpbmdcIiwgY2xzOiBcImNpbmV2YXVsdC1tb2RhbC1yYXRpbmctbGFiZWxcIiB9KTtcbiAgICBjb25zdCBzdGFycyA9IGNyZWF0ZVN0YXJSYXRpbmcocmF0aW5nQ29udGFpbmVyLCB0aGlzLm1vdmllLnN0YXJSYXRpbmcsIGZhbHNlLCAocmF0aW5nKSA9PiB7XG4gICAgICB0aGlzLm9uUmF0ZShyYXRpbmcpO1xuICAgIH0pO1xuICAgIHN0YXJzLmNsYXNzTGlzdC5hZGQoXCJjaW5ldmF1bHQtbW9kYWwtc3RhcnNcIik7XG5cbiAgICAvLyBSYXRpbmdzIGZyb20gZXh0ZXJuYWwgc291cmNlc1xuICAgIGlmICh0aGlzLm1vdmllLnJhdGluZ3MpIHtcbiAgICAgIGNvbnN0IGV4dGVybmFsUmF0aW5nc0NvbnRhaW5lciA9IG1vZGFsQ29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJjaW5ldmF1bHQtbW9kYWwtZXh0ZXJuYWwtcmF0aW5nc1wiXG4gICAgICB9KTtcblxuICAgICAgY29uc29sZS5sb2coJ3RoaXMubW92aWUucmF0aW5ncycsIHRoaXMubW92aWUucmF0aW5ncylcblxuICAgICAgZm9yIChjb25zdCByYXRpbmcgb2YgdGhpcy5tb3ZpZS5yYXRpbmdzKSB7XG4gICAgICAgIGNvbnN0IHJhdGluZ0VsID0gZXh0ZXJuYWxSYXRpbmdzQ29udGFpbmVyLmNyZWF0ZURpdih7IGNsczogXCJjaW5ldmF1bHQtbW9kYWwtZXh0ZXJuYWwtcmF0aW5nLWVsZW1lbnRcIiB9KTtcbiAgICAgICAgcmF0aW5nRWwuY3JlYXRlRWwoXCJkaXZcIiwgeyB0ZXh0OiByYXRpbmcuU291cmNlLCBjbHM6IFwiY2luZXZhdWx0LW1vZGFsLWV4dGVybmFsLXJhdGluZy1zb3VyY2VcIiB9KTtcbiAgICAgICAgcmF0aW5nRWwuY3JlYXRlRWwoXCJkaXZcIiwgeyB0ZXh0OiByYXRpbmcuVmFsdWUsIGNsczogXCJjaW5ldmF1bHQtbW9kYWwtZXh0ZXJuYWwtcmF0aW5nLXZhbHVlXCIgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgYWN0aW9ucyA9IG1vZGFsQ29udGFpbmVyLmNyZWF0ZURpdih7IGNsczogXCJjaW5ldmF1bHQtbW9kYWwtYWN0aW9uc1wiIH0pO1xuICAgIGNvbnN0IHRvZ2dsZVdhdGNoZWRMYWJlbCA9IHRoaXMubW92aWUud2F0Y2hlZCA/IFwiTWFyayBhcyB0byB3YXRjaFwiIDogXCJNYXJrIGFzIHdhdGNoZWRcIjtcbiAgICBjb25zdCB0b2dnbGVXYXRjaGVkQnV0dG9uID0gYWN0aW9ucy5jcmVhdGVFbChcImJ1dHRvblwiLCB7IHRleHQ6IHRvZ2dsZVdhdGNoZWRMYWJlbCB9KTtcbiAgICBjb25zdCByZW1vdmVCdXR0b24gPSBhY3Rpb25zLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHsgdGV4dDogXCJSZW1vdmVcIiwgY2xzOiBcImNpbmV2YXVsdC1kYW5nZXJcIiB9KTtcblxuICAgIHRvZ2dsZVdhdGNoZWRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMub25Ub2dnbGVXYXRjaGVkKCk7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfSk7XG5cbiAgICByZW1vdmVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMub25SZW1vdmUoKTtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9KTtcbiAgfVxufVxuIiwgImV4cG9ydCBmdW5jdGlvbiBjcmVhdGVTdGFyUmF0aW5nKFxuICBjb250YWluZXI6IEhUTUxFbGVtZW50LFxuICByYXRpbmc6IG51bWJlcixcbiAgcmVhZE9ubHk6IGJvb2xlYW4sXG4gIG9uQ2hhbmdlPzogKHJhdGluZzogbnVtYmVyKSA9PiB2b2lkXG4pIHtcbiAgY29uc3Qgc3RhcnMgPSBjb250YWluZXIuY3JlYXRlRGl2KHsgY2xzOiBcImNpbmV2YXVsdC1zdGFyc1wiIH0pO1xuICBjb25zdCBzdGFyRWxlbWVudHM6IEhUTUxTcGFuRWxlbWVudFtdID0gW107XG4gIGxldCBjdXJyZW50UmF0aW5nID0gcmF0aW5nO1xuXG4gIGZvciAobGV0IGkgPSAxOyBpIDw9IDU7IGkgKz0gMSkge1xuICAgIGNvbnN0IHN0YXIgPSBzdGFycy5jcmVhdGVFbChcInNwYW5cIiwgeyB0ZXh0OiBcIlx1MjYwNVwiLCBjbHM6IFwiY2luZXZhdWx0LXN0YXJcIiB9KTtcbiAgICBpZiAoaSA8PSByYXRpbmcpIHN0YXIuY2xhc3NMaXN0LmFkZChcImFjdGl2ZVwiKTtcbiAgICBzdGFyRWxlbWVudHMucHVzaChzdGFyKTtcbiAgICBpZiAoIXJlYWRPbmx5KSB7XG4gICAgICBzdGFyLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgIC8vIElmIGNsaWNraW5nIHRoZSBzYW1lIHN0YXIgdGhhdCdzIGFscmVhZHkgc2VsZWN0ZWQsIHJlc2V0IHRvIDBcbiAgICAgICAgaWYgKGN1cnJlbnRSYXRpbmcgPT09IGkpIHtcbiAgICAgICAgICBjdXJyZW50UmF0aW5nID0gMDtcbiAgICAgICAgICBzdGFyRWxlbWVudHMuZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xuICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwiYWN0aXZlXCIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGN1cnJlbnRSYXRpbmcgPSBpO1xuICAgICAgICAgIHN0YXJFbGVtZW50cy5mb3JFYWNoKChlbGVtZW50LCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QudG9nZ2xlKFwiYWN0aXZlXCIsIGluZGV4IDwgaSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgb25DaGFuZ2U/LihjdXJyZW50UmF0aW5nKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBzdGFyLmNsYXNzTGlzdC5hZGQoXCJyZWFkb25seVwiKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHN0YXJzO1xufVxuIiwgImV4cG9ydCBmdW5jdGlvbiBsb2dnZXIobWVzc2FnZTogc3RyaW5nLCBjb2xvcjogc3RyaW5nID0gJ3doaXRlJykge1xuICBjb25zb2xlLmxvZyhgJWMgJHttZXNzYWdlfWAsIGBiYWNrZ3JvdW5kOiAke2NvbG9yfTsgY29sb3I6IGJsYWNrOyBwYWRkaW5nOiA2cHggOHB4YCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBudWxsU2FmZShmdW5jOiBhbnksIGZhbGxiYWNrVmFsdWU6IGFueSA9IG51bGwpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB2YWx1ZSA9IGZ1bmMoKTtcbiAgICByZXR1cm4gdmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCA/IGZhbGxiYWNrVmFsdWUgOiB2YWx1ZTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHJldHVybiBmYWxsYmFja1ZhbHVlO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBTdWdnZXN0TW9kYWwsIFRGaWxlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5cbmV4cG9ydCBjbGFzcyBKc29uRmlsZVN1Z2dlc3RNb2RhbCBleHRlbmRzIFN1Z2dlc3RNb2RhbDxURmlsZT4ge1xuICBwcml2YXRlIGpzb25GaWxlczogVEZpbGVbXTtcbiAgcHJpdmF0ZSBvblNlbGVjdDogKGZpbGU6IFRGaWxlKSA9PiB2b2lkO1xuXG4gIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBvblNlbGVjdDogKGZpbGU6IFRGaWxlKSA9PiB2b2lkKSB7XG4gICAgc3VwZXIoYXBwKTtcbiAgICB0aGlzLm9uU2VsZWN0ID0gb25TZWxlY3Q7XG4gICAgdGhpcy5qc29uRmlsZXMgPSB0aGlzLmFwcC52YXVsdC5nZXRGaWxlcygpLmZpbHRlcigoZikgPT4gZi5leHRlbnNpb24gPT09IFwianNvblwiKTtcbiAgICB0aGlzLnNldFBsYWNlaG9sZGVyKFwiU2VsZWN0IGEgSlNPTiBmaWxlIGZyb20geW91ciB2YXVsdC4uLlwiKTtcbiAgfVxuXG4gIGdldFN1Z2dlc3Rpb25zKHF1ZXJ5OiBzdHJpbmcpOiBURmlsZVtdIHtcbiAgICBjb25zdCBsb3dlclF1ZXJ5ID0gcXVlcnkudG9Mb3dlckNhc2UoKTtcbiAgICByZXR1cm4gdGhpcy5qc29uRmlsZXMuZmlsdGVyKChmaWxlKSA9PlxuICAgICAgZmlsZS5wYXRoLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMobG93ZXJRdWVyeSlcbiAgICApO1xuICB9XG5cbiAgcmVuZGVyU3VnZ2VzdGlvbihmaWxlOiBURmlsZSwgZWw6IEhUTUxFbGVtZW50KSB7XG4gICAgZWwuY3JlYXRlRWwoXCJkaXZcIiwgeyB0ZXh0OiBmaWxlLnBhdGggfSk7XG4gIH1cblxuICBvbkNob29zZVN1Z2dlc3Rpb24oZmlsZTogVEZpbGUsIGV2dDogTW91c2VFdmVudCB8IEtleWJvYXJkRXZlbnQpIHtcbiAgICB0aGlzLm9uU2VsZWN0KGZpbGUpO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBURmlsZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHR5cGUgeyBDaW5lVmF1bHREYXRhLCBDaW5lVmF1bHRNb3ZpZSB9IGZyb20gXCIuLi90eXBlcy9jaW5ldmF1bHRcIjtcblxuY29uc3QgRk9MREVSID0gXCJjaW5ldmF1bHQtanNvblwiO1xuY29uc3QgREVGQVVMVF9OQU1FID0gXCJjaW5ldmF1bHQuanNvblwiO1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RGVmYXVsdFBhdGgoKSB7XG4gIHJldHVybiBgJHtGT0xERVJ9LyR7REVGQVVMVF9OQU1FfWA7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRGb2xkZXIoKSB7XG4gIHJldHVybiBGT0xERVI7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVFbXB0eU1vdmllKCk6IENpbmVWYXVsdE1vdmllIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogY3J5cHRvLnJhbmRvbVVVSUQoKSxcbiAgICBpbWRiSWQ6IFwiXCIsXG4gICAgdGl0bGU6IFwiXCIsXG4gICAgeWVhcjogXCJcIixcbiAgICByYXRlZDogXCJcIixcbiAgICByZWxlYXNlZDogXCJcIixcbiAgICBydW50aW1lOiBcIlwiLFxuICAgIGdlbnJlOiBcIlwiLFxuICAgIGRpcmVjdG9yOiBcIlwiLFxuICAgIHdyaXRlcjogXCJcIixcbiAgICBhY3RvcnM6IFwiXCIsXG4gICAgcGxvdDogXCJcIixcbiAgICBsYW5ndWFnZTogXCJcIixcbiAgICBjb3VudHJ5OiBcIlwiLFxuICAgIGF3YXJkczogXCJcIixcbiAgICBwb3N0ZXI6IFwiXCIsXG4gICAgcG9zdGVyTG9jYWw6IFwiXCIsXG4gICAgcmF0aW5nczogW10sXG4gICAgbWV0YXNjb3JlOiBcIlwiLFxuICAgIGltZGJSYXRpbmc6IFwiXCIsXG4gICAgaW1kYlZvdGVzOiBcIlwiLFxuICAgIHR5cGU6IFwiXCIsXG4gICAgZHZkOiBcIlwiLFxuICAgIGJveE9mZmljZTogXCJcIixcbiAgICBwcm9kdWN0aW9uOiBcIlwiLFxuICAgIHdlYnNpdGU6IFwiXCIsXG4gICAgdG90YWxTZWFzb25zOiBcIlwiLFxuICAgIHRvbWF0b1VSTDogXCJcIixcbiAgICB0b21hdG9NZXRlcjogXCJcIixcbiAgICB0b21hdG9JbWFnZTogXCJcIixcbiAgICB0b21hdG9SYXRpbmc6IFwiXCIsXG4gICAgdG9tYXRvUmV2aWV3czogXCJcIixcbiAgICB0b21hdG9GcmVzaDogXCJcIixcbiAgICB0b21hdG9Sb3R0ZW46IFwiXCIsXG4gICAgdG9tYXRvQ29uc2Vuc3VzOiBcIlwiLFxuICAgIHRvbWF0b1VzZXJNZXRlcjogXCJcIixcbiAgICB0b21hdG9Vc2VyUmF0aW5nOiBcIlwiLFxuICAgIHRvbWF0b1VzZXJSZXZpZXdzOiBcIlwiLFxuICAgIHN0YXJSYXRpbmc6IDAsXG4gICAgd2F0Y2hlZDogZmFsc2UsXG4gICAgbm90ZXM6IFwiXCJcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURlZmF1bHREYXRhKCk6IENpbmVWYXVsdERhdGEge1xuICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gIHJldHVybiB7XG4gICAgc2NoZW1hVmVyc2lvbjogMSxcbiAgICBjcmVhdGVkQXQ6IG5vdyxcbiAgICB1cGRhdGVkQXQ6IG5vdyxcbiAgICBsaWJyYXJ5TmFtZTogXCJDaW5lVmF1bHRcIixcbiAgICBvd25lcjogXCJcIixcbiAgICBzb3VyY2U6IFwiQ2luZVZhdWx0XCIsXG4gICAgbW92aWVzOiBbXVxuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbm9ybWFsaXplRGF0YShkYXRhOiBDaW5lVmF1bHREYXRhKTogQ2luZVZhdWx0RGF0YSB7XG4gIHJldHVybiB7XG4gICAgLi4uZGF0YSxcbiAgICBtb3ZpZXM6IGRhdGEubW92aWVzLm1hcCgobW92aWUpID0+ICh7XG4gICAgICAuLi5jcmVhdGVFbXB0eU1vdmllKCksXG4gICAgICAuLi5tb3ZpZSxcbiAgICAgIHllYXI6IG1vdmllLnllYXIgPyBTdHJpbmcobW92aWUueWVhcikgOiBcIlwiLFxuICAgICAgc3RhclJhdGluZzogdHlwZW9mIG1vdmllLnN0YXJSYXRpbmcgPT09IFwibnVtYmVyXCIgPyBtb3ZpZS5zdGFyUmF0aW5nIDogMFxuICAgIH0pKVxuICB9O1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZW5zdXJlRm9sZGVyKGFwcDogQXBwKSB7XG4gIGlmICghYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChGT0xERVIpKSB7XG4gICAgYXdhaXQgYXBwLnZhdWx0LmNyZWF0ZUZvbGRlcihGT0xERVIpO1xuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVKc29uRmlsZShhcHA6IEFwcCk6IFByb21pc2U8VEZpbGU+IHtcbiAgYXdhaXQgZW5zdXJlRm9sZGVyKGFwcCk7XG4gIGNvbnN0IGV4aXN0aW5nID0gYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChnZXREZWZhdWx0UGF0aCgpKTtcbiAgY29uc3QgZmlsZW5hbWUgPSBleGlzdGluZyA/IGBjaW5ldmF1bHQtJHtEYXRlLm5vdygpfS5qc29uYCA6IERFRkFVTFRfTkFNRTtcbiAgY29uc3QgcGF0aCA9IGAke0ZPTERFUn0vJHtmaWxlbmFtZX1gO1xuXG4gIHJldHVybiBhcHAudmF1bHQuY3JlYXRlKHBhdGgsIEpTT04uc3RyaW5naWZ5KGNyZWF0ZURlZmF1bHREYXRhKCksIG51bGwsIDIpKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvYWRMb2NhbEZpbGUoYXBwOiBBcHAsIGZpbGU6IFRGaWxlKTogUHJvbWlzZTxDaW5lVmF1bHREYXRhPiB7XG4gIGNvbnN0IHJhdyA9IGF3YWl0IGFwcC52YXVsdC5yZWFkKGZpbGUpO1xuICBjb25zdCBwYXJzZWQgPSBKU09OLnBhcnNlKHJhdykgYXMgQ2luZVZhdWx0RGF0YTtcbiAgaWYgKCFwYXJzZWQgfHwgIUFycmF5LmlzQXJyYXkocGFyc2VkLm1vdmllcykpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJGb3JtYXRvIEpTT04gbm9uIHZhbGlkb1wiKTtcbiAgfVxuICByZXR1cm4gbm9ybWFsaXplRGF0YShwYXJzZWQpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2F2ZUxvY2FsRGF0YShhcHA6IEFwcCwgZmlsZTogVEZpbGUsIGRhdGE6IENpbmVWYXVsdERhdGEpIHtcbiAgYXdhaXQgYXBwLnZhdWx0Lm1vZGlmeShmaWxlLCBKU09OLnN0cmluZ2lmeShkYXRhLCBudWxsLCAyKSk7XG59XG4iLCAiaW1wb3J0IHsgcmVxdWVzdFVybCB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHR5cGUgeyBDaW5lVmF1bHRTZWFyY2hJdGVtLCBPbWRiRGV0YWlsZWRSZXNwb25zZSB9IGZyb20gXCIuLi90eXBlcy9jaW5ldmF1bHRcIjtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNlYXJjaE9tZGIocXVlcnk6IHN0cmluZywgYXBpS2V5OiBzdHJpbmcpOiBQcm9taXNlPENpbmVWYXVsdFNlYXJjaEl0ZW1bXT4ge1xuICBpZiAoIWFwaUtleSkge1xuICAgIHJldHVybiBbXTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc3QgdXJsID0gYGh0dHBzOi8vd3d3Lm9tZGJhcGkuY29tLz9hcGlrZXk9JHthcGlLZXl9JnM9JHtlbmNvZGVVUklDb21wb25lbnQocXVlcnkpfWA7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0VXJsKHVybCk7XG4gICAgY29uc3QgZGF0YSA9IHJlc3BvbnNlLmpzb24gYXMge1xuICAgICAgU2VhcmNoPzogQXJyYXk8eyBUaXRsZTogc3RyaW5nOyBZZWFyOiBzdHJpbmc7IGltZGJJRDogc3RyaW5nOyBUeXBlOiBzdHJpbmc7IFBvc3Rlcjogc3RyaW5nIH0+O1xuICAgIH07XG5cbiAgICBpZiAoZGF0YT8uU2VhcmNoKSB7XG4gICAgICByZXR1cm4gZGF0YS5TZWFyY2gubWFwKChpdGVtKSA9PiAoe1xuICAgICAgICBpbWRiSWQ6IGl0ZW0uaW1kYklELFxuICAgICAgICB0aXRsZTogaXRlbS5UaXRsZSxcbiAgICAgICAgeWVhcjogaXRlbS5ZZWFyLFxuICAgICAgICB0eXBlOiBpdGVtLlR5cGUsXG4gICAgICAgIHBvc3RlcjogaXRlbS5Qb3N0ZXIgJiYgaXRlbS5Qb3N0ZXIgIT09IFwiTi9BXCIgPyBpdGVtLlBvc3RlciA6IFwiXCIsXG4gICAgICAgIHBsb3Q6IFwiXCJcbiAgICAgIH0pKTtcbiAgICB9XG5cbiAgICByZXR1cm4gW107XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIHNlYXJjaGluZyBPTURiOlwiLCBlcnJvcik7XG4gICAgcmV0dXJuIFtdO1xuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRPbWRiRGV0YWlscyhpbWRiSWQ6IHN0cmluZywgYXBpS2V5OiBzdHJpbmcsIGRlcHRoOiBudW1iZXIgPSAwKTogUHJvbWlzZTxPbWRiRGV0YWlsZWRSZXNwb25zZSB8IG51bGw+IHtcbiAgLy8gUmV0cnkgbGltaXRcbiAgaWYgKGRlcHRoID49IDMpIHtcbiAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gZmV0Y2ggbW92aWUgZGV0YWlscyBhZnRlciAke2RlcHRofSBhdHRlbXB0c2ApO1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgaWYgKCFhcGlLZXkpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc3QgdXJsID0gYGh0dHBzOi8vd3d3Lm9tZGJhcGkuY29tLz9hcGlrZXk9JHthcGlLZXl9Jmk9JHtpbWRiSWR9JnBsb3Q9ZnVsbCZ0b21hdG9lcz10cnVlYDtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3RVcmwodXJsKTtcblxuICAgIGNvbnN0IGRhdGEgPSByZXNwb25zZS5qc29uIGFzIE9tZGJEZXRhaWxlZFJlc3BvbnNlICYgeyBSZXNwb25zZTogc3RyaW5nIH07XG5cbiAgICBpZiAoZGF0YS5SZXNwb25zZSAhPT0gXCJUcnVlXCIpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJPTURiIEFQSSByZXR1cm5lZCBlcnJvciByZXNwb25zZVwiLCBkYXRhKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHJldHVybiBkYXRhO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBtb3ZpZSBkZXRhaWxzLCByZXRyeWluZy4uLlwiLCBlcnJvcik7XG4gICAgcmV0dXJuIGdldE9tZGJEZXRhaWxzKGltZGJJZCwgYXBpS2V5LCBkZXB0aCArIDEpO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgQXBwLCBQbHVnaW5TZXR0aW5nVGFiLCBTZXR0aW5nLCBOb3RpY2UsIFRGaWxlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgQ2luZVZhdWx0VmlldyBmcm9tIFwiLi4vdmlld3MvQ2luZVZhdWx0Vmlld1wiO1xuaW1wb3J0IHsgVklFV19UWVBFIH0gZnJvbSBcIi4uL2NvbnN0YW50c1wiO1xuaW1wb3J0IENpbmVWYXVsdFBsdWdpbiBmcm9tIFwiLi4vbWFpblwiO1xuaW1wb3J0IHsgY3JlYXRlRGVmYXVsdERhdGEsIGNyZWF0ZUpzb25GaWxlLCBnZXREZWZhdWx0UGF0aCwgZ2V0Rm9sZGVyLCBzYXZlTG9jYWxEYXRhIH0gZnJvbSBcIi4uL3NlcnZpY2VzL2xpYnJhcnlTdG9yYWdlXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENpbmVWYXVsdFNldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcbiAgcGx1Z2luOiBDaW5lVmF1bHRQbHVnaW47XG5cbiAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogQ2luZVZhdWx0UGx1Z2luKSB7XG4gICAgc3VwZXIoYXBwLCBwbHVnaW4pO1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICB9XG5cbiAgZGlzcGxheSgpOiB2b2lkIHtcbiAgICBjb25zdCB7IGNvbnRhaW5lckVsIH0gPSB0aGlzO1xuXG4gICAgY29udGFpbmVyRWwuZW1wdHkoKTtcblxuICAgIC8vIFNldHRpbmdzXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpLnNldE5hbWUoXCJTZXR0aW5nc1wiKS5zZXRIZWFkaW5nKCk7XG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIk9NRGIgQVBJIGtleVwiKVxuICAgICAgLnNldERlc2MoXCJFbnRlciB5b3VyIE9NRGIgQVBJIGtleS4gWW91IGNhbiBnZXQgb25lIGZvciBmcmVlIGF0IG9tZGJhcGkuY29tXCIpXG4gICAgICAuYWRkVGV4dCh0ZXh0ID0+IHRleHRcbiAgICAgICAgLnNldFBsYWNlaG9sZGVyKFwiRW50ZXIgeW91ciBBUEkga2V5XCIpXG4gICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5vbWRiQXBpS2V5KVxuICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2V0T21kYkFwaUtleSh2YWx1ZSk7XG4gICAgICAgIH0pKTtcblxuICAgIC8vIEV4dGVybmFsIGxpYnJhcnkgc3VwcG9ydCByZW1vdmVkLlxuXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIkxpbmtlZCBsb2NhbCBsaWJyYXJ5XCIpXG4gICAgICAuc2V0RGVzYyhcbiAgICAgICAgdGhpcy5wbHVnaW4ubG9jYWxKc29uUGF0aFxuICAgICAgICAgID8gYExvY2FsIGZpbGU6ICR7dGhpcy5wbHVnaW4ubG9jYWxKc29uUGF0aH1gXG4gICAgICAgICAgOiBcIk5vIGxvY2FsIGxpYnJhcnkgbGlua2VkXCJcbiAgICAgIClcbiAgICAgIC5hZGREcm9wZG93bihkcm9wID0+IHtcbiAgICAgICAgY29uc3QgZmlsZXMgPSB0aGlzLmFwcC52YXVsdC5nZXRGaWxlcygpLmZpbHRlcigoZikgPT4gZi5leHRlbnNpb24gPT09IFwianNvblwiKTtcbiAgICAgICAgY29uc3Qgb3B0aW9uczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHsgXCJcIjogXCItLSBOb25lIC0tXCIgfTtcbiAgICAgICAgZmlsZXMuZm9yRWFjaCgoZikgPT4gKG9wdGlvbnNbZi5wYXRoXSA9IGYucGF0aCkpO1xuICAgICAgICBkcm9wLmFkZE9wdGlvbnMob3B0aW9ucykuc2V0VmFsdWUodGhpcy5wbHVnaW4ubG9jYWxKc29uUGF0aCA/PyBcIlwiKS5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICBjb25zdCBwYXRoID0gdmFsdWUgfHwgbnVsbDtcbiAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zZXRMb2NhbEpzb25QYXRoKHBhdGgpO1xuICAgICAgICAgIGF3YWl0IHRoaXMucmVmcmVzaE9wZW5WaWV3cygpO1xuICAgICAgICAgIHRoaXMuZGlzcGxheSgpO1xuICAgICAgICB9KTtcbiAgICAgIH0pXG4gICAgICAuYWRkQnV0dG9uKGJ1dHRvbiA9PiBidXR0b25cbiAgICAgICAgLnNldEJ1dHRvblRleHQoXCJVbmxpbmsgbG9jYWxcIilcbiAgICAgICAgLnNldERpc2FibGVkKCF0aGlzLnBsdWdpbi5sb2NhbEpzb25QYXRoKVxuICAgICAgICAub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2V0TG9jYWxKc29uUGF0aChudWxsKTtcbiAgICAgICAgICBhd2FpdCB0aGlzLnJlZnJlc2hPcGVuVmlld3MoKTtcbiAgICAgICAgICB0aGlzLmRpc3BsYXkoKTtcbiAgICAgICAgfSkpO1xuXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIkNyZWF0ZSBuZXcgbGlicmFyeVwiKVxuICAgICAgLnNldERlc2MoXCJDcmVhdGUgYSBuZXcgZW1wdHkgbG9jYWwgbGlicmFyeSBmcm9tIHNjcmF0Y2guIFRoaXMgd2lsbCB1bmxpbmsgYW55IGV4dGVybmFsIGxpYnJhcnkuXCIpXG4gICAgICAuYWRkQnV0dG9uKGJ1dHRvbiA9PiBidXR0b25cbiAgICAgICAgLnNldEJ1dHRvblRleHQoXCJDcmVhdGUgbGlicmFyeVwiKVxuICAgICAgICAub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgYXdhaXQgdGhpcy5jcmVhdGVOZXdMaWJyYXJ5KCk7XG4gICAgICAgIH0pKTtcblxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoXCJFeHBvcnQgbGlicmFyeVwiKVxuICAgICAgLnNldERlc2MoXCJTYXZlIGEgY29weSBvZiB5b3VyIGxpYnJhcnkgSlNPTiB0byBhIGZpbGUuXCIpXG4gICAgICAuYWRkQnV0dG9uKGJ1dHRvbiA9PiBidXR0b25cbiAgICAgICAgLnNldEJ1dHRvblRleHQoXCJFeHBvcnQgSlNPTlwiKVxuICAgICAgICAub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgYXdhaXQgdGhpcy5leHBvcnRMaWJyYXJ5SnNvbigpO1xuICAgICAgICB9KSk7XG5cbiAgICAvLyBCdWdmaXhcbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbCkuc2V0TmFtZShcIkJ1Z2ZpeFwiKS5zZXRIZWFkaW5nKCk7XG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIlJlcG9ydCBpc3N1ZXNcIilcbiAgICAgIC5zZXREZXNjKFwiSWYgeW91IGVuY291bnRlciBhbnkgaXNzdWVzIHdpdGggdGhlIHBsdWdpbiwgcGxlYXNlIHJlcG9ydCB0aGVtIG9uIEdpdEh1Yi4gWW91ciBmZWVkYmFjayBpcyBpbnZhbHVhYmxlIGZvciBpbXByb3ZpbmcgQ2luZVZhdWx0IVwiKVxuICAgICAgLmFkZEJ1dHRvbihidXR0b24gPT4gYnV0dG9uXG4gICAgICAgIC5zZXRCdXR0b25UZXh0KFwiR2l0SHViXCIpXG4gICAgICAgIC5vbkNsaWNrKCgpID0+IHtcbiAgICAgICAgICB3aW5kb3cub3BlbihcImh0dHBzOi8vZ2l0aHViLmNvbS92c2NhcGVycm90dGEvb2JzaWRpYW4tcGx1Z2luLWNpbmV2YXVsdC9pc3N1ZXNcIiwgXCJfYmxhbmtcIik7XG4gICAgICAgIH0pKTtcblxuICAgIC8vIFN1cHBvcnQgYW5kIGRvbmF0aW9uXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpLnNldE5hbWUoXCJTdXBwb3J0XCIpLnNldEhlYWRpbmcoKTtcbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiRG9uYXRlXCIpXG4gICAgICAuc2V0RGVzYyhcbiAgICAgICAgXCJJZiB5b3UgbGlrZSB0aGlzIFBsdWdpbiwgY29uc2lkZXIgZG9uYXRpbmcgdG8gc3VwcG9ydCBjb250aW51ZWQgZGV2ZWxvcG1lbnQuXCJcbiAgICAgIClcbiAgICAgIC5hZGRCdXR0b24oKGJ0KSA9PiB7XG4gICAgICAgIGJ0LmJ1dHRvbkVsLm91dGVySFRNTCA9XG4gICAgICAgICAgXCI8YSBocmVmPSdodHRwczovL2tvLWZpLmNvbS9UNlQwMVRYODA3JyB0YXJnZXQ9J19ibGFuayc+PGltZyBoZWlnaHQ9JzM2JyBzdHlsZT0nYm9yZGVyOjBweDtoZWlnaHQ6MzZweDsnIHNyYz0naHR0cHM6Ly9zdG9yYWdlLmtvLWZpLmNvbS9jZG4va29maTYucG5nP3Y9NicgYm9yZGVyPScwJyBhbHQ9J0J1eSBNZSBhIENvZmZlZSBhdCBrby1maS5jb20nIC8+PC9hPlwiO1xuICAgICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGV4cG9ydExpYnJhcnlKc29uKCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5nZXRMaWJyYXJ5SnNvbkNvbnRlbnQoKTtcbiAgICAgIGlmICghY29udGVudCkge1xuICAgICAgICBuZXcgTm90aWNlKFwiTm8gbGlicmFyeSBmaWxlIGZvdW5kIHRvIGV4cG9ydC5cIik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gQ3JlYXRlIGV4cG9ydCBmaWxlIGluc2lkZSB2YXVsdCBmb3IgbW9iaWxlIGNvbXBhdGliaWxpdHlcbiAgICAgIGNvbnN0IHRpbWVzdGFtcCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5yZXBsYWNlKC9bOi5dL2csIFwiLVwiKS5zbGljZSgwLCAxOSk7XG4gICAgICBjb25zdCBleHBvcnRQYXRoID0gYGNpbmV2YXVsdC1leHBvcnQtJHt0aW1lc3RhbXB9Lmpzb25gO1xuXG4gICAgICAvLyBDaGVjayBpZiBmaWxlIGV4aXN0cywgaWYgc28gYWRkIGEgY291bnRlclxuICAgICAgbGV0IGZpbmFsUGF0aCA9IGV4cG9ydFBhdGg7XG4gICAgICBsZXQgY291bnRlciA9IDE7XG4gICAgICB3aGlsZSAodGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZpbmFsUGF0aCkpIHtcbiAgICAgICAgZmluYWxQYXRoID0gYGNpbmV2YXVsdC1leHBvcnQtJHt0aW1lc3RhbXB9LSR7Y291bnRlcn0uanNvbmA7XG4gICAgICAgIGNvdW50ZXIrKztcbiAgICAgIH1cblxuICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlKGZpbmFsUGF0aCwgY29udGVudCk7XG4gICAgICBuZXcgTm90aWNlKGBMaWJyYXJ5IGV4cG9ydGVkIHRvICR7ZmluYWxQYXRofWApO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiW0NpbmVWYXVsdF0gRXhwb3J0IGxpYnJhcnkgZXJyb3JcIiwgZXJyb3IpO1xuICAgICAgbmV3IE5vdGljZShcIlVuYWJsZSB0byBleHBvcnQgdGhlIGxpYnJhcnkuXCIpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgY3JlYXRlTmV3TGlicmFyeSgpIHtcbiAgICBjb25zdCBjb25maXJtZWQgPSB3aW5kb3cuY29uZmlybShcbiAgICAgIFwiQ3JlYXRlIGEgbmV3IGVtcHR5IENpbmVWYXVsdCBsaWJyYXJ5PyBUaGlzIHdpbGwgdW5saW5rIGFueSBleHRlcm5hbCBsaWJyYXJ5IGFuZCByZXNldCB5b3VyIGxvY2FsIGxpYnJhcnkgZGF0YS5cIlxuICAgICk7XG4gICAgaWYgKCFjb25maXJtZWQpIHJldHVybjtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBkZWZhdWx0RmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChnZXREZWZhdWx0UGF0aCgpKTtcbiAgICAgIGxldCBjcmVhdGVkRmlsZTogVEZpbGUgfCB1bmRlZmluZWQ7XG4gICAgICBpZiAoZGVmYXVsdEZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICBhd2FpdCBzYXZlTG9jYWxEYXRhKHRoaXMuYXBwLCBkZWZhdWx0RmlsZSwgY3JlYXRlRGVmYXVsdERhdGEoKSk7XG4gICAgICAgIGNyZWF0ZWRGaWxlID0gZGVmYXVsdEZpbGUgYXMgVEZpbGU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjcmVhdGVkRmlsZSA9IGF3YWl0IGNyZWF0ZUpzb25GaWxlKHRoaXMuYXBwKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGNyZWF0ZWRGaWxlKSB7XG4gICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNldExvY2FsSnNvblBhdGgoY3JlYXRlZEZpbGUucGF0aCk7XG4gICAgICB9XG4gICAgICBhd2FpdCB0aGlzLnJlZnJlc2hPcGVuVmlld3MoKTtcbiAgICAgIHRoaXMuZGlzcGxheSgpO1xuICAgICAgbmV3IE5vdGljZShcIk5ldyBsaWJyYXJ5IGNyZWF0ZWQuXCIpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiW0NpbmVWYXVsdF0gQ3JlYXRlIG5ldyBsaWJyYXJ5IGVycm9yXCIsIGVycm9yKTtcbiAgICAgIG5ldyBOb3RpY2UoXCJVbmFibGUgdG8gY3JlYXRlIGEgbmV3IGxpYnJhcnkuXCIpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2V0TGlicmFyeUpzb25Db250ZW50KCk6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4ge1xuICAgIC8vIFByZWZlciBhIGxvY2FsIGxpbmtlZCBmaWxlIGluc2lkZSB0aGUgdmF1bHRcbiAgICBpZiAoKHRoaXMucGx1Z2luIGFzIGFueSkubG9jYWxKc29uUGF0aCkge1xuICAgICAgY29uc3QgbG9jYWxQYXRoID0gKHRoaXMucGx1Z2luIGFzIGFueSkubG9jYWxKc29uUGF0aCBhcyBzdHJpbmc7XG4gICAgICBjb25zdCBmaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGxvY2FsUGF0aCk7XG4gICAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFwcC52YXVsdC5yZWFkKGZpbGUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGRlZmF1bHRGaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGdldERlZmF1bHRQYXRoKCkpO1xuICAgIGlmIChkZWZhdWx0RmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICByZXR1cm4gdGhpcy5hcHAudmF1bHQucmVhZChkZWZhdWx0RmlsZSk7XG4gICAgfVxuXG4gICAgY29uc3QgZm9sZGVyID0gZ2V0Rm9sZGVyKCk7XG4gICAgY29uc3QgZmFsbGJhY2sgPSB0aGlzLmFwcC52YXVsdFxuICAgICAgLmdldEZpbGVzKClcbiAgICAgIC5maW5kKChmaWxlKSA9PiBmaWxlLmV4dGVuc2lvbiA9PT0gXCJqc29uXCIgJiYgZmlsZS5wYXRoLnN0YXJ0c1dpdGgoYCR7Zm9sZGVyfS9gKSk7XG5cbiAgICBpZiAoZmFsbGJhY2spIHtcbiAgICAgIHJldHVybiB0aGlzLmFwcC52YXVsdC5yZWFkKGZhbGxiYWNrKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgcmVmcmVzaE9wZW5WaWV3cygpIHtcbiAgICBjb25zdCBsZWF2ZXMgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGVhdmVzT2ZUeXBlKFZJRVdfVFlQRSk7XG4gICAgZm9yIChjb25zdCBsZWFmIG9mIGxlYXZlcykge1xuICAgICAgaWYgKGxlYWYudmlldyBpbnN0YW5jZW9mIENpbmVWYXVsdFZpZXcpIHtcbiAgICAgICAgYXdhaXQgbGVhZi52aWV3Lm9uT3BlbigpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLElBQUFBLG1CQUF1Qjs7O0FDQWhCLElBQU0sWUFBWTs7O0FDQXpCLElBQUFDLG1CQUFnRTs7O0FDQXpELFNBQVMsaUJBQ2QsV0FDQSxVQUNBLFFBQ0E7QUFDQSxRQUFNLGFBQWEsVUFBVSxVQUFVO0FB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O0FBQUEsRUFDbkM7QUFBQTtBQUFBLEVBSUEsTUFBTSxjQUFjLFFBQWdCO0FBQ25DLFNBQUssYUFBYTtBQUNsQixVQUFNLEtBQUssZUFBZTtBQUFBLEVBQzNCO0FBQUEsRUFFQSxNQUFNLFlBQVksVUFBMkI7QUFDNUMsU0FBSyxXQUFXO0FBQ2hCLFVBQU0sS0FBSyxlQUFlO0FBQUEsRUFDM0I7QUFBQSxFQUVBLE1BQWMsaUJBQWlCO0FBQzlCLFVBQU0sT0FBNEI7QUFBQSxNQUNqQyxZQUFZLEtBQUs7QUFBQSxNQUNqQixVQUFVLEtBQUs7QUFBQSxJQUNoQjtBQUNBLFFBQUksS0FBSyxlQUFlO0FBQ3ZCLFdBQUssZ0JBQWdCLEtBQUs7QUFBQSxJQUMzQjtBQUNBLFVBQU0sS0FBSyxTQUFTLElBQUk7QUFBQSxFQUN6QjtBQUFBLEVBRUEsTUFBTSxpQkFBaUIsTUFBcUI7QUFDM0MsU0FBSyxnQkFBZ0I7QUFDckIsVUFBTSxLQUFLLGVBQWU7QUFBQSxFQUMzQjtBQUFBO0FBQUEsRUFHQSxNQUFjLGFBQWE7QUFDMUIsVUFBTSxpQkFBaUIsS0FBSyxJQUFJLFVBQVUsZ0JBQWdCLFNBQVM7QUFDbkUsUUFBSSxlQUFlLFNBQVMsR0FBRztBQUM5QixXQUFLLElBQUksVUFBVSxXQUFXLGVBQWUsQ0FBQyxDQUFDO0FBQy9DO0FBQUEsSUFDRDtBQUVBLFVBQU0sT0FBTyxLQUFLLElBQUksVUFBVSxRQUFRLElBQUk7QUFDNUMsVUFBTSxLQUFLLGFBQWE7QUFBQSxNQUN2QixNQUFNO0FBQUEsTUFDTixRQUFRO0FBQUEsSUFDVCxDQUFDO0FBQUEsRUFDRjtBQUNEOyIsCiAgIm5hbWVzIjogWyJpbXBvcnRfb2JzaWRpYW4iLCAiaW1wb3J0X29ic2lkaWFuIiwgImltcG9ydF9vYnNpZGlhbiIsICJ0eXBlIiwgImltcG9ydF9vYnNpZGlhbiIsICJpbXBvcnRfb2JzaWRpYW4iLCAiaW1wb3J0X29ic2lkaWFuIl0KfQo=
