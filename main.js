/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => CineVaultPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian7 = require("obsidian");

// src/constants.ts
var VIEW_TYPE = "CineVaultView";

// src/views/CineVaultView.ts
var import_obsidian5 = require("obsidian");

// src/ui/onboarding.ts
function renderOnboarding(container, onCreate, onLink) {
  const onboarding = container.createDiv({
    cls: "cinevault-onboarding"
  });
  const actions = onboarding.createDiv({ cls: "cinevault-onboarding-actions" });
  const createButton = actions.createEl("button", { text: "Create new library" });
  createButton.addEventListener("click", onCreate);
  if (onLink) {
    actions.createEl("p", { text: "or" });
    const linkButton = actions.createEl("button", { text: "Link existing library" });
    linkButton.addEventListener("click", onLink);
  }
}

// src/ui/modals/CineVaultMovieActionModal.ts
var import_obsidian = require("obsidian");
var CineVaultMovieActionModal = class extends import_obsidian.Modal {
  constructor(app, movie, onSave) {
    super(app);
    this.movie = movie;
    this.onSave = onSave;
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.createEl("h3", { text: this.movie.title });
    contentEl.createEl("p", { text: `${this.movie.year} \u2022 ${this.movie.type}` });
    if (this.movie.poster) {
      contentEl.createEl("img", { cls: "cinevault-modal-poster" }).setAttribute("src", this.movie.poster);
    }
    contentEl.createEl("p", { text: this.movie.plot });
    const actions = contentEl.createDiv({ cls: "cinevault-modal-actions" });
    const watchedButton = actions.createEl("button", { text: "Mark as watched" });
    const toWatchButton = actions.createEl("button", { text: "To watch" });
    watchedButton.addEventListener("click", () => {
      this.onSave(true);
      this.close();
    });
    toWatchButton.addEventListener("click", () => {
      this.onSave(false);
      this.close();
    });
  }
};

// src/ui/modals/CineVaultMovieDetailModal.ts
var import_obsidian2 = require("obsidian");

// src/ui/starRating.ts
function createStarRating(container, rating, readOnly, onChange) {
  const stars = container.createDiv({ cls: "cinevault-stars" });
  const starElements = [];
  let currentRating = rating;
  for (let i = 1; i <= 5; i += 1) {
    const star = stars.createEl("span", { text: "\u2605", cls: "cinevault-star" });
    if (i <= rating)
      star.classList.add("active");
    starElements.push(star);
    if (!readOnly) {
      star.addEventListener("click", () => {
        if (currentRating === i) {
          currentRating = 0;
          starElements.forEach((element) => {
            element.classList.remove("active");
          });
        } else {
          currentRating = i;
          starElements.forEach((element, index) => {
            element.classList.toggle("active", index < i);
          });
        }
        onChange == null ? void 0 : onChange(currentRating);
      });
    } else {
      star.classList.add("readonly");
    }
  }
  return stars;
}

// src/utils.ts
function nullSafe(func, fallbackValue = null) {
  try {
    const value = func();
    return value === null || value === void 0 ? fallbackValue : value;
  } catch (e) {
    console.error("Error: ", e);
    return fallbackValue;
  }
}

// src/ui/modals/CineVaultMovieDetailModal.ts
var CineVaultMovieDetailModal = class extends import_obsidian2.Modal {
  constructor(app, movie, onRate, onRemove, onToggleWatched) {
    super(app);
    this.movie = movie;
    this.onRate = onRate;
    this.onRemove = onRemove;
    this.onToggleWatched = onToggleWatched;
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    const modalContainer = contentEl.createDiv({
      cls: "cinevault-modal-container"
    });
    modalContainer.createEl("h1", {
      text: this.movie.title,
      cls: "cinevault-modal-title"
    });
    const type = nullSafe(() => this.movie.type[0].toUpperCase() + this.movie.type.slice(1), null);
    const year = nullSafe(() => this.movie.year, null);
    modalContainer.createEl("p", {
      text: `${year} - ${type}`
    });
    if (this.movie.poster) {
      modalContainer.createEl("img", { cls: "cinevault-modal-poster" }).setAttribute("src", this.movie.poster);
    }
    if (this.movie.plot) {
      const plotContainer = modalContainer.createEl("div", { cls: "cinevault-modal-plot-container" });
      const plotEl = plotContainer.createEl("p", {
        text: this.movie.plot,
        cls: "cinevault-modal-plot"
      });
      const showMoreButton = plotContainer.createEl("button", {
        text: "Show more",
        cls: "cinevault-modal-show-more cinevault-modal-show-more-hidden"
      });
      showMoreButton.addEventListener("click", () => {
        const isExpanded = plotEl.classList.toggle("expanded-plot");
        showMoreButton.setText(isExpanded ? "Show less" : "Show more");
      });
      requestAnimationFrame(() => {
        if (plotEl.scrollHeight > plotEl.clientHeight + 1) {
          showMoreButton.removeClass("cinevault-modal-show-more-hidden");
        }
      });
    }
    function rederDetailSection(type2, value) {
      const detailElement = modalContainer.createEl("div", { cls: "cinevault-modal-detail-container" });
      detailElement.createEl("p", {
        text: `${type2}:`,
        cls: "cinevault-modal-detail-label"
      });
      detailElement.createEl("p", {
        text: value,
        cls: "cinevault-modal-detail-value"
      });
    }
    modalContainer.createEl("hr");
    if (this.movie.genre) {
      rederDetailSection("Genre", this.movie.genre);
    }
    if (this.movie.director) {
      rederDetailSection("Director", this.movie.director);
    }
    if (this.movie.actors) {
      rederDetailSection("Actors", this.movie.actors);
    }
    modalContainer.createEl("hr");
    const ratingContainer = modalContainer.createDiv({
      cls: "cinevault-modal-rating-container"
    });
    ratingContainer.createEl("div", { text: "Rating", cls: "cinevault-modal-rating-label" });
    const stars = createStarRating(ratingContainer, this.movie.starRating, false, (rating) => {
      this.onRate(rating);
    });
    stars.classList.add("cinevault-modal-stars");
    if (this.movie.ratings) {
      const externalRatingsContainer = modalContainer.createDiv({
        cls: "cinevault-modal-external-ratings"
      });
      for (const rating of this.movie.ratings) {
        const ratingEl = externalRatingsContainer.createDiv({ cls: "cinevault-modal-external-rating-element" });
        ratingEl.createEl("div", { text: rating.Source, cls: "cinevault-modal-external-rating-source" });
        ratingEl.createEl("div", { text: rating.Value, cls: "cinevault-modal-external-rating-value" });
      }
    }
    const actions = modalContainer.createDiv({ cls: "cinevault-modal-actions" });
    const toggleWatchedLabel = this.movie.watched ? "Mark as to watch" : "Mark as watched";
    const toggleWatchedButton = actions.createEl("button", { text: toggleWatchedLabel });
    const removeButton = actions.createEl("button", { text: "Remove", cls: "cinevault-danger" });
    toggleWatchedButton.addEventListener("click", () => {
      this.onToggleWatched();
      this.close();
    });
    removeButton.addEventListener("click", () => {
      this.onRemove();
      this.close();
    });
  }
};

// src/ui/JsonFileSuggestModal.ts
var import_obsidian3 = require("obsidian");
var JsonFileSuggestModal = class extends import_obsidian3.SuggestModal {
  constructor(app, onSelect) {
    super(app);
    this.onSelect = onSelect;
    this.jsonFiles = this.app.vault.getFiles().filter((f) => f.extension === "json");
    this.setPlaceholder("Select a JSON file from your vault...");
  }
  getSuggestions(query) {
    const lowerQuery = query.toLowerCase();
    return this.jsonFiles.filter(
      (file) => file.path.toLowerCase().includes(lowerQuery)
    );
  }
  renderSuggestion(file, el) {
    el.createEl("div", { text: file.path });
  }
  onChooseSuggestion(file, evt) {
    this.onSelect(file);
  }
};

// src/services/libraryStorage.ts
var FOLDER = "cinevault-json";
var DEFAULT_NAME = "cinevault.json";
function getDefaultPath() {
  return `${FOLDER}/${DEFAULT_NAME}`;
}
function getFolder() {
  return FOLDER;
}
function createEmptyMovie() {
  return {
    id: crypto.randomUUID(),
    imdbId: "",
    title: "",
    year: "",
    rated: "",
    released: "",
    runtime: "",
    genre: "",
    director: "",
    writer: "",
    actors: "",
    plot: "",
    language: "",
    country: "",
    awards: "",
    poster: "",
    posterLocal: "",
    ratings: [],
    metascore: "",
    imdbRating: "",
    imdbVotes: "",
    type: "",
    dvd: "",
    boxOffice: "",
    production: "",
    website: "",
    totalSeasons: "",
    tomatoURL: "",
    tomatoMeter: "",
    tomatoImage: "",
    tomatoRating: "",
    tomatoReviews: "",
    tomatoFresh: "",
    tomatoRotten: "",
    tomatoConsensus: "",
    tomatoUserMeter: "",
    tomatoUserRating: "",
    tomatoUserReviews: "",
    starRating: 0,
    watched: false,
    notes: ""
  };
}
function createDefaultData() {
  const now = new Date().toISOString();
  return {
    schemaVersion: 1,
    createdAt: now,
    updatedAt: now,
    libraryName: "CineVault",
    owner: "",
    source: "CineVault",
    movies: []
  };
}
function normalizeData(data) {
  return {
    ...data,
    movies: data.movies.map((movie) => ({
      ...createEmptyMovie(),
      ...movie,
      year: movie.year ? String(movie.year) : "",
      starRating: typeof movie.starRating === "number" ? movie.starRating : 0
    }))
  };
}
async function ensureFolder(app) {
  if (!app.vault.getAbstractFileByPath(FOLDER)) {
    await app.vault.createFolder(FOLDER);
  }
}
async function createJsonFile(app) {
  await ensureFolder(app);
  const existing = app.vault.getAbstractFileByPath(getDefaultPath());
  const filename = existing ? `cinevault-${Date.now()}.json` : DEFAULT_NAME;
  const path = `${FOLDER}/${filename}`;
  return app.vault.create(path, JSON.stringify(createDefaultData(), null, 2));
}
async function loadLocalFile(app, file) {
  const raw = await app.vault.read(file);
  const parsed = JSON.parse(raw);
  if (!parsed || !Array.isArray(parsed.movies)) {
    throw new Error("Formato JSON non valido");
  }
  return normalizeData(parsed);
}
async function saveLocalData(app, file, data) {
  await app.vault.modify(file, JSON.stringify(data, null, 2));
}

// src/services/omdbService.ts
var import_obsidian4 = require("obsidian");
async function searchOmdb(query, apiKey) {
  if (!apiKey) {
    return [];
  }
  try {
    const url = `https://www.omdbapi.com/?apikey=${apiKey}&s=${encodeURIComponent(query)}`;
    const response = await (0, import_obsidian4.requestUrl)(url);
    const data = response.json;
    if (data == null ? void 0 : data.Search) {
      return data.Search.map((item) => ({
        imdbId: item.imdbID,
        title: item.Title,
        year: item.Year,
        type: item.Type,
        poster: item.Poster && item.Poster !== "N/A" ? item.Poster : "",
        plot: ""
      }));
    }
    return [];
  } catch (error) {
    console.error("Error searching OMDb:", error);
    return [];
  }
}
async function getOmdbDetails(imdbId, apiKey, depth = 0) {
  if (depth >= 3) {
    console.error(`Failed to fetch movie details after ${depth} attempts`);
    return null;
  }
  if (!apiKey) {
    return null;
  }
  try {
    const url = `https://www.omdbapi.com/?apikey=${apiKey}&i=${imdbId}&plot=full&tomatoes=true`;
    const response = await (0, import_obsidian4.requestUrl)(url);
    const data = response.json;
    if (data.Response !== "True") {
      console.error("OMDb API returned error response", data);
      return null;
    }
    return data;
  } catch (error) {
    console.error("Error fetching movie details, retrying...", error);
    return getOmdbDetails(imdbId, apiKey, depth + 1);
  }
}

// src/views/CineVaultView.ts
var CineVaultView = class extends import_obsidian5.ItemView {
  constructor(leaf, plugin) {
    super(leaf);
    this.file = null;
    this.data = null;
    this.activeTab = "toWatch";
    this.moviesContainer = null;
    this.viewMode = "grid";
    this.plugin = plugin;
  }
  getViewType() {
    return VIEW_TYPE;
  }
  getDisplayText() {
    return "CineVault";
  }
  // Provide a custom icon for the view's tab
  getIcon() {
    return "clapperboard";
  }
  async onOpen() {
    var _a;
    this.viewMode = (_a = this.plugin.viewMode) != null ? _a : "grid";
    await this.initializeData();
    await this.render();
  }
  async render() {
    const container = this.containerEl.children[1];
    container.empty();
    const header = container.createDiv({ cls: "cinevault-header" });
    header.createEl("h1", {
      text: "CineVault",
      cls: "cinevault-title"
    });
    header.createEl("p", {
      text: "CineVault allow you to manageyour favorites movie and tv library into your vault. Search OMDb, rate titles, and store your collection in a json file within your vault.",
      cls: "cinevault-header-text"
    });
    if (!this.data) {
      renderOnboarding(container, async () => {
        this.file = await createJsonFile(this.plugin.app);
        if (this.file) {
          await this.plugin.setLocalJsonPath(this.file.path);
        }
        await this.loadFile(this.file);
        await this.render();
      }, () => {
        new JsonFileSuggestModal(this.plugin.app, async (file) => {
          await this.loadFile(file);
          await this.render();
        }).open();
      });
      return;
    }
    const searchBox = container.createDiv({ cls: "cinevault-search" });
    const searchInput = searchBox.createEl("input", {
      cls: "cinevault-search-input",
      attr: {
        placeholder: "Search"
      }
    });
    const resultsList = searchBox.createDiv({ cls: "cinevault-search-results" });
    const content = container.createDiv({ cls: "cinevault-content" });
    this.moviesContainer = content;
    this.renderMovies(content);
    let searchTimeout = null;
    searchInput.addEventListener("input", () => {
      if (searchTimeout)
        window.clearTimeout(searchTimeout);
      searchTimeout = window.setTimeout(async () => {
        const query = searchInput.value.trim();
        await this.renderSearchResults(resultsList, query);
      }, 350);
    });
  }
  renderMovies(container) {
    container.empty();
    if (!this.data) {
      container.createEl("p", { text: "No library loaded." });
      return;
    }
    const watched = this.data.movies.filter((movie) => movie.watched);
    const toWatch = this.data.movies.filter((movie) => !movie.watched);
    const tabsContainer = container.createDiv({ cls: "cinevault-tabs-container" });
    const tabHeader = tabsContainer.createDiv({ cls: "cinevault-tab-header" });
    const tabButtons = tabHeader.createDiv({ cls: "cinevault-tab-buttons" });
    const viewToggle = tabHeader.createDiv({ cls: "cinevault-view-toggle" });
    const toWatchButton = tabButtons.createEl("button", {
      cls: "cinevault-tab-button",
      text: `To Watch (${toWatch.length})`
    });
    const watchedButton = tabButtons.createEl("button", {
      cls: "cinevault-tab-button",
      text: `Watched (${watched.length})`
    });
    const gridButton = viewToggle.createEl("button", {
      cls: "cinevault-view-button",
      attr: { "aria-label": "Grid view", title: "Grid view" }
    });
    const listButton = viewToggle.createEl("button", {
      cls: "cinevault-view-button",
      attr: { "aria-label": "List view", title: "List view" }
    });
    (0, import_obsidian5.setIcon)(gridButton, "layout-grid");
    (0, import_obsidian5.setIcon)(listButton, "list");
    if (this.activeTab === "toWatch") {
      toWatchButton.classList.add("cinevault-tab-button-active");
    } else {
      watchedButton.classList.add("cinevault-tab-button-active");
    }
    if (this.viewMode === "grid") {
      gridButton.classList.add("cinevault-view-button-active");
    } else {
      listButton.classList.add("cinevault-view-button-active");
    }
    const tabContent = tabsContainer.createDiv({ cls: "cinevault-tab-content" });
    const activeMovies = this.activeTab === "toWatch" ? toWatch : watched;
    const activeTitle = this.activeTab === "toWatch" ? "To Watch" : "Watched";
    this.renderMovieSection(tabContent, activeTitle, activeMovies);
    toWatchButton.addEventListener("click", () => {
      if (this.activeTab === "toWatch")
        return;
      this.activeTab = "toWatch";
      this.renderMovies(container);
    });
    watchedButton.addEventListener("click", () => {
      if (this.activeTab === "watched")
        return;
      this.activeTab = "watched";
      this.renderMovies(container);
    });
    gridButton.addEventListener("click", async () => {
      if (this.viewMode === "grid")
        return;
      this.viewMode = "grid";
      await this.plugin.setViewMode("grid");
      this.renderMovies(container);
    });
    listButton.addEventListener("click", async () => {
      if (this.viewMode === "list")
        return;
      this.viewMode = "list";
      await this.plugin.setViewMode("list");
      this.renderMovies(container);
    });
  }
  renderMovieSection(container, title, movies) {
    const section = container.createDiv({ cls: "cinevault-section" });
    section.createEl("h3", { text: title });
    if (movies.length === 0) {
      section.createEl("p", { text: "No movies in this list." });
      return;
    }
    const list = section.createDiv({
      cls: this.viewMode === "grid" ? "cinevault-movie-grid" : "cinevault-movie-list"
    });
    if (this.viewMode === "grid") {
      this.renderMovieGrid(list, movies);
    } else {
      this.renderMovieList(list, movies);
    }
  }
  renderMovieGrid(container, movies) {
    movies.forEach((movie) => {
      const card = container.createDiv({ cls: "cinevault-movie-card" });
      card.createEl("img", { cls: "cinevault-movie-poster" }).setAttribute("src", movie.poster);
      card.createEl("div", { text: movie.title, cls: "cinevault-movie-title" });
      const detailsParts = [];
      const year = nullSafe(() => movie.year, null);
      const type = nullSafe(() => movie.type[0].toUpperCase() + movie.type.slice(1), null);
      if (year)
        detailsParts.push(year);
      if (type)
        detailsParts.push(type);
      const detailsText = detailsParts.join(" - ");
      if (detailsText) {
        card.createEl("div", { text: detailsText, cls: "cinevault-movie-year" });
      }
      card.addEventListener("click", () => this.openMovieDetails(movie));
    });
  }
  renderMovieList(container, movies) {
    movies.forEach((movie) => {
      const row = container.createDiv({ cls: "cinevault-movie-row" });
      const poster = row.createEl("img", { cls: "cinevault-movie-thumbnail" });
      poster.setAttribute("src", movie.poster || "");
      const info = row.createDiv({ cls: "cinevault-movie-info" });
      info.createEl("div", { text: movie.title, cls: "cinevault-movie-title" });
      const detailsParts = [];
      const year = nullSafe(() => movie.year, null);
      const type = nullSafe(() => movie.type[0].toUpperCase() + movie.type.slice(1), null);
      if (year)
        detailsParts.push(year);
      if (type)
        detailsParts.push(type);
      const detailsText = detailsParts.join(" - ");
      if (detailsText) {
        info.createEl("div", { text: detailsText, cls: "cinevault-movie-year" });
      }
      row.addEventListener("click", () => this.openMovieDetails(movie));
    });
  }
  openMovieDetails(movie) {
    new CineVaultMovieDetailModal(this.plugin.app, movie, async (rating) => {
      if (!this.data)
        return;
      movie.starRating = rating;
      await this.saveData();
      this.refreshMovies();
    }, async () => {
      if (!this.data)
        return;
      this.data.movies = this.data.movies.filter((item) => item.id !== movie.id);
      await this.saveData();
      this.refreshMovies();
    }, async () => {
      if (!this.data)
        return;
      movie.watched = !movie.watched;
      await this.saveData();
      this.refreshMovies();
    }).open();
  }
  refreshMovies() {
    if (!this.moviesContainer)
      return;
    this.renderMovies(this.moviesContainer);
  }
  getJsonFiles() {
    return this.plugin.app.vault.getFiles().filter((file) => file.extension === "json");
  }
  async initializeData() {
    const localPath = this.plugin.localJsonPath;
    if (localPath) {
      const localFile = this.plugin.app.vault.getAbstractFileByPath(localPath);
      if (localFile instanceof import_obsidian5.TFile) {
        await this.loadFile(localFile);
        return;
      }
    }
    this.file = null;
    this.data = null;
  }
  async loadFile(file) {
    try {
      const parsed = await loadLocalFile(this.plugin.app, file);
      this.file = file;
      this.data = parsed;
      await this.plugin.setLocalJsonPath(file.path);
    } catch (error) {
      this.data = null;
      this.file = null;
      new import_obsidian5.Notice("Unable to read the JSON file.");
    }
  }
  async saveData() {
    if (!this.data)
      return;
    this.data.updatedAt = new Date().toISOString();
    if (this.file) {
      await saveLocalData(this.plugin.app, this.file, this.data);
    }
  }
  async renderSearchResults(container, query) {
    container.empty();
    if (!query || query.length < 2)
      return;
    const results = await searchOmdb(query, this.plugin.omdbApiKey);
    if (results.length === 0) {
      container.createEl("div", { text: "No results found.", cls: "cinevault-search-empty" });
      return;
    }
    results.forEach((result) => {
      const item = container.createDiv({ cls: "cinevault-search-item" });
      if (result.poster) {
        item.createEl("img", { cls: "cinevault-search-poster" }).setAttribute("src", result.poster);
      }
      const info = item.createDiv({ cls: "cinevault-search-info" });
      info.createEl("div", { text: result.title, cls: "cinevault-search-title" });
      info.createEl("div", { text: result.year, cls: "cinevault-search-year" });
      item.addEventListener("click", () => {
        new CineVaultMovieActionModal(this.plugin.app, result, async (watched) => {
          if (!this.data)
            return;
          const existing = this.data.movies.find((movie) => movie.imdbId === result.imdbId);
          if (existing) {
            existing.watched = watched;
          } else {
            new import_obsidian5.Notice(`Loading details for ${result.title}...`);
            const details = await getOmdbDetails(result.imdbId, this.plugin.omdbApiKey);
            if (!details) {
              new import_obsidian5.Notice("Unable to load movie details.");
              return;
            }
            const newMovie = createEmptyMovie();
            newMovie.imdbId = details.imdbID || result.imdbId;
            newMovie.title = details.Title || result.title;
            newMovie.year = details.Year || result.year;
            newMovie.rated = details.Rated || "";
            newMovie.released = details.Released || "";
            newMovie.runtime = details.Runtime || "";
            newMovie.genre = details.Genre || "";
            newMovie.director = details.Director || "";
            newMovie.writer = details.Writer || "";
            newMovie.actors = details.Actors || "";
            newMovie.plot = details.Plot || result.plot;
            newMovie.language = details.Language || "";
            newMovie.country = details.Country || "";
            newMovie.awards = details.Awards || "";
            newMovie.poster = details.Poster && details.Poster !== "N/A" ? details.Poster : result.poster;
            newMovie.posterLocal = "";
            newMovie.ratings = details.Ratings || [];
            newMovie.metascore = details.Metascore || "";
            newMovie.imdbRating = details.imdbRating || "";
            newMovie.imdbVotes = details.imdbVotes || "";
            newMovie.type = details.Type || result.type;
            newMovie.dvd = details.DVD || "";
            newMovie.boxOffice = details.BoxOffice || "";
            newMovie.production = details.Production || "";
            newMovie.website = details.Website || "";
            newMovie.totalSeasons = details.totalSeasons || "";
            newMovie.watched = watched;
            this.data.movies.push(newMovie);
          }
          await this.saveData();
          this.render();
        }).open();
      });
    });
  }
};

// src/settings/CineVaultSettingTab.ts
var import_obsidian6 = require("obsidian");
var CineVaultSettingTab = class extends import_obsidian6.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    new import_obsidian6.Setting(containerEl).setName("Configuration").setHeading();
    new import_obsidian6.Setting(containerEl).setName("OMDb API key").setDesc("Enter your OMDb API key. You can get one for free at omdbapi.com").addText((text) => text.setPlaceholder("Enter your API key").setValue(this.plugin.omdbApiKey).onChange(async (value) => {
      await this.plugin.setOmdbApiKey(value);
    }));
    new import_obsidian6.Setting(containerEl).setName("Linked local library").setDesc(
      this.plugin.localJsonPath ? `Local file: ${this.plugin.localJsonPath}` : "No local library linked"
    ).addDropdown((drop) => {
      var _a;
      const files = this.app.vault.getFiles().filter((f) => f.extension === "json");
      const options = { "": "-- None --" };
      files.forEach((f) => options[f.path] = f.path);
      drop.addOptions(options).setValue((_a = this.plugin.localJsonPath) != null ? _a : "").onChange(async (value) => {
        const path = value || null;
        await this.plugin.setLocalJsonPath(path);
        await this.refreshOpenViews();
        this.display();
      });
    }).addButton((button) => button.setButtonText("Unlink local").setDisabled(!this.plugin.localJsonPath).onClick(async () => {
      await this.plugin.setLocalJsonPath(null);
      await this.refreshOpenViews();
      this.display();
    }));
    new import_obsidian6.Setting(containerEl).setName("Create new library").setDesc("Create a new empty local library from scratch. This will unlink any external library.").addButton((button) => button.setButtonText("Create library").onClick(async () => {
      await this.createNewLibrary();
    }));
    new import_obsidian6.Setting(containerEl).setName("Export library").setDesc("Save a copy of your library JSON to a file.").addButton((button) => button.setButtonText("Export JSON").onClick(async () => {
      await this.exportLibraryJson();
    }));
    new import_obsidian6.Setting(containerEl).setName("Bugfix").setHeading();
    new import_obsidian6.Setting(containerEl).setName("Report issues").setDesc("If you encounter any issues with the plugin, please report them. Your feedback is invaluable for improving CineVault!").addButton((button) => button.setButtonText("GitHub").onClick(() => {
      window.open("https://github.com/vscaperrotta/obsidian-cinevault/issues", "_blank");
    }));
    new import_obsidian6.Setting(containerEl).setName("Support").setHeading();
    new import_obsidian6.Setting(containerEl).setName("Donate").setDesc(
      "If you like this plugin, consider donating to support continued development."
    ).addButton((bt) => {
      bt.buttonEl.outerHTML = "<a href='https://ko-fi.com/T6T01TX807' target='_blank'><img height='36' style='border:0px;height:36px;' src='https://storage.ko-fi.com/cdn/kofi6.png?v=6' border='0' alt='Buy Me a Coffee at ko-fi.com' /></a>";
    });
  }
  async exportLibraryJson() {
    try {
      const content = await this.getLibraryJsonContent();
      if (!content) {
        new import_obsidian6.Notice("No library file found to export.");
        return;
      }
      const timestamp = new Date().toISOString().replace(/[:.]/g, "-").slice(0, 19);
      const exportPath = `cinevault-export-${timestamp}.json`;
      let finalPath = exportPath;
      let counter = 1;
      while (this.app.vault.getAbstractFileByPath(finalPath)) {
        finalPath = `cinevault-export-${timestamp}-${counter}.json`;
        counter++;
      }
      await this.app.vault.create(finalPath, content);
      new import_obsidian6.Notice(`Library exported to ${finalPath}`);
    } catch (error) {
      console.error("[CineVault] Export library error", error);
      new import_obsidian6.Notice("Unable to export the library.");
    }
  }
  async createNewLibrary() {
    const confirmed = window.confirm(
      "Create a new empty CineVault library? This will unlink any external library and reset your local library data."
    );
    if (!confirmed)
      return;
    try {
      const defaultFile = this.app.vault.getAbstractFileByPath(getDefaultPath());
      let createdFile;
      if (defaultFile instanceof import_obsidian6.TFile) {
        await saveLocalData(this.app, defaultFile, createDefaultData());
        createdFile = defaultFile;
      } else {
        createdFile = await createJsonFile(this.app);
      }
      if (createdFile) {
        await this.plugin.setLocalJsonPath(createdFile.path);
      }
      await this.refreshOpenViews();
      this.display();
      new import_obsidian6.Notice("New library created.");
    } catch (error) {
      console.error("[CineVault] Create new library error", error);
      new import_obsidian6.Notice("Unable to create a new library.");
    }
  }
  async getLibraryJsonContent() {
    if (this.plugin.localJsonPath) {
      const localPath = this.plugin.localJsonPath;
      const file = this.app.vault.getAbstractFileByPath(localPath);
      if (file instanceof import_obsidian6.TFile) {
        return this.app.vault.read(file);
      }
    }
    const defaultFile = this.app.vault.getAbstractFileByPath(getDefaultPath());
    if (defaultFile instanceof import_obsidian6.TFile) {
      return this.app.vault.read(defaultFile);
    }
    const folder = getFolder();
    const fallback = this.app.vault.getFiles().find((file) => file.extension === "json" && file.path.startsWith(`${folder}/`));
    if (fallback) {
      return this.app.vault.read(fallback);
    }
    return null;
  }
  async refreshOpenViews() {
    const leaves = this.app.workspace.getLeavesOfType(VIEW_TYPE);
    for (const leaf of leaves) {
      if (leaf.view instanceof CineVaultView) {
        await leaf.view.onOpen();
      }
    }
  }
};

// src/main.ts
var CineVaultPlugin = class extends import_obsidian7.Plugin {
  constructor() {
    super(...arguments);
    this.localJsonPath = null;
    this.omdbApiKey = "";
    this.viewMode = "grid";
  }
  // Initialize the plugin and set up event listeners
  async onload() {
    await this.loadPluginData();
    this.addSettingTab(new CineVaultSettingTab(this.app, this));
    this.registerView(
      VIEW_TYPE,
      (leaf) => new CineVaultView(leaf, this)
    );
    this.addRibbonIcon("clapperboard", "CineVault", async () => {
      await this.openNewTab();
    });
  }
  // Unmount the status bar element when the plugin is disabled
  onunload() {
  }
  async loadPluginData() {
    var _a, _b, _c;
    const data = await this.loadData();
    this.localJsonPath = (_a = data == null ? void 0 : data.localJsonPath) != null ? _a : null;
    this.omdbApiKey = (_b = data == null ? void 0 : data.omdbApiKey) != null ? _b : "";
    this.viewMode = (_c = data == null ? void 0 : data.viewMode) != null ? _c : "grid";
  }
  // externalJsonPath removed; no-op placeholder removed
  async setOmdbApiKey(apiKey) {
    this.omdbApiKey = apiKey;
    await this.savePluginData();
  }
  async setViewMode(viewMode) {
    this.viewMode = viewMode;
    await this.savePluginData();
  }
  async savePluginData() {
    const data = {
      omdbApiKey: this.omdbApiKey,
      viewMode: this.viewMode
    };
    if (this.localJsonPath) {
      data.localJsonPath = this.localJsonPath;
    }
    await this.saveData(data);
  }
  async setLocalJsonPath(path) {
    this.localJsonPath = path;
    await this.savePluginData();
  }
  // Open a new tab with the "CineVault" view type
  async openNewTab() {
    const existingLeaves = this.app.workspace.getLeavesOfType(VIEW_TYPE);
    if (existingLeaves.length > 0) {
      this.app.workspace.revealLeaf(existingLeaves[0]);
      return;
    }
    const leaf = this.app.workspace.getLeaf(true);
    await leaf.setViewState({
      type: VIEW_TYPE,
      active: true
    });
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL21haW4udHMiLCAic3JjL2NvbnN0YW50cy50cyIsICJzcmMvdmlld3MvQ2luZVZhdWx0Vmlldy50cyIsICJzcmMvdWkvb25ib2FyZGluZy50cyIsICJzcmMvdWkvbW9kYWxzL0NpbmVWYXVsdE1vdmllQWN0aW9uTW9kYWwudHMiLCAic3JjL3VpL21vZGFscy9DaW5lVmF1bHRNb3ZpZURldGFpbE1vZGFsLnRzIiwgInNyYy91aS9zdGFyUmF0aW5nLnRzIiwgInNyYy91dGlscy50cyIsICJzcmMvdWkvSnNvbkZpbGVTdWdnZXN0TW9kYWwudHMiLCAic3JjL3NlcnZpY2VzL2xpYnJhcnlTdG9yYWdlLnRzIiwgInNyYy9zZXJ2aWNlcy9vbWRiU2VydmljZS50cyIsICJzcmMvc2V0dGluZ3MvQ2luZVZhdWx0U2V0dGluZ1RhYi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgUGx1Z2luIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBWSUVXX1RZUEUgfSBmcm9tIFwiLi9jb25zdGFudHNcIjtcbmltcG9ydCBDaW5lVmF1bHRWaWV3IGZyb20gXCIuL3ZpZXdzL0NpbmVWYXVsdFZpZXdcIjtcbmltcG9ydCBDaW5lVmF1bHRTZXR0aW5nVGFiIGZyb20gXCIuL3NldHRpbmdzL0NpbmVWYXVsdFNldHRpbmdUYWJcIjtcblxudHlwZSBDaW5lVmF1bHRQbHVnaW5EYXRhID0ge1xuXHRsb2NhbEpzb25QYXRoPzogc3RyaW5nO1xuXHRvbWRiQXBpS2V5Pzogc3RyaW5nO1xuXHR2aWV3TW9kZT86IFwiZ3JpZFwiIHwgXCJsaXN0XCI7XG5cdG9wZW4/OiBib29sZWFuO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2luZVZhdWx0UGx1Z2luIGV4dGVuZHMgUGx1Z2luIHtcblx0bG9jYWxKc29uUGF0aDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG5cdG9tZGJBcGlLZXk6IHN0cmluZyA9IFwiXCI7XG5cdHZpZXdNb2RlOiBcImdyaWRcIiB8IFwibGlzdFwiID0gXCJncmlkXCI7XG5cblx0Ly8gSW5pdGlhbGl6ZSB0aGUgcGx1Z2luIGFuZCBzZXQgdXAgZXZlbnQgbGlzdGVuZXJzXG5cdGFzeW5jIG9ubG9hZCgpIHtcblx0XHRhd2FpdCB0aGlzLmxvYWRQbHVnaW5EYXRhKCk7XG5cblx0XHQvLyBBZGQgc2V0dGluZ3MgdGFiXG5cdFx0dGhpcy5hZGRTZXR0aW5nVGFiKG5ldyBDaW5lVmF1bHRTZXR0aW5nVGFiKHRoaXMuYXBwLCB0aGlzKSk7XG5cblx0XHQvLyBSZWdpc3RlciBuZXcgdmlld1xuXHRcdHRoaXMucmVnaXN0ZXJWaWV3KFxuXHRcdFx0VklFV19UWVBFLFxuXHRcdFx0KGxlYWYpID0+IG5ldyBDaW5lVmF1bHRWaWV3KGxlYWYsIHRoaXMpXG5cdFx0KTtcblxuXHRcdHRoaXMuYWRkUmliYm9uSWNvbihcImNsYXBwZXJib2FyZFwiLCBcIkNpbmVWYXVsdFwiLCBhc3luYyAoKSA9PiB7XG5cdFx0XHRhd2FpdCB0aGlzLm9wZW5OZXdUYWIoKTtcblx0XHR9KTtcblx0fVxuXG5cdC8vIFVubW91bnQgdGhlIHN0YXR1cyBiYXIgZWxlbWVudCB3aGVuIHRoZSBwbHVnaW4gaXMgZGlzYWJsZWRcblx0b251bmxvYWQoKSB7XG5cdH1cblxuXHRwcml2YXRlIGFzeW5jIGxvYWRQbHVnaW5EYXRhKCkge1xuXHRcdGNvbnN0IGRhdGEgPSAoYXdhaXQgdGhpcy5sb2FkRGF0YSgpKSBhcyBDaW5lVmF1bHRQbHVnaW5EYXRhIHwgbnVsbDtcblx0XHR0aGlzLmxvY2FsSnNvblBhdGggPSBkYXRhPy5sb2NhbEpzb25QYXRoID8/IG51bGw7XG5cdFx0dGhpcy5vbWRiQXBpS2V5ID0gZGF0YT8ub21kYkFwaUtleSA/PyBcIlwiO1xuXHRcdHRoaXMudmlld01vZGUgPSBkYXRhPy52aWV3TW9kZSA/PyBcImdyaWRcIjtcblx0fVxuXG5cdC8vIGV4dGVybmFsSnNvblBhdGggcmVtb3ZlZDsgbm8tb3AgcGxhY2Vob2xkZXIgcmVtb3ZlZFxuXG5cdGFzeW5jIHNldE9tZGJBcGlLZXkoYXBpS2V5OiBzdHJpbmcpIHtcblx0XHR0aGlzLm9tZGJBcGlLZXkgPSBhcGlLZXk7XG5cdFx0YXdhaXQgdGhpcy5zYXZlUGx1Z2luRGF0YSgpO1xuXHR9XG5cblx0YXN5bmMgc2V0Vmlld01vZGUodmlld01vZGU6IFwiZ3JpZFwiIHwgXCJsaXN0XCIpIHtcblx0XHR0aGlzLnZpZXdNb2RlID0gdmlld01vZGU7XG5cdFx0YXdhaXQgdGhpcy5zYXZlUGx1Z2luRGF0YSgpO1xuXHR9XG5cblx0cHJpdmF0ZSBhc3luYyBzYXZlUGx1Z2luRGF0YSgpIHtcblx0XHRjb25zdCBkYXRhOiBDaW5lVmF1bHRQbHVnaW5EYXRhID0ge1xuXHRcdFx0b21kYkFwaUtleTogdGhpcy5vbWRiQXBpS2V5LFxuXHRcdFx0dmlld01vZGU6IHRoaXMudmlld01vZGVcblx0XHR9O1xuXHRcdGlmICh0aGlzLmxvY2FsSnNvblBhdGgpIHtcblx0XHRcdGRhdGEubG9jYWxKc29uUGF0aCA9IHRoaXMubG9jYWxKc29uUGF0aDtcblx0XHR9XG5cdFx0YXdhaXQgdGhpcy5zYXZlRGF0YShkYXRhKTtcblx0fVxuXG5cdGFzeW5jIHNldExvY2FsSnNvblBhdGgocGF0aDogc3RyaW5nIHwgbnVsbCkge1xuXHRcdHRoaXMubG9jYWxKc29uUGF0aCA9IHBhdGg7XG5cdFx0YXdhaXQgdGhpcy5zYXZlUGx1Z2luRGF0YSgpO1xuXHR9XG5cblx0Ly8gT3BlbiBhIG5ldyB0YWIgd2l0aCB0aGUgXCJDaW5lVmF1bHRcIiB2aWV3IHR5cGVcblx0cHJpdmF0ZSBhc3luYyBvcGVuTmV3VGFiKCkge1xuXHRcdGNvbnN0IGV4aXN0aW5nTGVhdmVzID0gdGhpcy5hcHAud29ya3NwYWNlLmdldExlYXZlc09mVHlwZShWSUVXX1RZUEUpO1xuXHRcdGlmIChleGlzdGluZ0xlYXZlcy5sZW5ndGggPiAwKSB7XG5cdFx0XHR0aGlzLmFwcC53b3Jrc3BhY2UucmV2ZWFsTGVhZihleGlzdGluZ0xlYXZlc1swXSk7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0Y29uc3QgbGVhZiA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWFmKHRydWUpO1xuXHRcdGF3YWl0IGxlYWYuc2V0Vmlld1N0YXRlKHtcblx0XHRcdHR5cGU6IFZJRVdfVFlQRSxcblx0XHRcdGFjdGl2ZTogdHJ1ZVxuXHRcdH0pO1xuXHR9XG59IiwgImV4cG9ydCBjb25zdCBWSUVXX1RZUEUgPSBcIkNpbmVWYXVsdFZpZXdcIjsiLCAiaW1wb3J0IHsgSXRlbVZpZXcsIFdvcmtzcGFjZUxlYWYsIFRGaWxlLCBOb3RpY2UsIHNldEljb24gfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCBDaW5lVmF1bHRQbHVnaW4gZnJvbSBcIi4uL21haW5cIjtcbmltcG9ydCB7IFZJRVdfVFlQRSB9IGZyb20gXCIuLi9jb25zdGFudHNcIjtcbmltcG9ydCB0eXBlIHsgQ2luZVZhdWx0RGF0YSwgQ2luZVZhdWx0TW92aWUgfSBmcm9tIFwiLi4vdHlwZXMvY2luZXZhdWx0XCI7XG5pbXBvcnQgeyByZW5kZXJPbmJvYXJkaW5nIH0gZnJvbSBcIi4uL3VpL29uYm9hcmRpbmdcIjtcbmltcG9ydCB7IENpbmVWYXVsdE1vdmllQWN0aW9uTW9kYWwgfSBmcm9tIFwiLi4vdWkvbW9kYWxzL0NpbmVWYXVsdE1vdmllQWN0aW9uTW9kYWxcIjtcbmltcG9ydCB7IENpbmVWYXVsdE1vdmllRGV0YWlsTW9kYWwgfSBmcm9tIFwiLi4vdWkvbW9kYWxzL0NpbmVWYXVsdE1vdmllRGV0YWlsTW9kYWxcIjtcbmltcG9ydCB7IEpzb25GaWxlU3VnZ2VzdE1vZGFsIH0gZnJvbSBcIi4uL3VpL0pzb25GaWxlU3VnZ2VzdE1vZGFsXCI7XG5pbXBvcnQge1xuICBjcmVhdGVFbXB0eU1vdmllLFxuICBjcmVhdGVKc29uRmlsZSxcbiAgZ2V0RGVmYXVsdFBhdGgsXG4gIGdldEZvbGRlcixcbiAgbG9hZExvY2FsRmlsZSxcbiAgc2F2ZUxvY2FsRGF0YVxufSBmcm9tIFwiLi4vc2VydmljZXMvbGlicmFyeVN0b3JhZ2VcIjtcbmltcG9ydCB7IHNlYXJjaE9tZGIsIGdldE9tZGJEZXRhaWxzIH0gZnJvbSBcIi4uL3NlcnZpY2VzL29tZGJTZXJ2aWNlXCI7XG5pbXBvcnQgeyBudWxsU2FmZSB9IGZyb20gXCJzcmMvdXRpbHNcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2luZVZhdWx0VmlldyBleHRlbmRzIEl0ZW1WaWV3IHtcblxuICBwbHVnaW46IENpbmVWYXVsdFBsdWdpbjtcbiAgZmlsZTogVEZpbGUgfCBudWxsID0gbnVsbDtcbiAgZGF0YTogQ2luZVZhdWx0RGF0YSB8IG51bGwgPSBudWxsO1xuICBhY3RpdmVUYWI6IFwidG9XYXRjaFwiIHwgXCJ3YXRjaGVkXCIgPSBcInRvV2F0Y2hcIjtcbiAgbW92aWVzQ29udGFpbmVyOiBIVE1MRWxlbWVudCB8IG51bGwgPSBudWxsO1xuICB2aWV3TW9kZTogXCJncmlkXCIgfCBcImxpc3RcIiA9IFwiZ3JpZFwiO1xuXG4gIGNvbnN0cnVjdG9yKGxlYWY6IFdvcmtzcGFjZUxlYWYsIHBsdWdpbjogQ2luZVZhdWx0UGx1Z2luKSB7XG4gICAgc3VwZXIobGVhZik7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gIH1cblxuICBnZXRWaWV3VHlwZSgpIHtcbiAgICByZXR1cm4gVklFV19UWVBFO1xuICB9XG5cbiAgZ2V0RGlzcGxheVRleHQoKSB7XG4gICAgcmV0dXJuIFwiQ2luZVZhdWx0XCI7XG4gIH1cblxuICAvLyBQcm92aWRlIGEgY3VzdG9tIGljb24gZm9yIHRoZSB2aWV3J3MgdGFiXG4gIGdldEljb24oKTogc3RyaW5nIHtcbiAgICByZXR1cm4gXCJjbGFwcGVyYm9hcmRcIjtcbiAgfVxuXG4gIGFzeW5jIG9uT3BlbigpIHtcbiAgICB0aGlzLnZpZXdNb2RlID0gdGhpcy5wbHVnaW4udmlld01vZGUgPz8gXCJncmlkXCI7XG4gICAgYXdhaXQgdGhpcy5pbml0aWFsaXplRGF0YSgpO1xuICAgIGF3YWl0IHRoaXMucmVuZGVyKCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHJlbmRlcigpIHtcbiAgICBjb25zdCBjb250YWluZXIgPSB0aGlzLmNvbnRhaW5lckVsLmNoaWxkcmVuWzFdIGFzIEhUTUxFbGVtZW50O1xuICAgIGNvbnRhaW5lci5lbXB0eSgpO1xuXG4gICAgY29uc3QgaGVhZGVyID0gY29udGFpbmVyLmNyZWF0ZURpdih7IGNsczogXCJjaW5ldmF1bHQtaGVhZGVyXCIgfSk7XG4gICAgaGVhZGVyLmNyZWF0ZUVsKFwiaDFcIiwge1xuICAgICAgdGV4dDogXCJDaW5lVmF1bHRcIixcbiAgICAgIGNsczogXCJjaW5ldmF1bHQtdGl0bGVcIlxuICAgIH0pO1xuXG4gICAgaGVhZGVyLmNyZWF0ZUVsKFwicFwiLCB7XG4gICAgICB0ZXh0OiBcIkNpbmVWYXVsdCBhbGxvdyB5b3UgdG8gbWFuYWdleW91ciBmYXZvcml0ZXMgbW92aWUgYW5kIHR2IGxpYnJhcnkgaW50byB5b3VyIHZhdWx0LiBTZWFyY2ggT01EYiwgcmF0ZSB0aXRsZXMsIGFuZCBzdG9yZSB5b3VyIGNvbGxlY3Rpb24gaW4gYSBqc29uIGZpbGUgd2l0aGluIHlvdXIgdmF1bHQuXCIsXG4gICAgICBjbHM6IFwiY2luZXZhdWx0LWhlYWRlci10ZXh0XCJcbiAgICB9KTtcblxuICAgIGlmICghdGhpcy5kYXRhKSB7XG4gICAgICByZW5kZXJPbmJvYXJkaW5nKGNvbnRhaW5lciwgYXN5bmMgKCkgPT4ge1xuICAgICAgICB0aGlzLmZpbGUgPSBhd2FpdCBjcmVhdGVKc29uRmlsZSh0aGlzLnBsdWdpbi5hcHApO1xuICAgICAgICBpZiAodGhpcy5maWxlKSB7XG4gICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2V0TG9jYWxKc29uUGF0aCh0aGlzLmZpbGUucGF0aCk7XG4gICAgICAgIH1cbiAgICAgICAgYXdhaXQgdGhpcy5sb2FkRmlsZSh0aGlzLmZpbGUpO1xuICAgICAgICBhd2FpdCB0aGlzLnJlbmRlcigpO1xuICAgICAgfSwgKCkgPT4ge1xuICAgICAgICAvLyBPcGVuIG1vZGFsIHRvIHNlbGVjdCBKU09OIGZpbGUgZnJvbSB2YXVsdFxuICAgICAgICBuZXcgSnNvbkZpbGVTdWdnZXN0TW9kYWwodGhpcy5wbHVnaW4uYXBwLCBhc3luYyAoZmlsZSkgPT4ge1xuICAgICAgICAgIGF3YWl0IHRoaXMubG9hZEZpbGUoZmlsZSk7XG4gICAgICAgICAgYXdhaXQgdGhpcy5yZW5kZXIoKTtcbiAgICAgICAgfSkub3BlbigpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3Qgc2VhcmNoQm94ID0gY29udGFpbmVyLmNyZWF0ZURpdih7IGNsczogXCJjaW5ldmF1bHQtc2VhcmNoXCIgfSk7XG4gICAgY29uc3Qgc2VhcmNoSW5wdXQgPSBzZWFyY2hCb3guY3JlYXRlRWwoXCJpbnB1dFwiLCB7XG4gICAgICBjbHM6IFwiY2luZXZhdWx0LXNlYXJjaC1pbnB1dFwiLFxuICAgICAgYXR0cjoge1xuICAgICAgICBwbGFjZWhvbGRlcjogXCJTZWFyY2hcIlxuICAgICAgfVxuICAgIH0pO1xuICAgIGNvbnN0IHJlc3VsdHNMaXN0ID0gc2VhcmNoQm94LmNyZWF0ZURpdih7IGNsczogXCJjaW5ldmF1bHQtc2VhcmNoLXJlc3VsdHNcIiB9KTtcblxuICAgIGNvbnN0IGNvbnRlbnQgPSBjb250YWluZXIuY3JlYXRlRGl2KHsgY2xzOiBcImNpbmV2YXVsdC1jb250ZW50XCIgfSk7XG4gICAgdGhpcy5tb3ZpZXNDb250YWluZXIgPSBjb250ZW50O1xuXG4gICAgdGhpcy5yZW5kZXJNb3ZpZXMoY29udGVudCk7XG5cbiAgICBsZXQgc2VhcmNoVGltZW91dDogbnVtYmVyIHwgbnVsbCA9IG51bGw7XG4gICAgc2VhcmNoSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgIGlmIChzZWFyY2hUaW1lb3V0KSB3aW5kb3cuY2xlYXJUaW1lb3V0KHNlYXJjaFRpbWVvdXQpO1xuICAgICAgc2VhcmNoVGltZW91dCA9IHdpbmRvdy5zZXRUaW1lb3V0KGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcXVlcnkgPSBzZWFyY2hJbnB1dC52YWx1ZS50cmltKCk7XG4gICAgICAgIGF3YWl0IHRoaXMucmVuZGVyU2VhcmNoUmVzdWx0cyhyZXN1bHRzTGlzdCwgcXVlcnkpO1xuICAgICAgfSwgMzUwKTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgcmVuZGVyTW92aWVzKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQpIHtcbiAgICBjb250YWluZXIuZW1wdHkoKTtcblxuICAgIGlmICghdGhpcy5kYXRhKSB7XG4gICAgICBjb250YWluZXIuY3JlYXRlRWwoXCJwXCIsIHsgdGV4dDogXCJObyBsaWJyYXJ5IGxvYWRlZC5cIiB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCB3YXRjaGVkID0gdGhpcy5kYXRhLm1vdmllcy5maWx0ZXIoKG1vdmllKSA9PiBtb3ZpZS53YXRjaGVkKTtcbiAgICBjb25zdCB0b1dhdGNoID0gdGhpcy5kYXRhLm1vdmllcy5maWx0ZXIoKG1vdmllKSA9PiAhbW92aWUud2F0Y2hlZCk7XG5cbiAgICBjb25zdCB0YWJzQ29udGFpbmVyID0gY29udGFpbmVyLmNyZWF0ZURpdih7IGNsczogXCJjaW5ldmF1bHQtdGFicy1jb250YWluZXJcIiB9KTtcbiAgICBjb25zdCB0YWJIZWFkZXIgPSB0YWJzQ29udGFpbmVyLmNyZWF0ZURpdih7IGNsczogXCJjaW5ldmF1bHQtdGFiLWhlYWRlclwiIH0pO1xuXG4gICAgY29uc3QgdGFiQnV0dG9ucyA9IHRhYkhlYWRlci5jcmVhdGVEaXYoeyBjbHM6IFwiY2luZXZhdWx0LXRhYi1idXR0b25zXCIgfSk7XG4gICAgY29uc3Qgdmlld1RvZ2dsZSA9IHRhYkhlYWRlci5jcmVhdGVEaXYoeyBjbHM6IFwiY2luZXZhdWx0LXZpZXctdG9nZ2xlXCIgfSk7XG5cbiAgICBjb25zdCB0b1dhdGNoQnV0dG9uID0gdGFiQnV0dG9ucy5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwiY2luZXZhdWx0LXRhYi1idXR0b25cIixcbiAgICAgIHRleHQ6IGBUbyBXYXRjaCAoJHt0b1dhdGNoLmxlbmd0aH0pYFxuICAgIH0pO1xuICAgIGNvbnN0IHdhdGNoZWRCdXR0b24gPSB0YWJCdXR0b25zLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJjaW5ldmF1bHQtdGFiLWJ1dHRvblwiLFxuICAgICAgdGV4dDogYFdhdGNoZWQgKCR7d2F0Y2hlZC5sZW5ndGh9KWBcbiAgICB9KTtcblxuICAgIGNvbnN0IGdyaWRCdXR0b24gPSB2aWV3VG9nZ2xlLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHtcbiAgICAgIGNsczogXCJjaW5ldmF1bHQtdmlldy1idXR0b25cIixcbiAgICAgIGF0dHI6IHsgXCJhcmlhLWxhYmVsXCI6IFwiR3JpZCB2aWV3XCIsIHRpdGxlOiBcIkdyaWQgdmlld1wiIH1cbiAgICB9KTtcbiAgICBjb25zdCBsaXN0QnV0dG9uID0gdmlld1RvZ2dsZS5jcmVhdGVFbChcImJ1dHRvblwiLCB7XG4gICAgICBjbHM6IFwiY2luZXZhdWx0LXZpZXctYnV0dG9uXCIsXG4gICAgICBhdHRyOiB7IFwiYXJpYS1sYWJlbFwiOiBcIkxpc3Qgdmlld1wiLCB0aXRsZTogXCJMaXN0IHZpZXdcIiB9XG4gICAgfSk7XG5cbiAgICBzZXRJY29uKGdyaWRCdXR0b24sIFwibGF5b3V0LWdyaWRcIik7XG4gICAgc2V0SWNvbihsaXN0QnV0dG9uLCBcImxpc3RcIik7XG5cbiAgICBpZiAodGhpcy5hY3RpdmVUYWIgPT09IFwidG9XYXRjaFwiKSB7XG4gICAgICB0b1dhdGNoQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJjaW5ldmF1bHQtdGFiLWJ1dHRvbi1hY3RpdmVcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHdhdGNoZWRCdXR0b24uY2xhc3NMaXN0LmFkZChcImNpbmV2YXVsdC10YWItYnV0dG9uLWFjdGl2ZVwiKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy52aWV3TW9kZSA9PT0gXCJncmlkXCIpIHtcbiAgICAgIGdyaWRCdXR0b24uY2xhc3NMaXN0LmFkZChcImNpbmV2YXVsdC12aWV3LWJ1dHRvbi1hY3RpdmVcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxpc3RCdXR0b24uY2xhc3NMaXN0LmFkZChcImNpbmV2YXVsdC12aWV3LWJ1dHRvbi1hY3RpdmVcIik7XG4gICAgfVxuXG4gICAgY29uc3QgdGFiQ29udGVudCA9IHRhYnNDb250YWluZXIuY3JlYXRlRGl2KHsgY2xzOiBcImNpbmV2YXVsdC10YWItY29udGVudFwiIH0pO1xuICAgIGNvbnN0IGFjdGl2ZU1vdmllcyA9IHRoaXMuYWN0aXZlVGFiID09PSBcInRvV2F0Y2hcIiA/IHRvV2F0Y2ggOiB3YXRjaGVkO1xuICAgIGNvbnN0IGFjdGl2ZVRpdGxlID0gdGhpcy5hY3RpdmVUYWIgPT09IFwidG9XYXRjaFwiID8gXCJUbyBXYXRjaFwiIDogXCJXYXRjaGVkXCI7XG4gICAgdGhpcy5yZW5kZXJNb3ZpZVNlY3Rpb24odGFiQ29udGVudCwgYWN0aXZlVGl0bGUsIGFjdGl2ZU1vdmllcyk7XG5cbiAgICB0b1dhdGNoQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBpZiAodGhpcy5hY3RpdmVUYWIgPT09IFwidG9XYXRjaFwiKSByZXR1cm47XG4gICAgICB0aGlzLmFjdGl2ZVRhYiA9IFwidG9XYXRjaFwiO1xuICAgICAgdGhpcy5yZW5kZXJNb3ZpZXMoY29udGFpbmVyKTtcbiAgICB9KTtcblxuICAgIHdhdGNoZWRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIGlmICh0aGlzLmFjdGl2ZVRhYiA9PT0gXCJ3YXRjaGVkXCIpIHJldHVybjtcbiAgICAgIHRoaXMuYWN0aXZlVGFiID0gXCJ3YXRjaGVkXCI7XG4gICAgICB0aGlzLnJlbmRlck1vdmllcyhjb250YWluZXIpO1xuICAgIH0pO1xuXG4gICAgZ3JpZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgaWYgKHRoaXMudmlld01vZGUgPT09IFwiZ3JpZFwiKSByZXR1cm47XG4gICAgICB0aGlzLnZpZXdNb2RlID0gXCJncmlkXCI7XG4gICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zZXRWaWV3TW9kZShcImdyaWRcIik7XG4gICAgICB0aGlzLnJlbmRlck1vdmllcyhjb250YWluZXIpO1xuICAgIH0pO1xuXG4gICAgbGlzdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgaWYgKHRoaXMudmlld01vZGUgPT09IFwibGlzdFwiKSByZXR1cm47XG4gICAgICB0aGlzLnZpZXdNb2RlID0gXCJsaXN0XCI7XG4gICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zZXRWaWV3TW9kZShcImxpc3RcIik7XG4gICAgICB0aGlzLnJlbmRlck1vdmllcyhjb250YWluZXIpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSByZW5kZXJNb3ZpZVNlY3Rpb24oY29udGFpbmVyOiBIVE1MRWxlbWVudCwgdGl0bGU6IHN0cmluZywgbW92aWVzOiBDaW5lVmF1bHRNb3ZpZVtdKSB7XG4gICAgY29uc3Qgc2VjdGlvbiA9IGNvbnRhaW5lci5jcmVhdGVEaXYoeyBjbHM6IFwiY2luZXZhdWx0LXNlY3Rpb25cIiB9KTtcbiAgICBzZWN0aW9uLmNyZWF0ZUVsKFwiaDNcIiwgeyB0ZXh0OiB0aXRsZSB9KTtcblxuICAgIGlmIChtb3ZpZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICBzZWN0aW9uLmNyZWF0ZUVsKFwicFwiLCB7IHRleHQ6IFwiTm8gbW92aWVzIGluIHRoaXMgbGlzdC5cIiB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBsaXN0ID0gc2VjdGlvbi5jcmVhdGVEaXYoe1xuICAgICAgY2xzOiB0aGlzLnZpZXdNb2RlID09PSBcImdyaWRcIiA/IFwiY2luZXZhdWx0LW1vdmllLWdyaWRcIiA6IFwiY2luZXZhdWx0LW1vdmllLWxpc3RcIlxuICAgIH0pO1xuXG4gICAgaWYgKHRoaXMudmlld01vZGUgPT09IFwiZ3JpZFwiKSB7XG4gICAgICB0aGlzLnJlbmRlck1vdmllR3JpZChsaXN0LCBtb3ZpZXMpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnJlbmRlck1vdmllTGlzdChsaXN0LCBtb3ZpZXMpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcmVuZGVyTW92aWVHcmlkKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIG1vdmllczogQ2luZVZhdWx0TW92aWVbXSkge1xuICAgIG1vdmllcy5mb3JFYWNoKChtb3ZpZSkgPT4ge1xuICAgICAgY29uc3QgY2FyZCA9IGNvbnRhaW5lci5jcmVhdGVEaXYoeyBjbHM6IFwiY2luZXZhdWx0LW1vdmllLWNhcmRcIiB9KTtcbiAgICAgIGNhcmQuY3JlYXRlRWwoXCJpbWdcIiwgeyBjbHM6IFwiY2luZXZhdWx0LW1vdmllLXBvc3RlclwiIH0pLnNldEF0dHJpYnV0ZShcInNyY1wiLCBtb3ZpZS5wb3N0ZXIpO1xuICAgICAgY2FyZC5jcmVhdGVFbChcImRpdlwiLCB7IHRleHQ6IG1vdmllLnRpdGxlLCBjbHM6IFwiY2luZXZhdWx0LW1vdmllLXRpdGxlXCIgfSk7XG5cbiAgICAgIC8vIEJ1aWxkIHRoZSBkZXRhaWxzIHN0cmluZyBjb25kaXRpb25hbGx5LCBvbmx5IGluY2x1ZGluZyBub24tbnVsbC91bmRlZmluZWQgdmFsdWVzXG4gICAgICBjb25zdCBkZXRhaWxzUGFydHM6IHN0cmluZ1tdID0gW107XG4gICAgICBjb25zdCB5ZWFyID0gbnVsbFNhZmUoKCkgPT4gbW92aWUueWVhciwgbnVsbCk7XG4gICAgICBjb25zdCB0eXBlID0gbnVsbFNhZmUoKCkgPT4gbW92aWUudHlwZVswXS50b1VwcGVyQ2FzZSgpICsgbW92aWUudHlwZS5zbGljZSgxKSwgbnVsbCk7XG5cbiAgICAgIGlmICh5ZWFyKSBkZXRhaWxzUGFydHMucHVzaCh5ZWFyKTtcbiAgICAgIGlmICh0eXBlKSBkZXRhaWxzUGFydHMucHVzaCh0eXBlKTtcblxuICAgICAgY29uc3QgZGV0YWlsc1RleHQgPSBkZXRhaWxzUGFydHMuam9pbihcIiAtIFwiKTtcbiAgICAgIGlmIChkZXRhaWxzVGV4dCkge1xuICAgICAgICBjYXJkLmNyZWF0ZUVsKFwiZGl2XCIsIHsgdGV4dDogZGV0YWlsc1RleHQsIGNsczogXCJjaW5ldmF1bHQtbW92aWUteWVhclwiIH0pO1xuICAgICAgfVxuXG4gICAgICBjYXJkLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB0aGlzLm9wZW5Nb3ZpZURldGFpbHMobW92aWUpKTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgcmVuZGVyTW92aWVMaXN0KGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIG1vdmllczogQ2luZVZhdWx0TW92aWVbXSkge1xuICAgIG1vdmllcy5mb3JFYWNoKChtb3ZpZSkgPT4ge1xuICAgICAgY29uc3Qgcm93ID0gY29udGFpbmVyLmNyZWF0ZURpdih7IGNsczogXCJjaW5ldmF1bHQtbW92aWUtcm93XCIgfSk7XG4gICAgICBjb25zdCBwb3N0ZXIgPSByb3cuY3JlYXRlRWwoXCJpbWdcIiwgeyBjbHM6IFwiY2luZXZhdWx0LW1vdmllLXRodW1ibmFpbFwiIH0pO1xuICAgICAgcG9zdGVyLnNldEF0dHJpYnV0ZShcInNyY1wiLCBtb3ZpZS5wb3N0ZXIgfHwgXCJcIik7XG5cbiAgICAgIGNvbnN0IGluZm8gPSByb3cuY3JlYXRlRGl2KHsgY2xzOiBcImNpbmV2YXVsdC1tb3ZpZS1pbmZvXCIgfSk7XG4gICAgICBpbmZvLmNyZWF0ZUVsKFwiZGl2XCIsIHsgdGV4dDogbW92aWUudGl0bGUsIGNsczogXCJjaW5ldmF1bHQtbW92aWUtdGl0bGVcIiB9KTtcblxuICAgICAgLy8gQnVpbGQgdGhlIGRldGFpbHMgc3RyaW5nIGNvbmRpdGlvbmFsbHksIG9ubHkgaW5jbHVkaW5nIG5vbi1udWxsL3VuZGVmaW5lZCB2YWx1ZXNcbiAgICAgIGNvbnN0IGRldGFpbHNQYXJ0czogc3RyaW5nW10gPSBbXTtcbiAgICAgIGNvbnN0IHllYXIgPSBudWxsU2FmZSgoKSA9PiBtb3ZpZS55ZWFyLCBudWxsKTtcbiAgICAgIGNvbnN0IHR5cGUgPSBudWxsU2FmZSgoKSA9PiBtb3ZpZS50eXBlWzBdLnRvVXBwZXJDYXNlKCkgKyBtb3ZpZS50eXBlLnNsaWNlKDEpLCBudWxsKTtcblxuICAgICAgaWYgKHllYXIpIGRldGFpbHNQYXJ0cy5wdXNoKHllYXIpO1xuICAgICAgaWYgKHR5cGUpIGRldGFpbHNQYXJ0cy5wdXNoKHR5cGUpO1xuXG4gICAgICBjb25zdCBkZXRhaWxzVGV4dCA9IGRldGFpbHNQYXJ0cy5qb2luKFwiIC0gXCIpO1xuICAgICAgaWYgKGRldGFpbHNUZXh0KSB7XG4gICAgICAgIGluZm8uY3JlYXRlRWwoXCJkaXZcIiwgeyB0ZXh0OiBkZXRhaWxzVGV4dCwgY2xzOiBcImNpbmV2YXVsdC1tb3ZpZS15ZWFyXCIgfSk7XG4gICAgICB9XG5cbiAgICAgIHJvdy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gdGhpcy5vcGVuTW92aWVEZXRhaWxzKG1vdmllKSk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIG9wZW5Nb3ZpZURldGFpbHMobW92aWU6IENpbmVWYXVsdE1vdmllKSB7XG4gICAgbmV3IENpbmVWYXVsdE1vdmllRGV0YWlsTW9kYWwodGhpcy5wbHVnaW4uYXBwLCBtb3ZpZSwgYXN5bmMgKHJhdGluZykgPT4ge1xuICAgICAgaWYgKCF0aGlzLmRhdGEpIHJldHVybjtcbiAgICAgIG1vdmllLnN0YXJSYXRpbmcgPSByYXRpbmc7XG4gICAgICBhd2FpdCB0aGlzLnNhdmVEYXRhKCk7XG4gICAgICB0aGlzLnJlZnJlc2hNb3ZpZXMoKTtcbiAgICB9LCBhc3luYyAoKSA9PiB7XG4gICAgICBpZiAoIXRoaXMuZGF0YSkgcmV0dXJuO1xuICAgICAgdGhpcy5kYXRhLm1vdmllcyA9IHRoaXMuZGF0YS5tb3ZpZXMuZmlsdGVyKChpdGVtKSA9PiBpdGVtLmlkICE9PSBtb3ZpZS5pZCk7XG4gICAgICBhd2FpdCB0aGlzLnNhdmVEYXRhKCk7XG4gICAgICB0aGlzLnJlZnJlc2hNb3ZpZXMoKTtcbiAgICB9LCBhc3luYyAoKSA9PiB7XG4gICAgICBpZiAoIXRoaXMuZGF0YSkgcmV0dXJuO1xuICAgICAgbW92aWUud2F0Y2hlZCA9ICFtb3ZpZS53YXRjaGVkO1xuICAgICAgYXdhaXQgdGhpcy5zYXZlRGF0YSgpO1xuICAgICAgdGhpcy5yZWZyZXNoTW92aWVzKCk7XG4gICAgfSkub3BlbigpO1xuICB9XG5cbiAgcHJpdmF0ZSByZWZyZXNoTW92aWVzKCkge1xuICAgIGlmICghdGhpcy5tb3ZpZXNDb250YWluZXIpIHJldHVybjtcbiAgICB0aGlzLnJlbmRlck1vdmllcyh0aGlzLm1vdmllc0NvbnRhaW5lcik7XG4gIH1cblxuICBwcml2YXRlIGdldEpzb25GaWxlcygpOiBURmlsZVtdIHtcbiAgICByZXR1cm4gdGhpcy5wbHVnaW4uYXBwLnZhdWx0LmdldEZpbGVzKCkuZmlsdGVyKChmaWxlKSA9PiBmaWxlLmV4dGVuc2lvbiA9PT0gXCJqc29uXCIpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBpbml0aWFsaXplRGF0YSgpIHtcbiAgICAvLyBQcmVmZXIgYSBsb2NhbGx5IGxpbmtlZCBmaWxlIGluc2lkZSB0aGUgdmF1bHQgaWYgY29uZmlndXJlZFxuICAgIGNvbnN0IGxvY2FsUGF0aCA9IHRoaXMucGx1Z2luLmxvY2FsSnNvblBhdGg7XG4gICAgaWYgKGxvY2FsUGF0aCkge1xuICAgICAgY29uc3QgbG9jYWxGaWxlID0gdGhpcy5wbHVnaW4uYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChsb2NhbFBhdGgpO1xuICAgICAgaWYgKGxvY2FsRmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgIGF3YWl0IHRoaXMubG9hZEZpbGUobG9jYWxGaWxlKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIE5vIGxpbmtlZCBmaWxlcyBmb3VuZCBcdTIwMTQgZG9uJ3QgY3JlYXRlIGZvbGRlcnMvZmlsZXMgYXV0b21hdGljYWxseS4gU2hvdyBvbmJvYXJkaW5nLlxuICAgIHRoaXMuZmlsZSA9IG51bGw7XG4gICAgdGhpcy5kYXRhID0gbnVsbDtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgbG9hZEZpbGUoZmlsZTogVEZpbGUpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcGFyc2VkID0gYXdhaXQgbG9hZExvY2FsRmlsZSh0aGlzLnBsdWdpbi5hcHAsIGZpbGUpO1xuICAgICAgdGhpcy5maWxlID0gZmlsZTtcbiAgICAgIHRoaXMuZGF0YSA9IHBhcnNlZDtcbiAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNldExvY2FsSnNvblBhdGgoZmlsZS5wYXRoKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5kYXRhID0gbnVsbDtcbiAgICAgIHRoaXMuZmlsZSA9IG51bGw7XG4gICAgICBuZXcgTm90aWNlKFwiVW5hYmxlIHRvIHJlYWQgdGhlIEpTT04gZmlsZS5cIik7XG4gICAgfVxuICB9XG4gIHByaXZhdGUgYXN5bmMgc2F2ZURhdGEoKSB7XG4gICAgaWYgKCF0aGlzLmRhdGEpIHJldHVybjtcbiAgICB0aGlzLmRhdGEudXBkYXRlZEF0ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgIGlmICh0aGlzLmZpbGUpIHtcbiAgICAgIGF3YWl0IHNhdmVMb2NhbERhdGEodGhpcy5wbHVnaW4uYXBwLCB0aGlzLmZpbGUsIHRoaXMuZGF0YSk7XG4gICAgfVxuICB9XG5cblxuICBwcml2YXRlIGFzeW5jIHJlbmRlclNlYXJjaFJlc3VsdHMoY29udGFpbmVyOiBIVE1MRWxlbWVudCwgcXVlcnk6IHN0cmluZykge1xuICAgIGNvbnRhaW5lci5lbXB0eSgpO1xuICAgIGlmICghcXVlcnkgfHwgcXVlcnkubGVuZ3RoIDwgMikgcmV0dXJuO1xuXG4gICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IHNlYXJjaE9tZGIocXVlcnksIHRoaXMucGx1Z2luLm9tZGJBcGlLZXkpO1xuICAgIGlmIChyZXN1bHRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgY29udGFpbmVyLmNyZWF0ZUVsKFwiZGl2XCIsIHsgdGV4dDogXCJObyByZXN1bHRzIGZvdW5kLlwiLCBjbHM6IFwiY2luZXZhdWx0LXNlYXJjaC1lbXB0eVwiIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHJlc3VsdHMuZm9yRWFjaCgocmVzdWx0KSA9PiB7XG4gICAgICBjb25zdCBpdGVtID0gY29udGFpbmVyLmNyZWF0ZURpdih7IGNsczogXCJjaW5ldmF1bHQtc2VhcmNoLWl0ZW1cIiB9KTtcbiAgICAgIGlmIChyZXN1bHQucG9zdGVyKSB7XG4gICAgICAgIGl0ZW0uY3JlYXRlRWwoXCJpbWdcIiwgeyBjbHM6IFwiY2luZXZhdWx0LXNlYXJjaC1wb3N0ZXJcIiB9KS5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgcmVzdWx0LnBvc3Rlcik7XG4gICAgICB9XG4gICAgICBjb25zdCBpbmZvID0gaXRlbS5jcmVhdGVEaXYoeyBjbHM6IFwiY2luZXZhdWx0LXNlYXJjaC1pbmZvXCIgfSk7XG4gICAgICBpbmZvLmNyZWF0ZUVsKFwiZGl2XCIsIHsgdGV4dDogcmVzdWx0LnRpdGxlLCBjbHM6IFwiY2luZXZhdWx0LXNlYXJjaC10aXRsZVwiIH0pO1xuICAgICAgaW5mby5jcmVhdGVFbChcImRpdlwiLCB7IHRleHQ6IHJlc3VsdC55ZWFyLCBjbHM6IFwiY2luZXZhdWx0LXNlYXJjaC15ZWFyXCIgfSk7XG5cbiAgICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgbmV3IENpbmVWYXVsdE1vdmllQWN0aW9uTW9kYWwodGhpcy5wbHVnaW4uYXBwLCByZXN1bHQsIGFzeW5jICh3YXRjaGVkKSA9PiB7XG4gICAgICAgICAgaWYgKCF0aGlzLmRhdGEpIHJldHVybjtcblxuICAgICAgICAgIGNvbnN0IGV4aXN0aW5nID0gdGhpcy5kYXRhLm1vdmllcy5maW5kKChtb3ZpZSkgPT4gbW92aWUuaW1kYklkID09PSByZXN1bHQuaW1kYklkKTtcbiAgICAgICAgICBpZiAoZXhpc3RpbmcpIHtcbiAgICAgICAgICAgIGV4aXN0aW5nLndhdGNoZWQgPSB3YXRjaGVkO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBGZXRjaCBmdWxsIG1vdmllIGRldGFpbHMgZnJvbSBPTURiXG4gICAgICAgICAgICBuZXcgTm90aWNlKGBMb2FkaW5nIGRldGFpbHMgZm9yICR7cmVzdWx0LnRpdGxlfS4uLmApO1xuICAgICAgICAgICAgY29uc3QgZGV0YWlscyA9IGF3YWl0IGdldE9tZGJEZXRhaWxzKHJlc3VsdC5pbWRiSWQsIHRoaXMucGx1Z2luLm9tZGJBcGlLZXkpO1xuXG4gICAgICAgICAgICBpZiAoIWRldGFpbHMpIHtcbiAgICAgICAgICAgICAgbmV3IE5vdGljZShcIlVuYWJsZSB0byBsb2FkIG1vdmllIGRldGFpbHMuXCIpO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IG5ld01vdmllID0gY3JlYXRlRW1wdHlNb3ZpZSgpO1xuICAgICAgICAgICAgbmV3TW92aWUuaW1kYklkID0gZGV0YWlscy5pbWRiSUQgfHwgcmVzdWx0LmltZGJJZDtcbiAgICAgICAgICAgIG5ld01vdmllLnRpdGxlID0gZGV0YWlscy5UaXRsZSB8fCByZXN1bHQudGl0bGU7XG4gICAgICAgICAgICBuZXdNb3ZpZS55ZWFyID0gZGV0YWlscy5ZZWFyIHx8IHJlc3VsdC55ZWFyO1xuICAgICAgICAgICAgbmV3TW92aWUucmF0ZWQgPSBkZXRhaWxzLlJhdGVkIHx8IFwiXCI7XG4gICAgICAgICAgICBuZXdNb3ZpZS5yZWxlYXNlZCA9IGRldGFpbHMuUmVsZWFzZWQgfHwgXCJcIjtcbiAgICAgICAgICAgIG5ld01vdmllLnJ1bnRpbWUgPSBkZXRhaWxzLlJ1bnRpbWUgfHwgXCJcIjtcbiAgICAgICAgICAgIG5ld01vdmllLmdlbnJlID0gZGV0YWlscy5HZW5yZSB8fCBcIlwiO1xuICAgICAgICAgICAgbmV3TW92aWUuZGlyZWN0b3IgPSBkZXRhaWxzLkRpcmVjdG9yIHx8IFwiXCI7XG4gICAgICAgICAgICBuZXdNb3ZpZS53cml0ZXIgPSBkZXRhaWxzLldyaXRlciB8fCBcIlwiO1xuICAgICAgICAgICAgbmV3TW92aWUuYWN0b3JzID0gZGV0YWlscy5BY3RvcnMgfHwgXCJcIjtcbiAgICAgICAgICAgIG5ld01vdmllLnBsb3QgPSBkZXRhaWxzLlBsb3QgfHwgcmVzdWx0LnBsb3Q7XG4gICAgICAgICAgICBuZXdNb3ZpZS5sYW5ndWFnZSA9IGRldGFpbHMuTGFuZ3VhZ2UgfHwgXCJcIjtcbiAgICAgICAgICAgIG5ld01vdmllLmNvdW50cnkgPSBkZXRhaWxzLkNvdW50cnkgfHwgXCJcIjtcbiAgICAgICAgICAgIG5ld01vdmllLmF3YXJkcyA9IGRldGFpbHMuQXdhcmRzIHx8IFwiXCI7XG4gICAgICAgICAgICBuZXdNb3ZpZS5wb3N0ZXIgPSBkZXRhaWxzLlBvc3RlciAmJiBkZXRhaWxzLlBvc3RlciAhPT0gXCJOL0FcIiA/IGRldGFpbHMuUG9zdGVyIDogcmVzdWx0LnBvc3RlcjtcbiAgICAgICAgICAgIG5ld01vdmllLnBvc3RlckxvY2FsID0gXCJcIjtcbiAgICAgICAgICAgIG5ld01vdmllLnJhdGluZ3MgPSBkZXRhaWxzLlJhdGluZ3MgfHwgW107XG4gICAgICAgICAgICBuZXdNb3ZpZS5tZXRhc2NvcmUgPSBkZXRhaWxzLk1ldGFzY29yZSB8fCBcIlwiO1xuICAgICAgICAgICAgbmV3TW92aWUuaW1kYlJhdGluZyA9IGRldGFpbHMuaW1kYlJhdGluZyB8fCBcIlwiO1xuICAgICAgICAgICAgbmV3TW92aWUuaW1kYlZvdGVzID0gZGV0YWlscy5pbWRiVm90ZXMgfHwgXCJcIjtcbiAgICAgICAgICAgIG5ld01vdmllLnR5cGUgPSBkZXRhaWxzLlR5cGUgfHwgcmVzdWx0LnR5cGU7XG4gICAgICAgICAgICBuZXdNb3ZpZS5kdmQgPSBkZXRhaWxzLkRWRCB8fCBcIlwiO1xuICAgICAgICAgICAgbmV3TW92aWUuYm94T2ZmaWNlID0gZGV0YWlscy5Cb3hPZmZpY2UgfHwgXCJcIjtcbiAgICAgICAgICAgIG5ld01vdmllLnByb2R1Y3Rpb24gPSBkZXRhaWxzLlByb2R1Y3Rpb24gfHwgXCJcIjtcbiAgICAgICAgICAgIG5ld01vdmllLndlYnNpdGUgPSBkZXRhaWxzLldlYnNpdGUgfHwgXCJcIjtcbiAgICAgICAgICAgIG5ld01vdmllLnRvdGFsU2Vhc29ucyA9IGRldGFpbHMudG90YWxTZWFzb25zIHx8IFwiXCI7XG4gICAgICAgICAgICBuZXdNb3ZpZS53YXRjaGVkID0gd2F0Y2hlZDtcblxuICAgICAgICAgICAgdGhpcy5kYXRhLm1vdmllcy5wdXNoKG5ld01vdmllKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgYXdhaXQgdGhpcy5zYXZlRGF0YSgpO1xuICAgICAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICAgIH0pLm9wZW4oKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG59IiwgImV4cG9ydCBmdW5jdGlvbiByZW5kZXJPbmJvYXJkaW5nKFxuICBjb250YWluZXI6IEhUTUxFbGVtZW50LFxuICBvbkNyZWF0ZTogKCkgPT4gdm9pZCxcbiAgb25MaW5rPzogKCkgPT4gdm9pZFxuKSB7XG4gIGNvbnN0IG9uYm9hcmRpbmcgPSBjb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICBjbHM6IFwiY2luZXZhdWx0LW9uYm9hcmRpbmdcIlxuICB9KTtcblxuICBjb25zdCBhY3Rpb25zID0gb25ib2FyZGluZy5jcmVhdGVEaXYoeyBjbHM6IFwiY2luZXZhdWx0LW9uYm9hcmRpbmctYWN0aW9uc1wiIH0pO1xuICBjb25zdCBjcmVhdGVCdXR0b24gPSBhY3Rpb25zLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHsgdGV4dDogXCJDcmVhdGUgbmV3IGxpYnJhcnlcIiB9KTtcbiAgY3JlYXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBvbkNyZWF0ZSk7XG5cbiAgaWYgKG9uTGluaykge1xuICAgIGFjdGlvbnMuY3JlYXRlRWwoXCJwXCIsIHsgdGV4dDogXCJvclwiIH0pO1xuICAgIGNvbnN0IGxpbmtCdXR0b24gPSBhY3Rpb25zLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHsgdGV4dDogXCJMaW5rIGV4aXN0aW5nIGxpYnJhcnlcIiB9KTtcbiAgICBsaW5rQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBvbkxpbmspO1xuICB9XG59IiwgImltcG9ydCB7IE1vZGFsIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgdHlwZSB7IENpbmVWYXVsdFNlYXJjaEl0ZW0gfSBmcm9tIFwiLi4vLi4vdHlwZXMvY2luZXZhdWx0XCI7XG5cbmV4cG9ydCBjbGFzcyBDaW5lVmF1bHRNb3ZpZUFjdGlvbk1vZGFsIGV4dGVuZHMgTW9kYWwge1xuICBwcml2YXRlIG1vdmllOiBDaW5lVmF1bHRTZWFyY2hJdGVtO1xuICBwcml2YXRlIG9uU2F2ZTogKHdhdGNoZWQ6IGJvb2xlYW4pID0+IHZvaWQ7XG5cbiAgY29uc3RydWN0b3IoYXBwOiBNb2RhbFtcImFwcFwiXSwgbW92aWU6IENpbmVWYXVsdFNlYXJjaEl0ZW0sIG9uU2F2ZTogKHdhdGNoZWQ6IGJvb2xlYW4pID0+IHZvaWQpIHtcbiAgICBzdXBlcihhcHApO1xuICAgIHRoaXMubW92aWUgPSBtb3ZpZTtcbiAgICB0aGlzLm9uU2F2ZSA9IG9uU2F2ZTtcbiAgfVxuXG4gIG9uT3BlbigpIHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcblxuICAgIGNvbnRlbnRFbC5jcmVhdGVFbChcImgzXCIsIHsgdGV4dDogdGhpcy5tb3ZpZS50aXRsZSB9KTtcbiAgICBjb250ZW50RWwuY3JlYXRlRWwoXCJwXCIsIHsgdGV4dDogYCR7dGhpcy5tb3ZpZS55ZWFyfSBcdTIwMjIgJHt0aGlzLm1vdmllLnR5cGV9YCB9KTtcbiAgICBpZiAodGhpcy5tb3ZpZS5wb3N0ZXIpIHtcbiAgICAgIGNvbnRlbnRFbC5jcmVhdGVFbChcImltZ1wiLCB7IGNsczogXCJjaW5ldmF1bHQtbW9kYWwtcG9zdGVyXCIgfSkuc2V0QXR0cmlidXRlKFwic3JjXCIsIHRoaXMubW92aWUucG9zdGVyKTtcbiAgICB9XG4gICAgY29udGVudEVsLmNyZWF0ZUVsKFwicFwiLCB7IHRleHQ6IHRoaXMubW92aWUucGxvdCB9KTtcblxuICAgIGNvbnN0IGFjdGlvbnMgPSBjb250ZW50RWwuY3JlYXRlRGl2KHsgY2xzOiBcImNpbmV2YXVsdC1tb2RhbC1hY3Rpb25zXCIgfSk7XG4gICAgY29uc3Qgd2F0Y2hlZEJ1dHRvbiA9IGFjdGlvbnMuY3JlYXRlRWwoXCJidXR0b25cIiwgeyB0ZXh0OiBcIk1hcmsgYXMgd2F0Y2hlZFwiIH0pO1xuICAgIGNvbnN0IHRvV2F0Y2hCdXR0b24gPSBhY3Rpb25zLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHsgdGV4dDogXCJUbyB3YXRjaFwiIH0pO1xuXG4gICAgd2F0Y2hlZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5vblNhdmUodHJ1ZSk7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfSk7XG5cbiAgICB0b1dhdGNoQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLm9uU2F2ZShmYWxzZSk7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfSk7XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBNb2RhbCB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHR5cGUgeyBDaW5lVmF1bHRNb3ZpZSB9IGZyb20gXCIuLi8uLi90eXBlcy9jaW5ldmF1bHRcIjtcbmltcG9ydCB7IGNyZWF0ZVN0YXJSYXRpbmcgfSBmcm9tIFwiLi4vc3RhclJhdGluZ1wiO1xuaW1wb3J0IHsgbnVsbFNhZmUgfSBmcm9tIFwic3JjL3V0aWxzXCI7XG5cbmV4cG9ydCBjbGFzcyBDaW5lVmF1bHRNb3ZpZURldGFpbE1vZGFsIGV4dGVuZHMgTW9kYWwge1xuICBwcml2YXRlIG1vdmllOiBDaW5lVmF1bHRNb3ZpZTtcbiAgcHJpdmF0ZSBvblJhdGU6IChyYXRpbmc6IG51bWJlcikgPT4gdm9pZDtcbiAgcHJpdmF0ZSBvblJlbW92ZTogKCkgPT4gdm9pZDtcbiAgcHJpdmF0ZSBvblRvZ2dsZVdhdGNoZWQ6ICgpID0+IHZvaWQ7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgYXBwOiBNb2RhbFtcImFwcFwiXSxcbiAgICBtb3ZpZTogQ2luZVZhdWx0TW92aWUsXG4gICAgb25SYXRlOiAocmF0aW5nOiBudW1iZXIpID0+IHZvaWQsXG4gICAgb25SZW1vdmU6ICgpID0+IHZvaWQsXG4gICAgb25Ub2dnbGVXYXRjaGVkOiAoKSA9PiB2b2lkXG4gICkge1xuICAgIHN1cGVyKGFwcCk7XG4gICAgdGhpcy5tb3ZpZSA9IG1vdmllO1xuICAgIHRoaXMub25SYXRlID0gb25SYXRlO1xuICAgIHRoaXMub25SZW1vdmUgPSBvblJlbW92ZTtcbiAgICB0aGlzLm9uVG9nZ2xlV2F0Y2hlZCA9IG9uVG9nZ2xlV2F0Y2hlZDtcbiAgfVxuXG4gIG9uT3BlbigpIHtcbiAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcblxuICAgIGNvbnN0IG1vZGFsQ29udGFpbmVyID0gY29udGVudEVsLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwiY2luZXZhdWx0LW1vZGFsLWNvbnRhaW5lclwiXG4gICAgfSk7XG5cbiAgICBtb2RhbENvbnRhaW5lci5jcmVhdGVFbChcImgxXCIsIHtcbiAgICAgIHRleHQ6IHRoaXMubW92aWUudGl0bGUsXG4gICAgICBjbHM6IFwiY2luZXZhdWx0LW1vZGFsLXRpdGxlXCJcbiAgICB9KTtcblxuICAgIC8vIFllYXIgYW5kIFR5cGVcbiAgICBjb25zdCB0eXBlID0gbnVsbFNhZmUoKCkgPT4gdGhpcy5tb3ZpZS50eXBlWzBdLnRvVXBwZXJDYXNlKCkgKyB0aGlzLm1vdmllLnR5cGUuc2xpY2UoMSksIG51bGwpO1xuICAgIGNvbnN0IHllYXIgPSBudWxsU2FmZSgoKSA9PiB0aGlzLm1vdmllLnllYXIsIG51bGwpO1xuICAgIG1vZGFsQ29udGFpbmVyLmNyZWF0ZUVsKFwicFwiLCB7XG4gICAgICB0ZXh0OiBgJHt5ZWFyfSAtICR7dHlwZX1gLFxuICAgIH0pO1xuXG4gICAgLy8gUG9zdGVyXG4gICAgaWYgKHRoaXMubW92aWUucG9zdGVyKSB7XG4gICAgICBtb2RhbENvbnRhaW5lci5jcmVhdGVFbChcImltZ1wiLCB7IGNsczogXCJjaW5ldmF1bHQtbW9kYWwtcG9zdGVyXCIgfSkuc2V0QXR0cmlidXRlKFwic3JjXCIsIHRoaXMubW92aWUucG9zdGVyKTtcbiAgICB9XG5cbiAgICAvLyBQbG90XG4gICAgaWYgKHRoaXMubW92aWUucGxvdCkge1xuICAgICAgY29uc3QgcGxvdENvbnRhaW5lciA9IG1vZGFsQ29udGFpbmVyLmNyZWF0ZUVsKFwiZGl2XCIsIHsgY2xzOiBcImNpbmV2YXVsdC1tb2RhbC1wbG90LWNvbnRhaW5lclwiIH0pO1xuXG4gICAgICBjb25zdCBwbG90RWwgPSBwbG90Q29udGFpbmVyLmNyZWF0ZUVsKFwicFwiLCB7XG4gICAgICAgIHRleHQ6IHRoaXMubW92aWUucGxvdCxcbiAgICAgICAgY2xzOiBcImNpbmV2YXVsdC1tb2RhbC1wbG90XCJcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBzaG93TW9yZUJ1dHRvbiA9IHBsb3RDb250YWluZXIuY3JlYXRlRWwoXCJidXR0b25cIiwge1xuICAgICAgICB0ZXh0OiBcIlNob3cgbW9yZVwiLFxuICAgICAgICBjbHM6IFwiY2luZXZhdWx0LW1vZGFsLXNob3ctbW9yZSBjaW5ldmF1bHQtbW9kYWwtc2hvdy1tb3JlLWhpZGRlblwiXG4gICAgICB9KVxuXG4gICAgICBzaG93TW9yZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICBjb25zdCBpc0V4cGFuZGVkID0gcGxvdEVsLmNsYXNzTGlzdC50b2dnbGUoXCJleHBhbmRlZC1wbG90XCIpO1xuICAgICAgICBzaG93TW9yZUJ1dHRvbi5zZXRUZXh0KGlzRXhwYW5kZWQgPyBcIlNob3cgbGVzc1wiIDogXCJTaG93IG1vcmVcIik7XG4gICAgICB9KTtcblxuICAgICAgLy8gV2FpdCBmb3IgbGF5b3V0IHNvIHdlIGNhbiBtZWFzdXJlIG92ZXJmbG93XG4gICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4ge1xuICAgICAgICAvLyBJZiBjb250ZW50IGhlaWdodCBleGNlZWRzIGNvbnRhaW5lciBoZWlnaHQsIGl0J3MgdHJ1bmNhdGVkXG4gICAgICAgIGlmIChwbG90RWwuc2Nyb2xsSGVpZ2h0ID4gcGxvdEVsLmNsaWVudEhlaWdodCArIDEpIHtcbiAgICAgICAgICBzaG93TW9yZUJ1dHRvbi5yZW1vdmVDbGFzcyhcImNpbmV2YXVsdC1tb2RhbC1zaG93LW1vcmUtaGlkZGVuXCIpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBHZW5lcmF0ZSBkZXRhaWxzIHNlY3Rpb24gb25seSBpZiBhdCBsZWFzdCBvbmUgZGV0YWlsIGlzIGF2YWlsYWJsZVxuICAgIGZ1bmN0aW9uIHJlZGVyRGV0YWlsU2VjdGlvbih0eXBlOiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgIGNvbnN0IGRldGFpbEVsZW1lbnQgPSBtb2RhbENvbnRhaW5lci5jcmVhdGVFbChcImRpdlwiLCB7IGNsczogXCJjaW5ldmF1bHQtbW9kYWwtZGV0YWlsLWNvbnRhaW5lclwiIH0pO1xuICAgICAgZGV0YWlsRWxlbWVudC5jcmVhdGVFbChcInBcIiwge1xuICAgICAgICB0ZXh0OiBgJHt0eXBlfTpgLFxuICAgICAgICBjbHM6IFwiY2luZXZhdWx0LW1vZGFsLWRldGFpbC1sYWJlbFwiXG4gICAgICB9KTtcbiAgICAgIGRldGFpbEVsZW1lbnQuY3JlYXRlRWwoXCJwXCIsIHtcbiAgICAgICAgdGV4dDogdmFsdWUsXG4gICAgICAgIGNsczogXCJjaW5ldmF1bHQtbW9kYWwtZGV0YWlsLXZhbHVlXCJcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIG1vZGFsQ29udGFpbmVyLmNyZWF0ZUVsKFwiaHJcIik7XG5cbiAgICAvLyBHZW5yZVxuICAgIGlmICh0aGlzLm1vdmllLmdlbnJlKSB7XG4gICAgICByZWRlckRldGFpbFNlY3Rpb24oXCJHZW5yZVwiLCB0aGlzLm1vdmllLmdlbnJlKTtcbiAgICB9XG5cbiAgICAvLyBEaXJlY3RvclxuICAgIGlmICh0aGlzLm1vdmllLmRpcmVjdG9yKSB7XG4gICAgICByZWRlckRldGFpbFNlY3Rpb24oXCJEaXJlY3RvclwiLCB0aGlzLm1vdmllLmRpcmVjdG9yKTtcbiAgICB9XG5cbiAgICAvLyBBY3RvcnNcbiAgICBpZiAodGhpcy5tb3ZpZS5hY3RvcnMpIHtcbiAgICAgIHJlZGVyRGV0YWlsU2VjdGlvbihcIkFjdG9yc1wiLCB0aGlzLm1vdmllLmFjdG9ycyk7XG4gICAgfVxuXG4gICAgbW9kYWxDb250YWluZXIuY3JlYXRlRWwoXCJoclwiKTtcblxuICAgIC8vIFBlcnNvbmFsIFJhdGluZ1xuICAgIGNvbnN0IHJhdGluZ0NvbnRhaW5lciA9IG1vZGFsQ29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICBjbHM6IFwiY2luZXZhdWx0LW1vZGFsLXJhdGluZy1jb250YWluZXJcIlxuICAgIH0pO1xuXG4gICAgcmF0aW5nQ29udGFpbmVyLmNyZWF0ZUVsKFwiZGl2XCIsIHsgdGV4dDogXCJSYXRpbmdcIiwgY2xzOiBcImNpbmV2YXVsdC1tb2RhbC1yYXRpbmctbGFiZWxcIiB9KTtcbiAgICBjb25zdCBzdGFycyA9IGNyZWF0ZVN0YXJSYXRpbmcocmF0aW5nQ29udGFpbmVyLCB0aGlzLm1vdmllLnN0YXJSYXRpbmcsIGZhbHNlLCAocmF0aW5nKSA9PiB7XG4gICAgICB0aGlzLm9uUmF0ZShyYXRpbmcpO1xuICAgIH0pO1xuICAgIHN0YXJzLmNsYXNzTGlzdC5hZGQoXCJjaW5ldmF1bHQtbW9kYWwtc3RhcnNcIik7XG5cbiAgICAvLyBSYXRpbmdzIGZyb20gZXh0ZXJuYWwgc291cmNlc1xuICAgIGlmICh0aGlzLm1vdmllLnJhdGluZ3MpIHtcbiAgICAgIGNvbnN0IGV4dGVybmFsUmF0aW5nc0NvbnRhaW5lciA9IG1vZGFsQ29udGFpbmVyLmNyZWF0ZURpdih7XG4gICAgICAgIGNsczogXCJjaW5ldmF1bHQtbW9kYWwtZXh0ZXJuYWwtcmF0aW5nc1wiXG4gICAgICB9KTtcblxuICAgICAgZm9yIChjb25zdCByYXRpbmcgb2YgdGhpcy5tb3ZpZS5yYXRpbmdzKSB7XG4gICAgICAgIGNvbnN0IHJhdGluZ0VsID0gZXh0ZXJuYWxSYXRpbmdzQ29udGFpbmVyLmNyZWF0ZURpdih7IGNsczogXCJjaW5ldmF1bHQtbW9kYWwtZXh0ZXJuYWwtcmF0aW5nLWVsZW1lbnRcIiB9KTtcbiAgICAgICAgcmF0aW5nRWwuY3JlYXRlRWwoXCJkaXZcIiwgeyB0ZXh0OiByYXRpbmcuU291cmNlLCBjbHM6IFwiY2luZXZhdWx0LW1vZGFsLWV4dGVybmFsLXJhdGluZy1zb3VyY2VcIiB9KTtcbiAgICAgICAgcmF0aW5nRWwuY3JlYXRlRWwoXCJkaXZcIiwgeyB0ZXh0OiByYXRpbmcuVmFsdWUsIGNsczogXCJjaW5ldmF1bHQtbW9kYWwtZXh0ZXJuYWwtcmF0aW5nLXZhbHVlXCIgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgYWN0aW9ucyA9IG1vZGFsQ29udGFpbmVyLmNyZWF0ZURpdih7IGNsczogXCJjaW5ldmF1bHQtbW9kYWwtYWN0aW9uc1wiIH0pO1xuICAgIGNvbnN0IHRvZ2dsZVdhdGNoZWRMYWJlbCA9IHRoaXMubW92aWUud2F0Y2hlZCA/IFwiTWFyayBhcyB0byB3YXRjaFwiIDogXCJNYXJrIGFzIHdhdGNoZWRcIjtcbiAgICBjb25zdCB0b2dnbGVXYXRjaGVkQnV0dG9uID0gYWN0aW9ucy5jcmVhdGVFbChcImJ1dHRvblwiLCB7IHRleHQ6IHRvZ2dsZVdhdGNoZWRMYWJlbCB9KTtcbiAgICBjb25zdCByZW1vdmVCdXR0b24gPSBhY3Rpb25zLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHsgdGV4dDogXCJSZW1vdmVcIiwgY2xzOiBcImNpbmV2YXVsdC1kYW5nZXJcIiB9KTtcblxuICAgIHRvZ2dsZVdhdGNoZWRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMub25Ub2dnbGVXYXRjaGVkKCk7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfSk7XG5cbiAgICByZW1vdmVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMub25SZW1vdmUoKTtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9KTtcbiAgfVxufSIsICJleHBvcnQgZnVuY3Rpb24gY3JlYXRlU3RhclJhdGluZyhcbiAgY29udGFpbmVyOiBIVE1MRWxlbWVudCxcbiAgcmF0aW5nOiBudW1iZXIsXG4gIHJlYWRPbmx5OiBib29sZWFuLFxuICBvbkNoYW5nZT86IChyYXRpbmc6IG51bWJlcikgPT4gdm9pZFxuKSB7XG4gIGNvbnN0IHN0YXJzID0gY29udGFpbmVyLmNyZWF0ZURpdih7IGNsczogXCJjaW5ldmF1bHQtc3RhcnNcIiB9KTtcbiAgY29uc3Qgc3RhckVsZW1lbnRzOiBIVE1MU3BhbkVsZW1lbnRbXSA9IFtdO1xuICBsZXQgY3VycmVudFJhdGluZyA9IHJhdGluZztcblxuICBmb3IgKGxldCBpID0gMTsgaSA8PSA1OyBpICs9IDEpIHtcbiAgICBjb25zdCBzdGFyID0gc3RhcnMuY3JlYXRlRWwoXCJzcGFuXCIsIHsgdGV4dDogXCJcdTI2MDVcIiwgY2xzOiBcImNpbmV2YXVsdC1zdGFyXCIgfSk7XG4gICAgaWYgKGkgPD0gcmF0aW5nKSBzdGFyLmNsYXNzTGlzdC5hZGQoXCJhY3RpdmVcIik7XG4gICAgc3RhckVsZW1lbnRzLnB1c2goc3Rhcik7XG4gICAgaWYgKCFyZWFkT25seSkge1xuICAgICAgc3Rhci5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICAvLyBJZiBjbGlja2luZyB0aGUgc2FtZSBzdGFyIHRoYXQncyBhbHJlYWR5IHNlbGVjdGVkLCByZXNldCB0byAwXG4gICAgICAgIGlmIChjdXJyZW50UmF0aW5nID09PSBpKSB7XG4gICAgICAgICAgY3VycmVudFJhdGluZyA9IDA7XG4gICAgICAgICAgc3RhckVsZW1lbnRzLmZvckVhY2goKGVsZW1lbnQpID0+IHtcbiAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcImFjdGl2ZVwiKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjdXJyZW50UmF0aW5nID0gaTtcbiAgICAgICAgICBzdGFyRWxlbWVudHMuZm9yRWFjaCgoZWxlbWVudCwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnRvZ2dsZShcImFjdGl2ZVwiLCBpbmRleCA8IGkpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIG9uQ2hhbmdlPy4oY3VycmVudFJhdGluZyk7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3Rhci5jbGFzc0xpc3QuYWRkKFwicmVhZG9ubHlcIik7XG4gICAgfVxuICB9XG4gIHJldHVybiBzdGFycztcbn1cbiIsICJleHBvcnQgZnVuY3Rpb24gbG9nZ2VyKG1lc3NhZ2U6IHN0cmluZywgY29sb3I6IHN0cmluZyA9ICd3aGl0ZScpIHtcbiAgY29uc29sZS5sb2coYCVjICR7bWVzc2FnZX1gLCBgYmFja2dyb3VuZDogJHtjb2xvcn07IGNvbG9yOiBibGFjazsgcGFkZGluZzogNnB4IDhweGApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbnVsbFNhZmU8VD4oZnVuYzogKCkgPT4gVCwgZmFsbGJhY2tWYWx1ZTogVCB8IG51bGwgPSBudWxsKTogVCB8IG51bGwge1xuICB0cnkge1xuICAgIGNvbnN0IHZhbHVlID0gZnVuYygpO1xuICAgIHJldHVybiB2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkID8gZmFsbGJhY2tWYWx1ZSA6IHZhbHVlO1xuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3I6ICcsIGUpO1xuICAgIHJldHVybiBmYWxsYmFja1ZhbHVlO1xuICB9XG59IiwgImltcG9ydCB7IEFwcCwgU3VnZ2VzdE1vZGFsLCBURmlsZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuXG5leHBvcnQgY2xhc3MgSnNvbkZpbGVTdWdnZXN0TW9kYWwgZXh0ZW5kcyBTdWdnZXN0TW9kYWw8VEZpbGU+IHtcbiAgcHJpdmF0ZSBqc29uRmlsZXM6IFRGaWxlW107XG4gIHByaXZhdGUgb25TZWxlY3Q6IChmaWxlOiBURmlsZSkgPT4gdm9pZDtcblxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgb25TZWxlY3Q6IChmaWxlOiBURmlsZSkgPT4gdm9pZCkge1xuICAgIHN1cGVyKGFwcCk7XG4gICAgdGhpcy5vblNlbGVjdCA9IG9uU2VsZWN0O1xuICAgIHRoaXMuanNvbkZpbGVzID0gdGhpcy5hcHAudmF1bHQuZ2V0RmlsZXMoKS5maWx0ZXIoKGYpID0+IGYuZXh0ZW5zaW9uID09PSBcImpzb25cIik7XG4gICAgdGhpcy5zZXRQbGFjZWhvbGRlcihcIlNlbGVjdCBhIEpTT04gZmlsZSBmcm9tIHlvdXIgdmF1bHQuLi5cIik7XG4gIH1cblxuICBnZXRTdWdnZXN0aW9ucyhxdWVyeTogc3RyaW5nKTogVEZpbGVbXSB7XG4gICAgY29uc3QgbG93ZXJRdWVyeSA9IHF1ZXJ5LnRvTG93ZXJDYXNlKCk7XG4gICAgcmV0dXJuIHRoaXMuanNvbkZpbGVzLmZpbHRlcigoZmlsZSkgPT5cbiAgICAgIGZpbGUucGF0aC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGxvd2VyUXVlcnkpXG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlclN1Z2dlc3Rpb24oZmlsZTogVEZpbGUsIGVsOiBIVE1MRWxlbWVudCkge1xuICAgIGVsLmNyZWF0ZUVsKFwiZGl2XCIsIHsgdGV4dDogZmlsZS5wYXRoIH0pO1xuICB9XG5cbiAgb25DaG9vc2VTdWdnZXN0aW9uKGZpbGU6IFRGaWxlLCBldnQ6IE1vdXNlRXZlbnQgfCBLZXlib2FyZEV2ZW50KSB7XG4gICAgdGhpcy5vblNlbGVjdChmaWxlKTtcbiAgfVxufVxuIiwgImltcG9ydCB7IEFwcCwgVEZpbGUgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB0eXBlIHsgQ2luZVZhdWx0RGF0YSwgQ2luZVZhdWx0TW92aWUgfSBmcm9tIFwiLi4vdHlwZXMvY2luZXZhdWx0XCI7XG5cbmNvbnN0IEZPTERFUiA9IFwiY2luZXZhdWx0LWpzb25cIjtcbmNvbnN0IERFRkFVTFRfTkFNRSA9IFwiY2luZXZhdWx0Lmpzb25cIjtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldERlZmF1bHRQYXRoKCkge1xuICByZXR1cm4gYCR7Rk9MREVSfS8ke0RFRkFVTFRfTkFNRX1gO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0Rm9sZGVyKCkge1xuICByZXR1cm4gRk9MREVSO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRW1wdHlNb3ZpZSgpOiBDaW5lVmF1bHRNb3ZpZSB7XG4gIHJldHVybiB7XG4gICAgaWQ6IGNyeXB0by5yYW5kb21VVUlEKCksXG4gICAgaW1kYklkOiBcIlwiLFxuICAgIHRpdGxlOiBcIlwiLFxuICAgIHllYXI6IFwiXCIsXG4gICAgcmF0ZWQ6IFwiXCIsXG4gICAgcmVsZWFzZWQ6IFwiXCIsXG4gICAgcnVudGltZTogXCJcIixcbiAgICBnZW5yZTogXCJcIixcbiAgICBkaXJlY3RvcjogXCJcIixcbiAgICB3cml0ZXI6IFwiXCIsXG4gICAgYWN0b3JzOiBcIlwiLFxuICAgIHBsb3Q6IFwiXCIsXG4gICAgbGFuZ3VhZ2U6IFwiXCIsXG4gICAgY291bnRyeTogXCJcIixcbiAgICBhd2FyZHM6IFwiXCIsXG4gICAgcG9zdGVyOiBcIlwiLFxuICAgIHBvc3RlckxvY2FsOiBcIlwiLFxuICAgIHJhdGluZ3M6IFtdLFxuICAgIG1ldGFzY29yZTogXCJcIixcbiAgICBpbWRiUmF0aW5nOiBcIlwiLFxuICAgIGltZGJWb3RlczogXCJcIixcbiAgICB0eXBlOiBcIlwiLFxuICAgIGR2ZDogXCJcIixcbiAgICBib3hPZmZpY2U6IFwiXCIsXG4gICAgcHJvZHVjdGlvbjogXCJcIixcbiAgICB3ZWJzaXRlOiBcIlwiLFxuICAgIHRvdGFsU2Vhc29uczogXCJcIixcbiAgICB0b21hdG9VUkw6IFwiXCIsXG4gICAgdG9tYXRvTWV0ZXI6IFwiXCIsXG4gICAgdG9tYXRvSW1hZ2U6IFwiXCIsXG4gICAgdG9tYXRvUmF0aW5nOiBcIlwiLFxuICAgIHRvbWF0b1Jldmlld3M6IFwiXCIsXG4gICAgdG9tYXRvRnJlc2g6IFwiXCIsXG4gICAgdG9tYXRvUm90dGVuOiBcIlwiLFxuICAgIHRvbWF0b0NvbnNlbnN1czogXCJcIixcbiAgICB0b21hdG9Vc2VyTWV0ZXI6IFwiXCIsXG4gICAgdG9tYXRvVXNlclJhdGluZzogXCJcIixcbiAgICB0b21hdG9Vc2VyUmV2aWV3czogXCJcIixcbiAgICBzdGFyUmF0aW5nOiAwLFxuICAgIHdhdGNoZWQ6IGZhbHNlLFxuICAgIG5vdGVzOiBcIlwiXG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEZWZhdWx0RGF0YSgpOiBDaW5lVmF1bHREYXRhIHtcbiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICByZXR1cm4ge1xuICAgIHNjaGVtYVZlcnNpb246IDEsXG4gICAgY3JlYXRlZEF0OiBub3csXG4gICAgdXBkYXRlZEF0OiBub3csXG4gICAgbGlicmFyeU5hbWU6IFwiQ2luZVZhdWx0XCIsXG4gICAgb3duZXI6IFwiXCIsXG4gICAgc291cmNlOiBcIkNpbmVWYXVsdFwiLFxuICAgIG1vdmllczogW11cbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZURhdGEoZGF0YTogQ2luZVZhdWx0RGF0YSk6IENpbmVWYXVsdERhdGEge1xuICByZXR1cm4ge1xuICAgIC4uLmRhdGEsXG4gICAgbW92aWVzOiBkYXRhLm1vdmllcy5tYXAoKG1vdmllKSA9PiAoe1xuICAgICAgLi4uY3JlYXRlRW1wdHlNb3ZpZSgpLFxuICAgICAgLi4ubW92aWUsXG4gICAgICB5ZWFyOiBtb3ZpZS55ZWFyID8gU3RyaW5nKG1vdmllLnllYXIpIDogXCJcIixcbiAgICAgIHN0YXJSYXRpbmc6IHR5cGVvZiBtb3ZpZS5zdGFyUmF0aW5nID09PSBcIm51bWJlclwiID8gbW92aWUuc3RhclJhdGluZyA6IDBcbiAgICB9KSlcbiAgfTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGVuc3VyZUZvbGRlcihhcHA6IEFwcCkge1xuICBpZiAoIWFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoRk9MREVSKSkge1xuICAgIGF3YWl0IGFwcC52YXVsdC5jcmVhdGVGb2xkZXIoRk9MREVSKTtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlSnNvbkZpbGUoYXBwOiBBcHApOiBQcm9taXNlPFRGaWxlPiB7XG4gIGF3YWl0IGVuc3VyZUZvbGRlcihhcHApO1xuICBjb25zdCBleGlzdGluZyA9IGFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZ2V0RGVmYXVsdFBhdGgoKSk7XG4gIGNvbnN0IGZpbGVuYW1lID0gZXhpc3RpbmcgPyBgY2luZXZhdWx0LSR7RGF0ZS5ub3coKX0uanNvbmAgOiBERUZBVUxUX05BTUU7XG4gIGNvbnN0IHBhdGggPSBgJHtGT0xERVJ9LyR7ZmlsZW5hbWV9YDtcblxuICByZXR1cm4gYXBwLnZhdWx0LmNyZWF0ZShwYXRoLCBKU09OLnN0cmluZ2lmeShjcmVhdGVEZWZhdWx0RGF0YSgpLCBudWxsLCAyKSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2FkTG9jYWxGaWxlKGFwcDogQXBwLCBmaWxlOiBURmlsZSk6IFByb21pc2U8Q2luZVZhdWx0RGF0YT4ge1xuICBjb25zdCByYXcgPSBhd2FpdCBhcHAudmF1bHQucmVhZChmaWxlKTtcbiAgY29uc3QgcGFyc2VkID0gSlNPTi5wYXJzZShyYXcpIGFzIENpbmVWYXVsdERhdGE7XG4gIGlmICghcGFyc2VkIHx8ICFBcnJheS5pc0FycmF5KHBhcnNlZC5tb3ZpZXMpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRm9ybWF0byBKU09OIG5vbiB2YWxpZG9cIik7XG4gIH1cbiAgcmV0dXJuIG5vcm1hbGl6ZURhdGEocGFyc2VkKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNhdmVMb2NhbERhdGEoYXBwOiBBcHAsIGZpbGU6IFRGaWxlLCBkYXRhOiBDaW5lVmF1bHREYXRhKSB7XG4gIGF3YWl0IGFwcC52YXVsdC5tb2RpZnkoZmlsZSwgSlNPTi5zdHJpbmdpZnkoZGF0YSwgbnVsbCwgMikpO1xufVxuIiwgImltcG9ydCB7IHJlcXVlc3RVcmwgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB0eXBlIHsgQ2luZVZhdWx0U2VhcmNoSXRlbSwgT21kYkRldGFpbGVkUmVzcG9uc2UgfSBmcm9tIFwiLi4vdHlwZXMvY2luZXZhdWx0XCI7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZWFyY2hPbWRiKHF1ZXJ5OiBzdHJpbmcsIGFwaUtleTogc3RyaW5nKTogUHJvbWlzZTxDaW5lVmF1bHRTZWFyY2hJdGVtW10+IHtcbiAgaWYgKCFhcGlLZXkpIHtcbiAgICByZXR1cm4gW107XG4gIH1cblxuICB0cnkge1xuICAgIGNvbnN0IHVybCA9IGBodHRwczovL3d3dy5vbWRiYXBpLmNvbS8/YXBpa2V5PSR7YXBpS2V5fSZzPSR7ZW5jb2RlVVJJQ29tcG9uZW50KHF1ZXJ5KX1gO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdFVybCh1cmwpO1xuICAgIGNvbnN0IGRhdGEgPSByZXNwb25zZS5qc29uIGFzIHtcbiAgICAgIFNlYXJjaD86IEFycmF5PHsgVGl0bGU6IHN0cmluZzsgWWVhcjogc3RyaW5nOyBpbWRiSUQ6IHN0cmluZzsgVHlwZTogc3RyaW5nOyBQb3N0ZXI6IHN0cmluZyB9PjtcbiAgICB9O1xuXG4gICAgaWYgKGRhdGE/LlNlYXJjaCkge1xuICAgICAgcmV0dXJuIGRhdGEuU2VhcmNoLm1hcCgoaXRlbSkgPT4gKHtcbiAgICAgICAgaW1kYklkOiBpdGVtLmltZGJJRCxcbiAgICAgICAgdGl0bGU6IGl0ZW0uVGl0bGUsXG4gICAgICAgIHllYXI6IGl0ZW0uWWVhcixcbiAgICAgICAgdHlwZTogaXRlbS5UeXBlLFxuICAgICAgICBwb3N0ZXI6IGl0ZW0uUG9zdGVyICYmIGl0ZW0uUG9zdGVyICE9PSBcIk4vQVwiID8gaXRlbS5Qb3N0ZXIgOiBcIlwiLFxuICAgICAgICBwbG90OiBcIlwiXG4gICAgICB9KSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIFtdO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzZWFyY2hpbmcgT01EYjpcIiwgZXJyb3IpO1xuICAgIHJldHVybiBbXTtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0T21kYkRldGFpbHMoaW1kYklkOiBzdHJpbmcsIGFwaUtleTogc3RyaW5nLCBkZXB0aDogbnVtYmVyID0gMCk6IFByb21pc2U8T21kYkRldGFpbGVkUmVzcG9uc2UgfCBudWxsPiB7XG4gIC8vIFJldHJ5IGxpbWl0XG4gIGlmIChkZXB0aCA+PSAzKSB7XG4gICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGZldGNoIG1vdmllIGRldGFpbHMgYWZ0ZXIgJHtkZXB0aH0gYXR0ZW1wdHNgKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGlmICghYXBpS2V5KSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICB0cnkge1xuICAgIGNvbnN0IHVybCA9IGBodHRwczovL3d3dy5vbWRiYXBpLmNvbS8/YXBpa2V5PSR7YXBpS2V5fSZpPSR7aW1kYklkfSZwbG90PWZ1bGwmdG9tYXRvZXM9dHJ1ZWA7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0VXJsKHVybCk7XG5cbiAgICBjb25zdCBkYXRhID0gcmVzcG9uc2UuanNvbiBhcyBPbWRiRGV0YWlsZWRSZXNwb25zZSAmIHsgUmVzcG9uc2U6IHN0cmluZyB9O1xuXG4gICAgaWYgKGRhdGEuUmVzcG9uc2UgIT09IFwiVHJ1ZVwiKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiT01EYiBBUEkgcmV0dXJuZWQgZXJyb3IgcmVzcG9uc2VcIiwgZGF0YSk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICByZXR1cm4gZGF0YTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgbW92aWUgZGV0YWlscywgcmV0cnlpbmcuLi5cIiwgZXJyb3IpO1xuICAgIHJldHVybiBnZXRPbWRiRGV0YWlscyhpbWRiSWQsIGFwaUtleSwgZGVwdGggKyAxKTtcbiAgfVxufVxuIiwgImltcG9ydCB7IEFwcCwgUGx1Z2luU2V0dGluZ1RhYiwgU2V0dGluZywgTm90aWNlLCBURmlsZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IENpbmVWYXVsdFZpZXcgZnJvbSBcIi4uL3ZpZXdzL0NpbmVWYXVsdFZpZXdcIjtcbmltcG9ydCB7IFZJRVdfVFlQRSB9IGZyb20gXCIuLi9jb25zdGFudHNcIjtcbmltcG9ydCBDaW5lVmF1bHRQbHVnaW4gZnJvbSBcIi4uL21haW5cIjtcbmltcG9ydCB7IGNyZWF0ZURlZmF1bHREYXRhLCBjcmVhdGVKc29uRmlsZSwgZ2V0RGVmYXVsdFBhdGgsIGdldEZvbGRlciwgc2F2ZUxvY2FsRGF0YSB9IGZyb20gXCIuLi9zZXJ2aWNlcy9saWJyYXJ5U3RvcmFnZVwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDaW5lVmF1bHRTZXR0aW5nVGFiIGV4dGVuZHMgUGx1Z2luU2V0dGluZ1RhYiB7XG4gIHBsdWdpbjogQ2luZVZhdWx0UGx1Z2luO1xuXG4gIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IENpbmVWYXVsdFBsdWdpbikge1xuICAgIHN1cGVyKGFwcCwgcGx1Z2luKTtcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgfVxuXG4gIGRpc3BsYXkoKTogdm9pZCB7XG4gICAgY29uc3QgeyBjb250YWluZXJFbCB9ID0gdGhpcztcblxuICAgIGNvbnRhaW5lckVsLmVtcHR5KCk7XG5cbiAgICAvLyBDb25maWd1cmF0aW9uXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpLnNldE5hbWUoXCJDb25maWd1cmF0aW9uXCIpLnNldEhlYWRpbmcoKTtcbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiT01EYiBBUEkga2V5XCIpXG4gICAgICAuc2V0RGVzYyhcIkVudGVyIHlvdXIgT01EYiBBUEkga2V5LiBZb3UgY2FuIGdldCBvbmUgZm9yIGZyZWUgYXQgb21kYmFwaS5jb21cIilcbiAgICAgIC5hZGRUZXh0KHRleHQgPT4gdGV4dFxuICAgICAgICAuc2V0UGxhY2Vob2xkZXIoXCJFbnRlciB5b3VyIEFQSSBrZXlcIilcbiAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLm9tZGJBcGlLZXkpXG4gICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zZXRPbWRiQXBpS2V5KHZhbHVlKTtcbiAgICAgICAgfSkpO1xuXG4gICAgLy8gRXh0ZXJuYWwgbGlicmFyeSBzdXBwb3J0IHJlbW92ZWQuXG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiTGlua2VkIGxvY2FsIGxpYnJhcnlcIilcbiAgICAgIC5zZXREZXNjKFxuICAgICAgICB0aGlzLnBsdWdpbi5sb2NhbEpzb25QYXRoXG4gICAgICAgICAgPyBgTG9jYWwgZmlsZTogJHt0aGlzLnBsdWdpbi5sb2NhbEpzb25QYXRofWBcbiAgICAgICAgICA6IFwiTm8gbG9jYWwgbGlicmFyeSBsaW5rZWRcIlxuICAgICAgKVxuICAgICAgLmFkZERyb3Bkb3duKGRyb3AgPT4ge1xuICAgICAgICBjb25zdCBmaWxlcyA9IHRoaXMuYXBwLnZhdWx0LmdldEZpbGVzKCkuZmlsdGVyKChmKSA9PiBmLmV4dGVuc2lvbiA9PT0gXCJqc29uXCIpO1xuICAgICAgICBjb25zdCBvcHRpb25zOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0geyBcIlwiOiBcIi0tIE5vbmUgLS1cIiB9O1xuICAgICAgICBmaWxlcy5mb3JFYWNoKChmKSA9PiAob3B0aW9uc1tmLnBhdGhdID0gZi5wYXRoKSk7XG4gICAgICAgIGRyb3AuYWRkT3B0aW9ucyhvcHRpb25zKS5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5sb2NhbEpzb25QYXRoID8/IFwiXCIpLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgIGNvbnN0IHBhdGggPSB2YWx1ZSB8fCBudWxsO1xuICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNldExvY2FsSnNvblBhdGgocGF0aCk7XG4gICAgICAgICAgYXdhaXQgdGhpcy5yZWZyZXNoT3BlblZpZXdzKCk7XG4gICAgICAgICAgdGhpcy5kaXNwbGF5KCk7XG4gICAgICAgIH0pO1xuICAgICAgfSlcbiAgICAgIC5hZGRCdXR0b24oYnV0dG9uID0+IGJ1dHRvblxuICAgICAgICAuc2V0QnV0dG9uVGV4dChcIlVubGluayBsb2NhbFwiKVxuICAgICAgICAuc2V0RGlzYWJsZWQoIXRoaXMucGx1Z2luLmxvY2FsSnNvblBhdGgpXG4gICAgICAgIC5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zZXRMb2NhbEpzb25QYXRoKG51bGwpO1xuICAgICAgICAgIGF3YWl0IHRoaXMucmVmcmVzaE9wZW5WaWV3cygpO1xuICAgICAgICAgIHRoaXMuZGlzcGxheSgpO1xuICAgICAgICB9KSk7XG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiQ3JlYXRlIG5ldyBsaWJyYXJ5XCIpXG4gICAgICAuc2V0RGVzYyhcIkNyZWF0ZSBhIG5ldyBlbXB0eSBsb2NhbCBsaWJyYXJ5IGZyb20gc2NyYXRjaC4gVGhpcyB3aWxsIHVubGluayBhbnkgZXh0ZXJuYWwgbGlicmFyeS5cIilcbiAgICAgIC5hZGRCdXR0b24oYnV0dG9uID0+IGJ1dHRvblxuICAgICAgICAuc2V0QnV0dG9uVGV4dChcIkNyZWF0ZSBsaWJyYXJ5XCIpXG4gICAgICAgIC5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICBhd2FpdCB0aGlzLmNyZWF0ZU5ld0xpYnJhcnkoKTtcbiAgICAgICAgfSkpO1xuXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIkV4cG9ydCBsaWJyYXJ5XCIpXG4gICAgICAuc2V0RGVzYyhcIlNhdmUgYSBjb3B5IG9mIHlvdXIgbGlicmFyeSBKU09OIHRvIGEgZmlsZS5cIilcbiAgICAgIC5hZGRCdXR0b24oYnV0dG9uID0+IGJ1dHRvblxuICAgICAgICAuc2V0QnV0dG9uVGV4dChcIkV4cG9ydCBKU09OXCIpXG4gICAgICAgIC5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICBhd2FpdCB0aGlzLmV4cG9ydExpYnJhcnlKc29uKCk7XG4gICAgICAgIH0pKTtcblxuICAgIC8vIEJ1Z2ZpeFxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKS5zZXROYW1lKFwiQnVnZml4XCIpLnNldEhlYWRpbmcoKTtcbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiUmVwb3J0IGlzc3Vlc1wiKVxuICAgICAgLnNldERlc2MoXCJJZiB5b3UgZW5jb3VudGVyIGFueSBpc3N1ZXMgd2l0aCB0aGUgcGx1Z2luLCBwbGVhc2UgcmVwb3J0IHRoZW0uIFlvdXIgZmVlZGJhY2sgaXMgaW52YWx1YWJsZSBmb3IgaW1wcm92aW5nIENpbmVWYXVsdCFcIilcbiAgICAgIC5hZGRCdXR0b24oYnV0dG9uID0+IGJ1dHRvblxuICAgICAgICAuc2V0QnV0dG9uVGV4dChcIkdpdEh1YlwiKVxuICAgICAgICAub25DbGljaygoKSA9PiB7XG4gICAgICAgICAgd2luZG93Lm9wZW4oXCJodHRwczovL2dpdGh1Yi5jb20vdnNjYXBlcnJvdHRhL29ic2lkaWFuLWNpbmV2YXVsdC9pc3N1ZXNcIiwgXCJfYmxhbmtcIik7XG4gICAgICAgIH0pKTtcblxuICAgIC8vIFN1cHBvcnQgYW5kIGRvbmF0aW9uXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpLnNldE5hbWUoXCJTdXBwb3J0XCIpLnNldEhlYWRpbmcoKTtcbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiRG9uYXRlXCIpXG4gICAgICAuc2V0RGVzYyhcbiAgICAgICAgXCJJZiB5b3UgbGlrZSB0aGlzIHBsdWdpbiwgY29uc2lkZXIgZG9uYXRpbmcgdG8gc3VwcG9ydCBjb250aW51ZWQgZGV2ZWxvcG1lbnQuXCJcbiAgICAgIClcbiAgICAgIC5hZGRCdXR0b24oKGJ0KSA9PiB7XG4gICAgICAgIGJ0LmJ1dHRvbkVsLm91dGVySFRNTCA9XG4gICAgICAgICAgXCI8YSBocmVmPSdodHRwczovL2tvLWZpLmNvbS9UNlQwMVRYODA3JyB0YXJnZXQ9J19ibGFuayc+PGltZyBoZWlnaHQ9JzM2JyBzdHlsZT0nYm9yZGVyOjBweDtoZWlnaHQ6MzZweDsnIHNyYz0naHR0cHM6Ly9zdG9yYWdlLmtvLWZpLmNvbS9jZG4va29maTYucG5nP3Y9NicgYm9yZGVyPScwJyBhbHQ9J0J1eSBNZSBhIENvZmZlZSBhdCBrby1maS5jb20nIC8+PC9hPlwiO1xuICAgICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGV4cG9ydExpYnJhcnlKc29uKCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5nZXRMaWJyYXJ5SnNvbkNvbnRlbnQoKTtcbiAgICAgIGlmICghY29udGVudCkge1xuICAgICAgICBuZXcgTm90aWNlKFwiTm8gbGlicmFyeSBmaWxlIGZvdW5kIHRvIGV4cG9ydC5cIik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gQ3JlYXRlIGV4cG9ydCBmaWxlIGluc2lkZSB2YXVsdCBmb3IgbW9iaWxlIGNvbXBhdGliaWxpdHlcbiAgICAgIGNvbnN0IHRpbWVzdGFtcCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5yZXBsYWNlKC9bOi5dL2csIFwiLVwiKS5zbGljZSgwLCAxOSk7XG4gICAgICBjb25zdCBleHBvcnRQYXRoID0gYGNpbmV2YXVsdC1leHBvcnQtJHt0aW1lc3RhbXB9Lmpzb25gO1xuXG4gICAgICAvLyBDaGVjayBpZiBmaWxlIGV4aXN0cywgaWYgc28gYWRkIGEgY291bnRlclxuICAgICAgbGV0IGZpbmFsUGF0aCA9IGV4cG9ydFBhdGg7XG4gICAgICBsZXQgY291bnRlciA9IDE7XG4gICAgICB3aGlsZSAodGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZpbmFsUGF0aCkpIHtcbiAgICAgICAgZmluYWxQYXRoID0gYGNpbmV2YXVsdC1leHBvcnQtJHt0aW1lc3RhbXB9LSR7Y291bnRlcn0uanNvbmA7XG4gICAgICAgIGNvdW50ZXIrKztcbiAgICAgIH1cblxuICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlKGZpbmFsUGF0aCwgY29udGVudCk7XG4gICAgICBuZXcgTm90aWNlKGBMaWJyYXJ5IGV4cG9ydGVkIHRvICR7ZmluYWxQYXRofWApO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiW0NpbmVWYXVsdF0gRXhwb3J0IGxpYnJhcnkgZXJyb3JcIiwgZXJyb3IpO1xuICAgICAgbmV3IE5vdGljZShcIlVuYWJsZSB0byBleHBvcnQgdGhlIGxpYnJhcnkuXCIpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgY3JlYXRlTmV3TGlicmFyeSgpIHtcbiAgICBjb25zdCBjb25maXJtZWQgPSB3aW5kb3cuY29uZmlybShcbiAgICAgIFwiQ3JlYXRlIGEgbmV3IGVtcHR5IENpbmVWYXVsdCBsaWJyYXJ5PyBUaGlzIHdpbGwgdW5saW5rIGFueSBleHRlcm5hbCBsaWJyYXJ5IGFuZCByZXNldCB5b3VyIGxvY2FsIGxpYnJhcnkgZGF0YS5cIlxuICAgICk7XG4gICAgaWYgKCFjb25maXJtZWQpIHJldHVybjtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBkZWZhdWx0RmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChnZXREZWZhdWx0UGF0aCgpKTtcbiAgICAgIGxldCBjcmVhdGVkRmlsZTogVEZpbGUgfCB1bmRlZmluZWQ7XG4gICAgICBpZiAoZGVmYXVsdEZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICBhd2FpdCBzYXZlTG9jYWxEYXRhKHRoaXMuYXBwLCBkZWZhdWx0RmlsZSwgY3JlYXRlRGVmYXVsdERhdGEoKSk7XG4gICAgICAgIGNyZWF0ZWRGaWxlID0gZGVmYXVsdEZpbGU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjcmVhdGVkRmlsZSA9IGF3YWl0IGNyZWF0ZUpzb25GaWxlKHRoaXMuYXBwKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGNyZWF0ZWRGaWxlKSB7XG4gICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNldExvY2FsSnNvblBhdGgoY3JlYXRlZEZpbGUucGF0aCk7XG4gICAgICB9XG4gICAgICBhd2FpdCB0aGlzLnJlZnJlc2hPcGVuVmlld3MoKTtcbiAgICAgIHRoaXMuZGlzcGxheSgpO1xuICAgICAgbmV3IE5vdGljZShcIk5ldyBsaWJyYXJ5IGNyZWF0ZWQuXCIpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiW0NpbmVWYXVsdF0gQ3JlYXRlIG5ldyBsaWJyYXJ5IGVycm9yXCIsIGVycm9yKTtcbiAgICAgIG5ldyBOb3RpY2UoXCJVbmFibGUgdG8gY3JlYXRlIGEgbmV3IGxpYnJhcnkuXCIpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2V0TGlicmFyeUpzb25Db250ZW50KCk6IFByb21pc2U8c3RyaW5nIHwgbnVsbD4ge1xuICAgIC8vIFByZWZlciBhIGxvY2FsIGxpbmtlZCBmaWxlIGluc2lkZSB0aGUgdmF1bHRcbiAgICBpZiAodGhpcy5wbHVnaW4ubG9jYWxKc29uUGF0aCkge1xuICAgICAgY29uc3QgbG9jYWxQYXRoID0gdGhpcy5wbHVnaW4ubG9jYWxKc29uUGF0aDtcbiAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgobG9jYWxQYXRoKTtcbiAgICAgIGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYXBwLnZhdWx0LnJlYWQoZmlsZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgZGVmYXVsdEZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZ2V0RGVmYXVsdFBhdGgoKSk7XG4gICAgaWYgKGRlZmF1bHRGaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgIHJldHVybiB0aGlzLmFwcC52YXVsdC5yZWFkKGRlZmF1bHRGaWxlKTtcbiAgICB9XG5cbiAgICBjb25zdCBmb2xkZXIgPSBnZXRGb2xkZXIoKTtcbiAgICBjb25zdCBmYWxsYmFjayA9IHRoaXMuYXBwLnZhdWx0XG4gICAgICAuZ2V0RmlsZXMoKVxuICAgICAgLmZpbmQoKGZpbGUpID0+IGZpbGUuZXh0ZW5zaW9uID09PSBcImpzb25cIiAmJiBmaWxlLnBhdGguc3RhcnRzV2l0aChgJHtmb2xkZXJ9L2ApKTtcblxuICAgIGlmIChmYWxsYmFjaykge1xuICAgICAgcmV0dXJuIHRoaXMuYXBwLnZhdWx0LnJlYWQoZmFsbGJhY2spO1xuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyByZWZyZXNoT3BlblZpZXdzKCkge1xuICAgIGNvbnN0IGxlYXZlcyA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWF2ZXNPZlR5cGUoVklFV19UWVBFKTtcbiAgICBmb3IgKGNvbnN0IGxlYWYgb2YgbGVhdmVzKSB7XG4gICAgICBpZiAobGVhZi52aWV3IGluc3RhbmNlb2YgQ2luZVZhdWx0Vmlldykge1xuICAgICAgICBhd2FpdCBsZWFmLnZpZXcub25PcGVuKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG4iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsSUFBQUEsbUJBQXVCOzs7QUNBaEIsSUFBTSxZQUFZOzs7QUNBekIsSUFBQUMsbUJBQWdFOzs7QUNBekQsU0FBUyxpQkFDZCxXQUNBLFVBQ0EsUUFDQTtBQUNBLFFBQU0sYUFBYSxVQUFVLFVBQVU7QUFBQSxJQUNyQyxLQUFLO0FBQUEsRUFDUCxDQUFDO0FBRUQsUUFBTSxVQUFVLFdBQVcsVUFBVSxFQUFFLEtBQUssK0JBQStCLENBQUM7QUFDNUUsUUFBTSxlQUFlLFFBQVEsU0FBUyxVQUFVLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM5RSxlQUFhLGlCQUFpQixTQUFTLFFBQVE7QUFFL0MsTUFBSSxRQUFRO0FBQ1YsWUFBUSxTQUFTLEtBQUssRUFBRSxNQUFNLEtBQUssQ0FBQztBQUNwQyxVQUFNLGFBQWEsUUFBUSxTQUFTLFVBQVUsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQy9FLGVBQVcsaUJBQWlCLFNBQVMsTUFBTTtBQUFBLEVBQzdDO0FBQ0Y7OztBQ2xCQSxzQkFBc0I7QUFHZixJQUFNLDRCQUFOLGNBQXdDLHNCQUFNO0FBQUEsRUFJbkQsWUFBWSxLQUFtQixPQUE0QixRQUFvQztBQUM3RixVQUFNLEdBQUc7QUFDVCxTQUFLLFFBQVE7QUFDYixTQUFLLFNBQVM7QUFBQSxFQUNoQjtBQUFBLEVBRUEsU0FBUztBQUNQLFVBQU0sRUFBRSxVQUFVLElBQUk7QUFDdEIsY0FBVSxNQUFNO0FBRWhCLGNBQVUsU0FBUyxNQUFNLEVBQUUsTUFBTSxLQUFLLE1BQU0sTUFBTSxDQUFDO0FBQ25ELGNBQVUsU0FBUyxLQUFLLEVBQUUsTUFBTSxHQUFHLEtBQUssTUFBTSxlQUFVLEtBQUssTUFBTSxPQUFPLENBQUM7QUFDM0UsUUFBSSxLQUFLLE1BQU0sUUFBUTtBQUNyQixnQkFBVSxTQUFTLE9BQU8sRUFBRSxLQUFLLHlCQUF5QixDQUFDLEVBQUUsYUFBYSxPQUFPLEtBQUssTUFBTSxNQUFNO0FBQUEsSUFDcEc7QUFDQSxjQUFVLFNBQVMsS0FBSyxFQUFFLE1BQU0sS0FBSyxNQUFNLEtBQUssQ0FBQztBQUVqRCxVQUFNLFVBQVUsVUFBVSxVQUFVLEVBQUUsS0FBSywwQkFBMEIsQ0FBQztBQUN0RSxVQUFNLGdCQUFnQixRQUFRLFNBQVMsVUFBVSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDNUUsVUFBTSxnQkFBZ0IsUUFBUSxTQUFTLFVBQVUsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUVyRSxrQkFBYyxpQkFBaUIsU0FBUyxNQUFNO0FBQzVDLFdBQUssT0FBTyxJQUFJO0FBQ2hCLFdBQUssTUFBTTtBQUFBLElBQ2IsQ0FBQztBQUVELGtCQUFjLGlCQUFpQixTQUFTLE1BQU07QUFDNUMsV0FBSyxPQUFPLEtBQUs7QUFDakIsV0FBSyxNQUFNO0FBQUEsSUFDYixDQUFDO0FBQUEsRUFDSDtBQUNGOzs7QUN0Q0EsSUFBQUMsbUJBQXNCOzs7QUNBZixTQUFTLGlCQUNkLFdBQ0EsUUFDQSxVQUNBLFVBQ0E7QUFDQSxRQUFNLFFBQVEsVUFBVSxVQUFVLEVBQUUsS0FBSyxrQkFBa0IsQ0FBQztBQUM1RCxRQUFNLGVBQWtDLENBQUM7QUFDekMsTUFBSSxnQkFBZ0I7QUFFcEIsV0FBUyxJQUFJLEdBQUcsS0FBSyxHQUFHLEtBQUssR0FBRztBQUM5QixVQUFNLE9BQU8sTUFBTSxTQUFTLFFBQVEsRUFBRSxNQUFNLFVBQUssS0FBSyxpQkFBaUIsQ0FBQztBQUN4RSxRQUFJLEtBQUs7QUFBUSxXQUFLLFVBQVUsSUFBSSxRQUFRO0FBQzVDLGlCQUFhLEtBQUssSUFBSTtBQUN0QixRQUFJLENBQUMsVUFBVTtBQUNiLFdBQUssaUJBQWlCLFNBQVMsTUFBTTtBQUVuQyxZQUFJLGtCQUFrQixHQUFHO0FBQ3ZCLDBCQUFnQjtBQUNoQix1QkFBYSxRQUFRLENBQUMsWUFBWTtBQUNoQyxvQkFBUSxVQUFVLE9BQU8sUUFBUTtBQUFBLFVBQ25DLENBQUM7QUFBQSxRQUNILE9BQU87QUFDTCwwQkFBZ0I7QUFDaEIsdUJBQWEsUUFBUSxDQUFDLFNBQVMsVUFBVTtBQUN2QyxvQkFBUSxVQUFVLE9BQU8sVUFBVSxRQUFRLENBQUM7QUFBQSxVQUM5QyxDQUFDO0FBQUEsUUFDSDtBQUNBLDZDQUFXO0FBQUEsTUFDYixDQUFDO0FBQUEsSUFDSCxPQUFPO0FBQ0wsV0FBSyxVQUFVLElBQUksVUFBVTtBQUFBLElBQy9CO0FBQUEsRUFDRjtBQUNBLFNBQU87QUFDVDs7O0FDL0JPLFNBQVMsU0FBWSxNQUFlLGdCQUEwQixNQUFnQjtBQUNuRixNQUFJO0FBQ0YsVUFBTSxRQUFRLEtBQUs7QUFDbkIsV0FBTyxVQUFVLFFBQVEsVUFBVSxTQUFZLGdCQUFnQjtBQUFBLEVBQ2pFLFNBQVMsR0FBUDtBQUNBLFlBQVEsTUFBTSxXQUFXLENBQUM7QUFDMUIsV0FBTztBQUFBLEVBQ1Q7QUFDRjs7O0FGUE8sSUFBTSw0QkFBTixjQUF3Qyx1QkFBTTtBQUFBLEVBTW5ELFlBQ0UsS0FDQSxPQUNBLFFBQ0EsVUFDQSxpQkFDQTtBQUNBLFVBQU0sR0FBRztBQUNULFNBQUssUUFBUTtBQUNiLFNBQUssU0FBUztBQUNkLFNBQUssV0FBVztBQUNoQixTQUFLLGtCQUFrQjtBQUFBLEVBQ3pCO0FBQUEsRUFFQSxTQUFTO0FBQ1AsVUFBTSxFQUFFLFVBQVUsSUFBSTtBQUN0QixjQUFVLE1BQU07QUFFaEIsVUFBTSxpQkFBaUIsVUFBVSxVQUFVO0FBQUEsTUFDekMsS0FBSztBQUFBLElBQ1AsQ0FBQztBQUVELG1CQUFlLFNBQVMsTUFBTTtBQUFBLE1BQzVCLE1BQU0sS0FBSyxNQUFNO0FBQUEsTUFDakIsS0FBSztBQUFBLElBQ1AsQ0FBQztBQUdELFVBQU0sT0FBTyxTQUFTLE1BQU0sS0FBSyxNQUFNLEtBQUssQ0FBQyxFQUFFLFlBQVksSUFBSSxLQUFLLE1BQU0sS0FBSyxNQUFNLENBQUMsR0FBRyxJQUFJO0FBQzdGLFVBQU0sT0FBTyxTQUFTLE1BQU0sS0FBSyxNQUFNLE1BQU0sSUFBSTtBQUNqRCxtQkFBZSxTQUFTLEtBQUs7QUFBQSxNQUMzQixNQUFNLEdBQUcsVUFBVTtBQUFBLElBQ3JCLENBQUM7QUFHRCxRQUFJLEtBQUssTUFBTSxRQUFRO0FBQ3JCLHFCQUFlLFNBQVMsT0FBTyxFQUFFLEtBQUsseUJBQXlCLENBQUMsRUFBRSxhQUFhLE9BQU8sS0FBSyxNQUFNLE1BQU07QUFBQSxJQUN6RztBQUdBLFFBQUksS0FBSyxNQUFNLE1BQU07QUFDbkIsWUFBTSxnQkFBZ0IsZUFBZSxTQUFTLE9BQU8sRUFBRSxLQUFLLGlDQUFpQyxDQUFDO0FBRTlGLFlBQU0sU0FBUyxjQUFjLFNBQVMsS0FBSztBQUFBLFFBQ3pDLE1BQU0sS0FBSyxNQUFNO0FBQUEsUUFDakIsS0FBSztBQUFBLE1BQ1AsQ0FBQztBQUVELFlBQU0saUJBQWlCLGNBQWMsU0FBUyxVQUFVO0FBQUEsUUFDdEQsTUFBTTtBQUFBLFFBQ04sS0FBSztBQUFBLE1BQ1AsQ0FBQztBQUVELHFCQUFlLGlCQUFpQixTQUFTLE1BQU07QUFDN0MsY0FBTSxhQUFhLE9BQU8sVUFBVSxPQUFPLGVBQWU7QUFDMUQsdUJBQWUsUUFBUSxhQUFhLGNBQWMsV0FBVztBQUFBLE1BQy9ELENBQUM7QUFHRCw0QkFBc0IsTUFBTTtBQUUxQixZQUFJLE9BQU8sZUFBZSxPQUFPLGVBQWUsR0FBRztBQUNqRCx5QkFBZSxZQUFZLGtDQUFrQztBQUFBLFFBQy9EO0FBQUEsTUFDRixDQUFDO0FBQUEsSUFDSDtBQUdBLGFBQVMsbUJBQW1CQyxPQUFjLE9BQWU7QUFDdkQsWUFBTSxnQkFBZ0IsZUFBZSxTQUFTLE9BQU8sRUFBRSxLQUFLLG1DQUFtQyxDQUFDO0FBQ2hHLG9CQUFjLFNBQVMsS0FBSztBQUFBLFFBQzFCLE1BQU0sR0FBR0E7QUFBQSxRQUNULEtBQUs7QUFBQSxNQUNQLENBQUM7QUFDRCxvQkFBYyxTQUFTLEtBQUs7QUFBQSxRQUMxQixNQUFNO0FBQUEsUUFDTixLQUFLO0FBQUEsTUFDUCxDQUFDO0FBQUEsSUFDSDtBQUVBLG1CQUFlLFNBQVMsSUFBSTtBQUc1QixRQUFJLEtBQUssTUFBTSxPQUFPO0FBQ3BCLHlCQUFtQixTQUFTLEtBQUssTUFBTSxLQUFLO0FBQUEsSUFDOUM7QUFHQSxRQUFJLEtBQUssTUFBTSxVQUFVO0FBQ3ZCLHlCQUFtQixZQUFZLEtBQUssTUFBTSxRQUFRO0FBQUEsSUFDcEQ7QUFHQSxRQUFJLEtBQUssTUFBTSxRQUFRO0FBQ3JCLHlCQUFtQixVQUFVLEtBQUssTUFBTSxNQUFNO0FBQUEsSUFDaEQ7QUFFQSxtQkFBZSxTQUFTLElBQUk7QUFHNUIsVUFBTSxrQkFBa0IsZUFBZSxVQUFVO0FBQUEsTUFDL0MsS0FBSztBQUFBLElBQ1AsQ0FBQztBQUVELG9CQUFnQixTQUFTLE9BQU8sRUFBRSxNQUFNLFVBQVUsS0FBSywrQkFBK0IsQ0FBQztBQUN2RixVQUFNLFFBQVEsaUJBQWlCLGlCQUFpQixLQUFLLE1BQU0sWUFBWSxPQUFPLENBQUMsV0FBVztBQUN4RixXQUFLLE9BQU8sTUFBTTtBQUFBLElBQ3BCLENBQUM7QUFDRCxVQUFNLFVBQVUsSUFBSSx1QkFBdUI7QUFHM0MsUUFBSSxLQUFLLE1BQU0sU0FBUztBQUN0QixZQUFNLDJCQUEyQixlQUFlLFVBQVU7QUFBQSxRQUN4RCxLQUFLO0FBQUEsTUFDUCxDQUFDO0FBRUQsaUJBQVcsVUFBVSxLQUFLLE1BQU0sU0FBUztBQUN2QyxjQUFNLFdBQVcseUJBQXlCLFVBQVUsRUFBRSxLQUFLLDBDQUEwQyxDQUFDO0FBQ3RHLGlCQUFTLFNBQVMsT0FBTyxFQUFFLE1BQU0sT0FBTyxRQUFRLEtBQUsseUNBQXlDLENBQUM7QUFDL0YsaUJBQVMsU0FBUyxPQUFPLEVBQUUsTUFBTSxPQUFPLE9BQU8sS0FBSyx3Q0FBd0MsQ0FBQztBQUFBLE1BQy9GO0FBQUEsSUFDRjtBQUVBLFVBQU0sVUFBVSxlQUFlLFVBQVUsRUFBRSxLQUFLLDBCQUEwQixDQUFDO0FBQzNFLFVBQU0scUJBQXFCLEtBQUssTUFBTSxVQUFVLHFCQUFxQjtBQUNyRSxVQUFNLHNCQUFzQixRQUFRLFNBQVMsVUFBVSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbkYsVUFBTSxlQUFlLFFBQVEsU0FBUyxVQUFVLEVBQUUsTUFBTSxVQUFVLEtBQUssbUJBQW1CLENBQUM7QUFFM0Ysd0JBQW9CLGlCQUFpQixTQUFTLE1BQU07QUFDbEQsV0FBSyxnQkFBZ0I7QUFDckIsV0FBSyxNQUFNO0FBQUEsSUFDYixDQUFDO0FBRUQsaUJBQWEsaUJBQWlCLFNBQVMsTUFBTTtBQUMzQyxXQUFLLFNBQVM7QUFDZCxXQUFLLE1BQU07QUFBQSxJQUNiLENBQUM7QUFBQSxFQUNIO0FBQ0Y7OztBR3JKQSxJQUFBQyxtQkFBeUM7QUFFbEMsSUFBTSx1QkFBTixjQUFtQyw4QkFBb0I7QUFBQSxFQUk1RCxZQUFZLEtBQVUsVUFBaUM7QUFDckQsVUFBTSxHQUFHO0FBQ1QsU0FBSyxXQUFXO0FBQ2hCLFNBQUssWUFBWSxLQUFLLElBQUksTUFBTSxTQUFTLEVBQUUsT0FBTyxDQUFDLE1BQU0sRUFBRSxjQUFjLE1BQU07QUFDL0UsU0FBSyxlQUFlLHVDQUF1QztBQUFBLEVBQzdEO0FBQUEsRUFFQSxlQUFlLE9BQXdCO0FBQ3JDLFVBQU0sYUFBYSxNQUFNLFlBQVk7QUFDckMsV0FBTyxLQUFLLFVBQVU7QUFBQSxNQUFPLENBQUMsU0FDNUIsS0FBSyxLQUFLLFlBQVksRUFBRSxTQUFTLFVBQVU7QUFBQSxJQUM3QztBQUFBLEVBQ0Y7QUFBQSxFQUVBLGlCQUFpQixNQUFhLElBQWlCO0FBQzdDLE9BQUcsU0FBUyxPQUFPLEVBQUUsTUFBTSxLQUFLLEtBQUssQ0FBQztBQUFBLEVBQ3hDO0FBQUEsRUFFQSxtQkFBbUIsTUFBYSxLQUFpQztBQUMvRCxTQUFLLFNBQVMsSUFBSTtBQUFBLEVBQ3BCO0FBQ0Y7OztBQ3hCQSxJQUFNLFNBQVM7QUFDZixJQUFNLGVBQWU7QUFFZCxTQUFTLGlCQUFpQjtBQUMvQixTQUFPLEdBQUcsVUFBVTtBQUN0QjtBQUVPLFNBQVMsWUFBWTtBQUMxQixTQUFPO0FBQ1Q7QUFFTyxTQUFTLG1CQUFtQztBQUNqRCxTQUFPO0FBQUEsSUFDTCxJQUFJLE9BQU8sV0FBVztBQUFBLElBQ3RCLFFBQVE7QUFBQSxJQUNSLE9BQU87QUFBQSxJQUNQLE1BQU07QUFBQSxJQUNOLE9BQU87QUFBQSxJQUNQLFVBQVU7QUFBQSxJQUNWLFNBQVM7QUFBQSxJQUNULE9BQU87QUFBQSxJQUNQLFVBQVU7QUFBQSxJQUNWLFFBQVE7QUFBQSxJQUNSLFFBQVE7QUFBQSxJQUNSLE1BQU07QUFBQSxJQUNOLFVBQVU7QUFBQSxJQUNWLFNBQVM7QUFBQSxJQUNULFFBQVE7QUFBQSxJQUNSLFFBQVE7QUFBQSxJQUNSLGFBQWE7QUFBQSxJQUNiLFNBQVMsQ0FBQztBQUFBLElBQ1YsV0FBVztBQUFBLElBQ1gsWUFBWTtBQUFBLElBQ1osV0FBVztBQUFBLElBQ1gsTUFBTTtBQUFBLElBQ04sS0FBSztBQUFBLElBQ0wsV0FBVztBQUFBLElBQ1gsWUFBWTtBQUFBLElBQ1osU0FBUztBQUFBLElBQ1QsY0FBYztBQUFBLElBQ2QsV0FBVztBQUFBLElBQ1gsYUFBYTtBQUFBLElBQ2IsYUFBYTtBQUFBLElBQ2IsY0FBYztBQUFBLElBQ2QsZUFBZTtBQUFBLElBQ2YsYUFBYTtBQUFBLElBQ2IsY0FBYztBQUFBLElBQ2QsaUJBQWlCO0FBQUEsSUFDakIsaUJBQWlCO0FBQUEsSUFDakIsa0JBQWtCO0FBQUEsSUFDbEIsbUJBQW1CO0FBQUEsSUFDbkIsWUFBWTtBQUFBLElBQ1osU0FBUztBQUFBLElBQ1QsT0FBTztBQUFBLEVBQ1Q7QUFDRjtBQUVPLFNBQVMsb0JBQW1DO0FBQ2pELFFBQU0sTUFBTSxJQUFJLEtBQUssRUFBRSxZQUFZO0FBQ25DLFNBQU87QUFBQSxJQUNMLGVBQWU7QUFBQSxJQUNmLFdBQVc7QUFBQSxJQUNYLFdBQVc7QUFBQSxJQUNYLGFBQWE7QUFBQSxJQUNiLE9BQU87QUFBQSxJQUNQLFFBQVE7QUFBQSxJQUNSLFFBQVEsQ0FBQztBQUFBLEVBQ1g7QUFDRjtBQUVPLFNBQVMsY0FBYyxNQUFvQztBQUNoRSxTQUFPO0FBQUEsSUFDTCxHQUFHO0FBQUEsSUFDSCxRQUFRLEtBQUssT0FBTyxJQUFJLENBQUMsV0FBVztBQUFBLE1BQ2xDLEdBQUcsaUJBQWlCO0FBQUEsTUFDcEIsR0FBRztBQUFBLE1BQ0gsTUFBTSxNQUFNLE9BQU8sT0FBTyxNQUFNLElBQUksSUFBSTtBQUFBLE1BQ3hDLFlBQVksT0FBTyxNQUFNLGVBQWUsV0FBVyxNQUFNLGFBQWE7QUFBQSxJQUN4RSxFQUFFO0FBQUEsRUFDSjtBQUNGO0FBRUEsZUFBc0IsYUFBYSxLQUFVO0FBQzNDLE1BQUksQ0FBQyxJQUFJLE1BQU0sc0JBQXNCLE1BQU0sR0FBRztBQUM1QyxVQUFNLElBQUksTUFBTSxhQUFhLE1BQU07QUFBQSxFQUNyQztBQUNGO0FBRUEsZUFBc0IsZUFBZSxLQUEwQjtBQUM3RCxRQUFNLGFBQWEsR0FBRztBQUN0QixRQUFNLFdBQVcsSUFBSSxNQUFNLHNCQUFzQixlQUFlLENBQUM7QUFDakUsUUFBTSxXQUFXLFdBQVcsYUFBYSxLQUFLLElBQUksV0FBVztBQUM3RCxRQUFNLE9BQU8sR0FBRyxVQUFVO0FBRTFCLFNBQU8sSUFBSSxNQUFNLE9BQU8sTUFBTSxLQUFLLFVBQVUsa0JBQWtCLEdBQUcsTUFBTSxDQUFDLENBQUM7QUFDNUU7QUFFQSxlQUFzQixjQUFjLEtBQVUsTUFBcUM7QUFDakYsUUFBTSxNQUFNLE1BQU0sSUFBSSxNQUFNLEtBQUssSUFBSTtBQUNyQyxRQUFNLFNBQVMsS0FBSyxNQUFNLEdBQUc7QUFDN0IsTUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLFFBQVEsT0FBTyxNQUFNLEdBQUc7QUFDNUMsVUFBTSxJQUFJLE1BQU0seUJBQXlCO0FBQUEsRUFDM0M7QUFDQSxTQUFPLGNBQWMsTUFBTTtBQUM3QjtBQUVBLGVBQXNCLGNBQWMsS0FBVSxNQUFhLE1BQXFCO0FBQzlFLFFBQU0sSUFBSSxNQUFNLE9BQU8sTUFBTSxLQUFLLFVBQVUsTUFBTSxNQUFNLENBQUMsQ0FBQztBQUM1RDs7O0FDL0dBLElBQUFDLG1CQUEyQjtBQUczQixlQUFzQixXQUFXLE9BQWUsUUFBZ0Q7QUFDOUYsTUFBSSxDQUFDLFFBQVE7QUFDWCxXQUFPLENBQUM7QUFBQSxFQUNWO0FBRUEsTUFBSTtBQUNGLFVBQU0sTUFBTSxtQ0FBbUMsWUFBWSxtQkFBbUIsS0FBSztBQUNuRixVQUFNLFdBQVcsVUFBTSw2QkFBVyxHQUFHO0FBQ3JDLFVBQU0sT0FBTyxTQUFTO0FBSXRCLFFBQUksNkJBQU0sUUFBUTtBQUNoQixhQUFPLEtBQUssT0FBTyxJQUFJLENBQUMsVUFBVTtBQUFBLFFBQ2hDLFFBQVEsS0FBSztBQUFBLFFBQ2IsT0FBTyxLQUFLO0FBQUEsUUFDWixNQUFNLEtBQUs7QUFBQSxRQUNYLE1BQU0sS0FBSztBQUFBLFFBQ1gsUUFBUSxLQUFLLFVBQVUsS0FBSyxXQUFXLFFBQVEsS0FBSyxTQUFTO0FBQUEsUUFDN0QsTUFBTTtBQUFBLE1BQ1IsRUFBRTtBQUFBLElBQ0o7QUFFQSxXQUFPLENBQUM7QUFBQSxFQUNWLFNBQVMsT0FBUDtBQUNBLFlBQVEsTUFBTSx5QkFBeUIsS0FBSztBQUM1QyxXQUFPLENBQUM7QUFBQSxFQUNWO0FBQ0Y7QUFFQSxlQUFzQixlQUFlLFFBQWdCLFFBQWdCLFFBQWdCLEdBQXlDO0FBRTVILE1BQUksU0FBUyxHQUFHO0FBQ2QsWUFBUSxNQUFNLHVDQUF1QyxnQkFBZ0I7QUFDckUsV0FBTztBQUFBLEVBQ1Q7QUFFQSxNQUFJLENBQUMsUUFBUTtBQUNYLFdBQU87QUFBQSxFQUNUO0FBRUEsTUFBSTtBQUNGLFVBQU0sTUFBTSxtQ0FBbUMsWUFBWTtBQUMzRCxVQUFNLFdBQVcsVUFBTSw2QkFBVyxHQUFHO0FBRXJDLFVBQU0sT0FBTyxTQUFTO0FBRXRCLFFBQUksS0FBSyxhQUFhLFFBQVE7QUFDNUIsY0FBUSxNQUFNLG9DQUFvQyxJQUFJO0FBQ3RELGFBQU87QUFBQSxJQUNUO0FBRUEsV0FBTztBQUFBLEVBQ1QsU0FBUyxPQUFQO0FBQ0EsWUFBUSxNQUFNLDZDQUE2QyxLQUFLO0FBQ2hFLFdBQU8sZUFBZSxRQUFRLFFBQVEsUUFBUSxDQUFDO0FBQUEsRUFDakQ7QUFDRjs7O0FSekNBLElBQXFCLGdCQUFyQixjQUEyQywwQkFBUztBQUFBLEVBU2xELFlBQVksTUFBcUIsUUFBeUI7QUFDeEQsVUFBTSxJQUFJO0FBUFosZ0JBQXFCO0FBQ3JCLGdCQUE2QjtBQUM3QixxQkFBbUM7QUFDbkMsMkJBQXNDO0FBQ3RDLG9CQUE0QjtBQUkxQixTQUFLLFNBQVM7QUFBQSxFQUNoQjtBQUFBLEVBRUEsY0FBYztBQUNaLFdBQU87QUFBQSxFQUNUO0FBQUEsRUFFQSxpQkFBaUI7QUFDZixXQUFPO0FBQUEsRUFDVDtBQUFBO0FBQUEsRUFHQSxVQUFrQjtBQUNoQixXQUFPO0FBQUEsRUFDVDtBQUFBLEVBRUEsTUFBTSxTQUFTO0FBOUNqQjtBQStDSSxTQUFLLFlBQVcsVUFBSyxPQUFPLGFBQVosWUFBd0I7QUFDeEMsVUFBTSxLQUFLLGVBQWU7QUFDMUIsVUFBTSxLQUFLLE9BQU87QUFBQSxFQUNwQjtBQUFBLEVBRUEsTUFBYyxTQUFTO0FBQ3JCLFVBQU0sWUFBWSxLQUFLLFlBQVksU0FBUyxDQUFDO0FBQzdDLGNBQVUsTUFBTTtBQUVoQixVQUFNLFNBQVMsVUFBVSxVQUFVLEVBQUUsS0FBSyxtQkFBbUIsQ0FBQztBQUM5RCxXQUFPLFNBQVMsTUFBTTtBQUFBLE1BQ3BCLE1BQU07QUFBQSxNQUNOLEtBQUs7QUFBQSxJQUNQLENBQUM7QUFFRCxXQUFPLFNBQVMsS0FBSztBQUFBLE1BQ25CLE1BQU07QUFBQSxNQUNOLEtBQUs7QUFBQSxJQUNQLENBQUM7QUFFRCxRQUFJLENBQUMsS0FBSyxNQUFNO0FBQ2QsdUJBQWlCLFdBQVcsWUFBWTtBQUN0QyxhQUFLLE9BQU8sTUFBTSxlQUFlLEtBQUssT0FBTyxHQUFHO0FBQ2hELFlBQUksS0FBSyxNQUFNO0FBQ2IsZ0JBQU0sS0FBSyxPQUFPLGlCQUFpQixLQUFLLEtBQUssSUFBSTtBQUFBLFFBQ25EO0FBQ0EsY0FBTSxLQUFLLFNBQVMsS0FBSyxJQUFJO0FBQzdCLGNBQU0sS0FBSyxPQUFPO0FBQUEsTUFDcEIsR0FBRyxNQUFNO0FBRVAsWUFBSSxxQkFBcUIsS0FBSyxPQUFPLEtBQUssT0FBTyxTQUFTO0FBQ3hELGdCQUFNLEtBQUssU0FBUyxJQUFJO0FBQ3hCLGdCQUFNLEtBQUssT0FBTztBQUFBLFFBQ3BCLENBQUMsRUFBRSxLQUFLO0FBQUEsTUFDVixDQUFDO0FBQ0Q7QUFBQSxJQUNGO0FBRUEsVUFBTSxZQUFZLFVBQVUsVUFBVSxFQUFFLEtBQUssbUJBQW1CLENBQUM7QUFDakUsVUFBTSxjQUFjLFVBQVUsU0FBUyxTQUFTO0FBQUEsTUFDOUMsS0FBSztBQUFBLE1BQ0wsTUFBTTtBQUFBLFFBQ0osYUFBYTtBQUFBLE1BQ2Y7QUFBQSxJQUNGLENBQUM7QUFDRCxVQUFNLGNBQWMsVUFBVSxVQUFVLEVBQUUsS0FBSywyQkFBMkIsQ0FBQztBQUUzRSxVQUFNLFVBQVUsVUFBVSxVQUFVLEVBQUUsS0FBSyxvQkFBb0IsQ0FBQztBQUNoRSxTQUFLLGtCQUFrQjtBQUV2QixTQUFLLGFBQWEsT0FBTztBQUV6QixRQUFJLGdCQUErQjtBQUNuQyxnQkFBWSxpQkFBaUIsU0FBUyxNQUFNO0FBQzFDLFVBQUk7QUFBZSxlQUFPLGFBQWEsYUFBYTtBQUNwRCxzQkFBZ0IsT0FBTyxXQUFXLFlBQVk7QUFDNUMsY0FBTSxRQUFRLFlBQVksTUFBTSxLQUFLO0FBQ3JDLGNBQU0sS0FBSyxvQkFBb0IsYUFBYSxLQUFLO0FBQUEsTUFDbkQsR0FBRyxHQUFHO0FBQUEsSUFDUixDQUFDO0FBQUEsRUFDSDtBQUFBLEVBRVEsYUFBYSxXQUF3QjtBQUMzQyxjQUFVLE1BQU07QUFFaEIsUUFBSSxDQUFDLEtBQUssTUFBTTtBQUNkLGdCQUFVLFNBQVMsS0FBSyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQ7QUFBQSxJQUNGO0FBRUEsVUFBTSxVQUFVLEtBQUssS0FBSyxPQUFPLE9BQU8sQ0FBQyxVQUFVLE1BQU0sT0FBTztBQUNoRSxVQUFNLFVBQVUsS0FBSyxLQUFLLE9BQU8sT0FBTyxDQUFDLFVBQVUsQ0FBQyxNQUFNLE9BQU87QUFFakUsVUFBTSxnQkFBZ0IsVUFBVSxVQUFVLEVBQUUsS0FBSywyQkFBMkIsQ0FBQztBQUM3RSxVQUFNLFlBQVksY0FBYyxVQUFVLEVBQUUsS0FBSyx1QkFBdUIsQ0FBQztBQUV6RSxVQUFNLGFBQWEsVUFBVSxVQUFVLEVBQUUsS0FBSyx3QkFBd0IsQ0FBQztBQUN2RSxVQUFNLGFBQWEsVUFBVSxVQUFVLEVBQUUsS0FBSyx3QkFBd0IsQ0FBQztBQUV2RSxVQUFNLGdCQUFnQixXQUFXLFNBQVMsVUFBVTtBQUFBLE1BQ2xELEtBQUs7QUFBQSxNQUNMLE1BQU0sYUFBYSxRQUFRO0FBQUEsSUFDN0IsQ0FBQztBQUNELFVBQU0sZ0JBQWdCLFdBQVcsU0FBUyxVQUFVO0FBQUEsTUFDbEQsS0FBSztBQUFBLE1BQ0wsTUFBTSxZQUFZLFFBQVE7QUFBQSxJQUM1QixDQUFDO0FBRUQsVUFBTSxhQUFhLFdBQVcsU0FBUyxVQUFVO0FBQUEsTUFDL0MsS0FBSztBQUFBLE1BQ0wsTUFBTSxFQUFFLGNBQWMsYUFBYSxPQUFPLFlBQVk7QUFBQSxJQUN4RCxDQUFDO0FBQ0QsVUFBTSxhQUFhLFdBQVcsU0FBUyxVQUFVO0FBQUEsTUFDL0MsS0FBSztBQUFBLE1BQ0wsTUFBTSxFQUFFLGNBQWMsYUFBYSxPQUFPLFlBQVk7QUFBQSxJQUN4RCxDQUFDO0FBRUQsa0NBQVEsWUFBWSxhQUFhO0FBQ2pDLGtDQUFRLFlBQVksTUFBTTtBQUUxQixRQUFJLEtBQUssY0FBYyxXQUFXO0FBQ2hDLG9CQUFjLFVBQVUsSUFBSSw2QkFBNkI7QUFBQSxJQUMzRCxPQUFPO0FBQ0wsb0JBQWMsVUFBVSxJQUFJLDZCQUE2QjtBQUFBLElBQzNEO0FBRUEsUUFBSSxLQUFLLGFBQWEsUUFBUTtBQUM1QixpQkFBVyxVQUFVLElBQUksOEJBQThCO0FBQUEsSUFDekQsT0FBTztBQUNMLGlCQUFXLFVBQVUsSUFBSSw4QkFBOEI7QUFBQSxJQUN6RDtBQUVBLFVBQU0sYUFBYSxjQUFjLFVBQVUsRUFBRSxLQUFLLHdCQUF3QixDQUFDO0FBQzNFLFVBQU0sZUFBZSxLQUFLLGNBQWMsWUFBWSxVQUFVO0FBQzlELFVBQU0sY0FBYyxLQUFLLGNBQWMsWUFBWSxhQUFhO0FBQ2hFLFNBQUssbUJBQW1CLFlBQVksYUFBYSxZQUFZO0FBRTdELGtCQUFjLGlCQUFpQixTQUFTLE1BQU07QUFDNUMsVUFBSSxLQUFLLGNBQWM7QUFBVztBQUNsQyxXQUFLLFlBQVk7QUFDakIsV0FBSyxhQUFhLFNBQVM7QUFBQSxJQUM3QixDQUFDO0FBRUQsa0JBQWMsaUJBQWlCLFNBQVMsTUFBTTtBQUM1QyxVQUFJLEtBQUssY0FBYztBQUFXO0FBQ2xDLFdBQUssWUFBWTtBQUNqQixXQUFLLGFBQWEsU0FBUztBQUFBLElBQzdCLENBQUM7QUFFRCxlQUFXLGlCQUFpQixTQUFTLFlBQVk7QUFDL0MsVUFBSSxLQUFLLGFBQWE7QUFBUTtBQUM5QixXQUFLLFdBQVc7QUFDaEIsWUFBTSxLQUFLLE9BQU8sWUFBWSxNQUFNO0FBQ3BDLFdBQUssYUFBYSxTQUFTO0FBQUEsSUFDN0IsQ0FBQztBQUVELGVBQVcsaUJBQWlCLFNBQVMsWUFBWTtBQUMvQyxVQUFJLEtBQUssYUFBYTtBQUFRO0FBQzlCLFdBQUssV0FBVztBQUNoQixZQUFNLEtBQUssT0FBTyxZQUFZLE1BQU07QUFDcEMsV0FBSyxhQUFhLFNBQVM7QUFBQSxJQUM3QixDQUFDO0FBQUEsRUFDSDtBQUFBLEVBRVEsbUJBQW1CLFdBQXdCLE9BQWUsUUFBMEI7QUFDMUYsVUFBTSxVQUFVLFVBQVUsVUFBVSxFQUFFLEtBQUssb0JBQW9CLENBQUM7QUFDaEUsWUFBUSxTQUFTLE1BQU0sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUV0QyxRQUFJLE9BQU8sV0FBVyxHQUFHO0FBQ3ZCLGNBQVEsU0FBUyxLQUFLLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUN6RDtBQUFBLElBQ0Y7QUFFQSxVQUFNLE9BQU8sUUFBUSxVQUFVO0FBQUEsTUFDN0IsS0FBSyxLQUFLLGFBQWEsU0FBUyx5QkFBeUI7QUFBQSxJQUMzRCxDQUFDO0FBRUQsUUFBSSxLQUFLLGFBQWEsUUFBUTtBQUM1QixXQUFLLGdCQUFnQixNQUFNLE1BQU07QUFBQSxJQUNuQyxPQUFPO0FBQ0wsV0FBSyxnQkFBZ0IsTUFBTSxNQUFNO0FBQUEsSUFDbkM7QUFBQSxFQUNGO0FBQUEsRUFFUSxnQkFBZ0IsV0FBd0IsUUFBMEI7QUFDeEUsV0FBTyxRQUFRLENBQUMsVUFBVTtBQUN4QixZQUFNLE9BQU8sVUFBVSxVQUFVLEVBQUUsS0FBSyx1QkFBdUIsQ0FBQztBQUNoRSxXQUFLLFNBQVMsT0FBTyxFQUFFLEtBQUsseUJBQXlCLENBQUMsRUFBRSxhQUFhLE9BQU8sTUFBTSxNQUFNO0FBQ3hGLFdBQUssU0FBUyxPQUFPLEVBQUUsTUFBTSxNQUFNLE9BQU8sS0FBSyx3QkFBd0IsQ0FBQztBQUd4RSxZQUFNLGVBQXlCLENBQUM7QUFDaEMsWUFBTSxPQUFPLFNBQVMsTUFBTSxNQUFNLE1BQU0sSUFBSTtBQUM1QyxZQUFNLE9BQU8sU0FBUyxNQUFNLE1BQU0sS0FBSyxDQUFDLEVBQUUsWUFBWSxJQUFJLE1BQU0sS0FBSyxNQUFNLENBQUMsR0FBRyxJQUFJO0FBRW5GLFVBQUk7QUFBTSxxQkFBYSxLQUFLLElBQUk7QUFDaEMsVUFBSTtBQUFNLHFCQUFhLEtBQUssSUFBSTtBQUVoQyxZQUFNLGNBQWMsYUFBYSxLQUFLLEtBQUs7QUFDM0MsVUFBSSxhQUFhO0FBQ2YsYUFBSyxTQUFTLE9BQU8sRUFBRSxNQUFNLGFBQWEsS0FBSyx1QkFBdUIsQ0FBQztBQUFBLE1BQ3pFO0FBRUEsV0FBSyxpQkFBaUIsU0FBUyxNQUFNLEtBQUssaUJBQWlCLEtBQUssQ0FBQztBQUFBLElBQ25FLENBQUM7QUFBQSxFQUNIO0FBQUEsRUFFUSxnQkFBZ0IsV0FBd0IsUUFBMEI7QUFDeEUsV0FBTyxRQUFRLENBQUMsVUFBVTtBQUN4QixZQUFNLE1BQU0sVUFBVSxVQUFVLEVBQUUsS0FBSyxzQkFBc0IsQ0FBQztBQUM5RCxZQUFNLFNBQVMsSUFBSSxTQUFTLE9BQU8sRUFBRSxLQUFLLDRCQUE0QixDQUFDO0FBQ3ZFLGFBQU8sYUFBYSxPQUFPLE1BQU0sVUFBVSxFQUFFO0FBRTdDLFlBQU0sT0FBTyxJQUFJLFVBQVUsRUFBRSxLQUFLLHVCQUF1QixDQUFDO0FBQzFELFdBQUssU0FBUyxPQUFPLEVBQUUsTUFBTSxNQUFNLE9BQU8sS0FBSyx3QkFBd0IsQ0FBQztBQUd4RSxZQUFNLGVBQXlCLENBQUM7QUFDaEMsWUFBTSxPQUFPLFNBQVMsTUFBTSxNQUFNLE1BQU0sSUFBSTtBQUM1QyxZQUFNLE9BQU8sU0FBUyxNQUFNLE1BQU0sS0FBSyxDQUFDLEVBQUUsWUFBWSxJQUFJLE1BQU0sS0FBSyxNQUFNLENBQUMsR0FBRyxJQUFJO0FBRW5GLFVBQUk7QUFBTSxxQkFBYSxLQUFLLElBQUk7QUFDaEMsVUFBSTtBQUFNLHFCQUFhLEtBQUssSUFBSTtBQUVoQyxZQUFNLGNBQWMsYUFBYSxLQUFLLEtBQUs7QUFDM0MsVUFBSSxhQUFhO0FBQ2YsYUFBSyxTQUFTLE9BQU8sRUFBRSxNQUFNLGFBQWEsS0FBSyx1QkFBdUIsQ0FBQztBQUFBLE1BQ3pFO0FBRUEsVUFBSSxpQkFBaUIsU0FBUyxNQUFNLEtBQUssaUJBQWlCLEtBQUssQ0FBQztBQUFBLElBQ2xFLENBQUM7QUFBQSxFQUNIO0FBQUEsRUFFUSxpQkFBaUIsT0FBdUI7QUFDOUMsUUFBSSwwQkFBMEIsS0FBSyxPQUFPLEtBQUssT0FBTyxPQUFPLFdBQVc7QUFDdEUsVUFBSSxDQUFDLEtBQUs7QUFBTTtBQUNoQixZQUFNLGFBQWE7QUFDbkIsWUFBTSxLQUFLLFNBQVM7QUFDcEIsV0FBSyxjQUFjO0FBQUEsSUFDckIsR0FBRyxZQUFZO0FBQ2IsVUFBSSxDQUFDLEtBQUs7QUFBTTtBQUNoQixXQUFLLEtBQUssU0FBUyxLQUFLLEtBQUssT0FBTyxPQUFPLENBQUMsU0FBUyxLQUFLLE9BQU8sTUFBTSxFQUFFO0FBQ3pFLFlBQU0sS0FBSyxTQUFTO0FBQ3BCLFdBQUssY0FBYztBQUFBLElBQ3JCLEdBQUcsWUFBWTtBQUNiLFVBQUksQ0FBQyxLQUFLO0FBQU07QUFDaEIsWUFBTSxVQUFVLENBQUMsTUFBTTtBQUN2QixZQUFNLEtBQUssU0FBUztBQUNwQixXQUFLLGNBQWM7QUFBQSxJQUNyQixDQUFDLEVBQUUsS0FBSztBQUFBLEVBQ1Y7QUFBQSxFQUVRLGdCQUFnQjtBQUN0QixRQUFJLENBQUMsS0FBSztBQUFpQjtBQUMzQixTQUFLLGFBQWEsS0FBSyxlQUFlO0FBQUEsRUFDeEM7QUFBQSxFQUVRLGVBQXdCO0FBQzlCLFdBQU8sS0FBSyxPQUFPLElBQUksTUFBTSxTQUFTLEVBQUUsT0FBTyxDQUFDLFNBQVMsS0FBSyxjQUFjLE1BQU07QUFBQSxFQUNwRjtBQUFBLEVBRUEsTUFBYyxpQkFBaUI7QUFFN0IsVUFBTSxZQUFZLEtBQUssT0FBTztBQUM5QixRQUFJLFdBQVc7QUFDYixZQUFNLFlBQVksS0FBSyxPQUFPLElBQUksTUFBTSxzQkFBc0IsU0FBUztBQUN2RSxVQUFJLHFCQUFxQix3QkFBTztBQUM5QixjQUFNLEtBQUssU0FBUyxTQUFTO0FBQzdCO0FBQUEsTUFDRjtBQUFBLElBQ0Y7QUFHQSxTQUFLLE9BQU87QUFDWixTQUFLLE9BQU87QUFBQSxFQUNkO0FBQUEsRUFFQSxNQUFjLFNBQVMsTUFBYTtBQUNsQyxRQUFJO0FBQ0YsWUFBTSxTQUFTLE1BQU0sY0FBYyxLQUFLLE9BQU8sS0FBSyxJQUFJO0FBQ3hELFdBQUssT0FBTztBQUNaLFdBQUssT0FBTztBQUNaLFlBQU0sS0FBSyxPQUFPLGlCQUFpQixLQUFLLElBQUk7QUFBQSxJQUM5QyxTQUFTLE9BQVA7QUFDQSxXQUFLLE9BQU87QUFDWixXQUFLLE9BQU87QUFDWixVQUFJLHdCQUFPLCtCQUErQjtBQUFBLElBQzVDO0FBQUEsRUFDRjtBQUFBLEVBQ0EsTUFBYyxXQUFXO0FBQ3ZCLFFBQUksQ0FBQyxLQUFLO0FBQU07QUFDaEIsU0FBSyxLQUFLLFlBQVksSUFBSSxLQUFLLEVBQUUsWUFBWTtBQUM3QyxRQUFJLEtBQUssTUFBTTtBQUNiLFlBQU0sY0FBYyxLQUFLLE9BQU8sS0FBSyxLQUFLLE1BQU0sS0FBSyxJQUFJO0FBQUEsSUFDM0Q7QUFBQSxFQUNGO0FBQUEsRUFHQSxNQUFjLG9CQUFvQixXQUF3QixPQUFlO0FBQ3ZFLGNBQVUsTUFBTTtBQUNoQixRQUFJLENBQUMsU0FBUyxNQUFNLFNBQVM7QUFBRztBQUVoQyxVQUFNLFVBQVUsTUFBTSxXQUFXLE9BQU8sS0FBSyxPQUFPLFVBQVU7QUFDOUQsUUFBSSxRQUFRLFdBQVcsR0FBRztBQUN4QixnQkFBVSxTQUFTLE9BQU8sRUFBRSxNQUFNLHFCQUFxQixLQUFLLHlCQUF5QixDQUFDO0FBQ3RGO0FBQUEsSUFDRjtBQUVBLFlBQVEsUUFBUSxDQUFDLFdBQVc7QUFDMUIsWUFBTSxPQUFPLFVBQVUsVUFBVSxFQUFFLEtBQUssd0JBQXdCLENBQUM7QUFDakUsVUFBSSxPQUFPLFFBQVE7QUFDakIsYUFBSyxTQUFTLE9BQU8sRUFBRSxLQUFLLDBCQUEwQixDQUFDLEVBQUUsYUFBYSxPQUFPLE9BQU8sTUFBTTtBQUFBLE1BQzVGO0FBQ0EsWUFBTSxPQUFPLEtBQUssVUFBVSxFQUFFLEtBQUssd0JBQXdCLENBQUM7QUFDNUQsV0FBSyxTQUFTLE9BQU8sRUFBRSxNQUFNLE9BQU8sT0FBTyxLQUFLLHlCQUF5QixDQUFDO0FBQzFFLFdBQUssU0FBUyxPQUFPLEVBQUUsTUFBTSxPQUFPLE1BQU0sS0FBSyx3QkFBd0IsQ0FBQztBQUV4RSxXQUFLLGlCQUFpQixTQUFTLE1BQU07QUFDbkMsWUFBSSwwQkFBMEIsS0FBSyxPQUFPLEtBQUssUUFBUSxPQUFPLFlBQVk7QUFDeEUsY0FBSSxDQUFDLEtBQUs7QUFBTTtBQUVoQixnQkFBTSxXQUFXLEtBQUssS0FBSyxPQUFPLEtBQUssQ0FBQyxVQUFVLE1BQU0sV0FBVyxPQUFPLE1BQU07QUFDaEYsY0FBSSxVQUFVO0FBQ1oscUJBQVMsVUFBVTtBQUFBLFVBQ3JCLE9BQU87QUFFTCxnQkFBSSx3QkFBTyx1QkFBdUIsT0FBTyxVQUFVO0FBQ25ELGtCQUFNLFVBQVUsTUFBTSxlQUFlLE9BQU8sUUFBUSxLQUFLLE9BQU8sVUFBVTtBQUUxRSxnQkFBSSxDQUFDLFNBQVM7QUFDWixrQkFBSSx3QkFBTywrQkFBK0I7QUFDMUM7QUFBQSxZQUNGO0FBRUEsa0JBQU0sV0FBVyxpQkFBaUI7QUFDbEMscUJBQVMsU0FBUyxRQUFRLFVBQVUsT0FBTztBQUMzQyxxQkFBUyxRQUFRLFFBQVEsU0FBUyxPQUFPO0FBQ3pDLHFCQUFTLE9BQU8sUUFBUSxRQUFRLE9BQU87QUFDdkMscUJBQVMsUUFBUSxRQUFRLFNBQVM7QUFDbEMscUJBQVMsV0FBVyxRQUFRLFlBQVk7QUFDeEMscUJBQVMsVUFBVSxRQUFRLFdBQVc7QUFDdEMscUJBQVMsUUFBUSxRQUFRLFNBQVM7QUFDbEMscUJBQVMsV0FBVyxRQUFRLFlBQVk7QUFDeEMscUJBQVMsU0FBUyxRQUFRLFVBQVU7QUFDcEMscUJBQVMsU0FBUyxRQUFRLFVBQVU7QUFDcEMscUJBQVMsT0FBTyxRQUFRLFFBQVEsT0FBTztBQUN2QyxxQkFBUyxXQUFXLFFBQVEsWUFBWTtBQUN4QyxxQkFBUyxVQUFVLFFBQVEsV0FBVztBQUN0QyxxQkFBUyxTQUFTLFFBQVEsVUFBVTtBQUNwQyxxQkFBUyxTQUFTLFFBQVEsVUFBVSxRQUFRLFdBQVcsUUFBUSxRQUFRLFNBQVMsT0FBTztBQUN2RixxQkFBUyxjQUFjO0FBQ3ZCLHFCQUFTLFVBQVUsUUFBUSxXQUFXLENBQUM7QUFDdkMscUJBQVMsWUFBWSxRQUFRLGFBQWE7QUFDMUMscUJBQVMsYUFBYSxRQUFRLGNBQWM7QUFDNUMscUJBQVMsWUFBWSxRQUFRLGFBQWE7QUFDMUMscUJBQVMsT0FBTyxRQUFRLFFBQVEsT0FBTztBQUN2QyxxQkFBUyxNQUFNLFFBQVEsT0FBTztBQUM5QixxQkFBUyxZQUFZLFFBQVEsYUFBYTtBQUMxQyxxQkFBUyxhQUFhLFFBQVEsY0FBYztBQUM1QyxxQkFBUyxVQUFVLFFBQVEsV0FBVztBQUN0QyxxQkFBUyxlQUFlLFFBQVEsZ0JBQWdCO0FBQ2hELHFCQUFTLFVBQVU7QUFFbkIsaUJBQUssS0FBSyxPQUFPLEtBQUssUUFBUTtBQUFBLFVBQ2hDO0FBQ0EsZ0JBQU0sS0FBSyxTQUFTO0FBQ3BCLGVBQUssT0FBTztBQUFBLFFBQ2QsQ0FBQyxFQUFFLEtBQUs7QUFBQSxNQUNWLENBQUM7QUFBQSxJQUNILENBQUM7QUFBQSxFQUNIO0FBQ0Y7OztBUzlZQSxJQUFBQyxtQkFBOEQ7QUFNOUQsSUFBcUIsc0JBQXJCLGNBQWlELGtDQUFpQjtBQUFBLEVBR2hFLFlBQVksS0FBVSxRQUF5QjtBQUM3QyxVQUFNLEtBQUssTUFBTTtBQUNqQixTQUFLLFNBQVM7QUFBQSxFQUNoQjtBQUFBLEVBRUEsVUFBZ0I7QUFDZCxVQUFNLEVBQUUsWUFBWSxJQUFJO0FBRXhCLGdCQUFZLE1BQU07QUFHbEIsUUFBSSx5QkFBUSxXQUFXLEVBQUUsUUFBUSxlQUFlLEVBQUUsV0FBVztBQUM3RCxRQUFJLHlCQUFRLFdBQVcsRUFDcEIsUUFBUSxjQUFjLEVBQ3RCLFFBQVEsa0VBQWtFLEVBQzFFLFFBQVEsVUFBUSxLQUNkLGVBQWUsb0JBQW9CLEVBQ25DLFNBQVMsS0FBSyxPQUFPLFVBQVUsRUFDL0IsU0FBUyxPQUFPLFVBQVU7QUFDekIsWUFBTSxLQUFLLE9BQU8sY0FBYyxLQUFLO0FBQUEsSUFDdkMsQ0FBQyxDQUFDO0FBSU4sUUFBSSx5QkFBUSxXQUFXLEVBQ3BCLFFBQVEsc0JBQXNCLEVBQzlCO0FBQUEsTUFDQyxLQUFLLE9BQU8sZ0JBQ1IsZUFBZSxLQUFLLE9BQU8sa0JBQzNCO0FBQUEsSUFDTixFQUNDLFlBQVksVUFBUTtBQXhDM0I7QUF5Q1EsWUFBTSxRQUFRLEtBQUssSUFBSSxNQUFNLFNBQVMsRUFBRSxPQUFPLENBQUMsTUFBTSxFQUFFLGNBQWMsTUFBTTtBQUM1RSxZQUFNLFVBQWtDLEVBQUUsSUFBSSxhQUFhO0FBQzNELFlBQU0sUUFBUSxDQUFDLE1BQU8sUUFBUSxFQUFFLElBQUksSUFBSSxFQUFFLElBQUs7QUFDL0MsV0FBSyxXQUFXLE9BQU8sRUFBRSxVQUFTLFVBQUssT0FBTyxrQkFBWixZQUE2QixFQUFFLEVBQUUsU0FBUyxPQUFPLFVBQVU7QUFDM0YsY0FBTSxPQUFPLFNBQVM7QUFDdEIsY0FBTSxLQUFLLE9BQU8saUJBQWlCLElBQUk7QUFDdkMsY0FBTSxLQUFLLGlCQUFpQjtBQUM1QixhQUFLLFFBQVE7QUFBQSxNQUNmLENBQUM7QUFBQSxJQUNILENBQUMsRUFDQSxVQUFVLFlBQVUsT0FDbEIsY0FBYyxjQUFjLEVBQzVCLFlBQVksQ0FBQyxLQUFLLE9BQU8sYUFBYSxFQUN0QyxRQUFRLFlBQVk7QUFDbkIsWUFBTSxLQUFLLE9BQU8saUJBQWlCLElBQUk7QUFDdkMsWUFBTSxLQUFLLGlCQUFpQjtBQUM1QixXQUFLLFFBQVE7QUFBQSxJQUNmLENBQUMsQ0FBQztBQUVOLFFBQUkseUJBQVEsV0FBVyxFQUNwQixRQUFRLG9CQUFvQixFQUM1QixRQUFRLHVGQUF1RixFQUMvRixVQUFVLFlBQVUsT0FDbEIsY0FBYyxnQkFBZ0IsRUFDOUIsUUFBUSxZQUFZO0FBQ25CLFlBQU0sS0FBSyxpQkFBaUI7QUFBQSxJQUM5QixDQUFDLENBQUM7QUFFTixRQUFJLHlCQUFRLFdBQVcsRUFDcEIsUUFBUSxnQkFBZ0IsRUFDeEIsUUFBUSw2Q0FBNkMsRUFDckQsVUFBVSxZQUFVLE9BQ2xCLGNBQWMsYUFBYSxFQUMzQixRQUFRLFlBQVk7QUFDbkIsWUFBTSxLQUFLLGtCQUFrQjtBQUFBLElBQy9CLENBQUMsQ0FBQztBQUdOLFFBQUkseUJBQVEsV0FBVyxFQUFFLFFBQVEsUUFBUSxFQUFFLFdBQVc7QUFDdEQsUUFBSSx5QkFBUSxXQUFXLEVBQ3BCLFFBQVEsZUFBZSxFQUN2QixRQUFRLHVIQUF1SCxFQUMvSCxVQUFVLFlBQVUsT0FDbEIsY0FBYyxRQUFRLEVBQ3RCLFFBQVEsTUFBTTtBQUNiLGFBQU8sS0FBSyw2REFBNkQsUUFBUTtBQUFBLElBQ25GLENBQUMsQ0FBQztBQUdOLFFBQUkseUJBQVEsV0FBVyxFQUFFLFFBQVEsU0FBUyxFQUFFLFdBQVc7QUFDdkQsUUFBSSx5QkFBUSxXQUFXLEVBQ3BCLFFBQVEsUUFBUSxFQUNoQjtBQUFBLE1BQ0M7QUFBQSxJQUNGLEVBQ0MsVUFBVSxDQUFDLE9BQU87QUFDakIsU0FBRyxTQUFTLFlBQ1Y7QUFBQSxJQUNKLENBQUM7QUFBQSxFQUNMO0FBQUEsRUFFQSxNQUFjLG9CQUFvQjtBQUNoQyxRQUFJO0FBQ0YsWUFBTSxVQUFVLE1BQU0sS0FBSyxzQkFBc0I7QUFDakQsVUFBSSxDQUFDLFNBQVM7QUFDWixZQUFJLHdCQUFPLGtDQUFrQztBQUM3QztBQUFBLE1BQ0Y7QUFHQSxZQUFNLFlBQVksSUFBSSxLQUFLLEVBQUUsWUFBWSxFQUFFLFFBQVEsU0FBUyxHQUFHLEVBQUUsTUFBTSxHQUFHLEVBQUU7QUFDNUUsWUFBTSxhQUFhLG9CQUFvQjtBQUd2QyxVQUFJLFlBQVk7QUFDaEIsVUFBSSxVQUFVO0FBQ2QsYUFBTyxLQUFLLElBQUksTUFBTSxzQkFBc0IsU0FBUyxHQUFHO0FBQ3RELG9CQUFZLG9CQUFvQixhQUFhO0FBQzdDO0FBQUEsTUFDRjtBQUVBLFlBQU0sS0FBSyxJQUFJLE1BQU0sT0FBTyxXQUFXLE9BQU87QUFDOUMsVUFBSSx3QkFBTyx1QkFBdUIsV0FBVztBQUFBLElBQy9DLFNBQVMsT0FBUDtBQUNBLGNBQVEsTUFBTSxvQ0FBb0MsS0FBSztBQUN2RCxVQUFJLHdCQUFPLCtCQUErQjtBQUFBLElBQzVDO0FBQUEsRUFDRjtBQUFBLEVBRUEsTUFBYyxtQkFBbUI7QUFDL0IsVUFBTSxZQUFZLE9BQU87QUFBQSxNQUN2QjtBQUFBLElBQ0Y7QUFDQSxRQUFJLENBQUM7QUFBVztBQUVoQixRQUFJO0FBQ0YsWUFBTSxjQUFjLEtBQUssSUFBSSxNQUFNLHNCQUFzQixlQUFlLENBQUM7QUFDekUsVUFBSTtBQUNKLFVBQUksdUJBQXVCLHdCQUFPO0FBQ2hDLGNBQU0sY0FBYyxLQUFLLEtBQUssYUFBYSxrQkFBa0IsQ0FBQztBQUM5RCxzQkFBYztBQUFBLE1BQ2hCLE9BQU87QUFDTCxzQkFBYyxNQUFNLGVBQWUsS0FBSyxHQUFHO0FBQUEsTUFDN0M7QUFFQSxVQUFJLGFBQWE7QUFDZixjQUFNLEtBQUssT0FBTyxpQkFBaUIsWUFBWSxJQUFJO0FBQUEsTUFDckQ7QUFDQSxZQUFNLEtBQUssaUJBQWlCO0FBQzVCLFdBQUssUUFBUTtBQUNiLFVBQUksd0JBQU8sc0JBQXNCO0FBQUEsSUFDbkMsU0FBUyxPQUFQO0FBQ0EsY0FBUSxNQUFNLHdDQUF3QyxLQUFLO0FBQzNELFVBQUksd0JBQU8saUNBQWlDO0FBQUEsSUFDOUM7QUFBQSxFQUNGO0FBQUEsRUFFQSxNQUFjLHdCQUFnRDtBQUU1RCxRQUFJLEtBQUssT0FBTyxlQUFlO0FBQzdCLFlBQU0sWUFBWSxLQUFLLE9BQU87QUFDOUIsWUFBTSxPQUFPLEtBQUssSUFBSSxNQUFNLHNCQUFzQixTQUFTO0FBQzNELFVBQUksZ0JBQWdCLHdCQUFPO0FBQ3pCLGVBQU8sS0FBSyxJQUFJLE1BQU0sS0FBSyxJQUFJO0FBQUEsTUFDakM7QUFBQSxJQUNGO0FBRUEsVUFBTSxjQUFjLEtBQUssSUFBSSxNQUFNLHNCQUFzQixlQUFlLENBQUM7QUFDekUsUUFBSSx1QkFBdUIsd0JBQU87QUFDaEMsYUFBTyxLQUFLLElBQUksTUFBTSxLQUFLLFdBQVc7QUFBQSxJQUN4QztBQUVBLFVBQU0sU0FBUyxVQUFVO0FBQ3pCLFVBQU0sV0FBVyxLQUFLLElBQUksTUFDdkIsU0FBUyxFQUNULEtBQUssQ0FBQyxTQUFTLEtBQUssY0FBYyxVQUFVLEtBQUssS0FBSyxXQUFXLEdBQUcsU0FBUyxDQUFDO0FBRWpGLFFBQUksVUFBVTtBQUNaLGFBQU8sS0FBSyxJQUFJLE1BQU0sS0FBSyxRQUFRO0FBQUEsSUFDckM7QUFFQSxXQUFPO0FBQUEsRUFDVDtBQUFBLEVBRUEsTUFBYyxtQkFBbUI7QUFDL0IsVUFBTSxTQUFTLEtBQUssSUFBSSxVQUFVLGdCQUFnQixTQUFTO0FBQzNELGVBQVcsUUFBUSxRQUFRO0FBQ3pCLFVBQUksS0FBSyxnQkFBZ0IsZUFBZTtBQUN0QyxjQUFNLEtBQUssS0FBSyxPQUFPO0FBQUEsTUFDekI7QUFBQSxJQUNGO0FBQUEsRUFDRjtBQUNGOzs7QVhyTEEsSUFBcUIsa0JBQXJCLGNBQTZDLHdCQUFPO0FBQUEsRUFBcEQ7QUFBQTtBQUNDLHlCQUErQjtBQUMvQixzQkFBcUI7QUFDckIsb0JBQTRCO0FBQUE7QUFBQTtBQUFBLEVBRzVCLE1BQU0sU0FBUztBQUNkLFVBQU0sS0FBSyxlQUFlO0FBRzFCLFNBQUssY0FBYyxJQUFJLG9CQUFvQixLQUFLLEtBQUssSUFBSSxDQUFDO0FBRzFELFNBQUs7QUFBQSxNQUNKO0FBQUEsTUFDQSxDQUFDLFNBQVMsSUFBSSxjQUFjLE1BQU0sSUFBSTtBQUFBLElBQ3ZDO0FBRUEsU0FBSyxjQUFjLGdCQUFnQixhQUFhLFlBQVk7QUFDM0QsWUFBTSxLQUFLLFdBQVc7QUFBQSxJQUN2QixDQUFDO0FBQUEsRUFDRjtBQUFBO0FBQUEsRUFHQSxXQUFXO0FBQUEsRUFDWDtBQUFBLEVBRUEsTUFBYyxpQkFBaUI7QUF2Q2hDO0FBd0NFLFVBQU0sT0FBUSxNQUFNLEtBQUssU0FBUztBQUNsQyxTQUFLLGlCQUFnQixrQ0FBTSxrQkFBTixZQUF1QjtBQUM1QyxTQUFLLGNBQWEsa0NBQU0sZUFBTixZQUFvQjtBQUN0QyxTQUFLLFlBQVcsa0NBQU0sYUFBTixZQUFrQjtBQUFBLEVBQ25DO0FBQUE7QUFBQSxFQUlBLE1BQU0sY0FBYyxRQUFnQjtBQUNuQyxTQUFLLGFBQWE7QUFDbEIsVUFBTSxLQUFLLGVBQWU7QUFBQSxFQUMzQjtBQUFBLEVBRUEsTUFBTSxZQUFZLFVBQTJCO0FBQzVDLFNBQUssV0FBVztBQUNoQixVQUFNLEtBQUssZUFBZTtBQUFBLEVBQzNCO0FBQUEsRUFFQSxNQUFjLGlCQUFpQjtBQUM5QixVQUFNLE9BQTRCO0FBQUEsTUFDakMsWUFBWSxLQUFLO0FBQUEsTUFDakIsVUFBVSxLQUFLO0FBQUEsSUFDaEI7QUFDQSxRQUFJLEtBQUssZUFBZTtBQUN2QixXQUFLLGdCQUFnQixLQUFLO0FBQUEsSUFDM0I7QUFDQSxVQUFNLEtBQUssU0FBUyxJQUFJO0FBQUEsRUFDekI7QUFBQSxFQUVBLE1BQU0saUJBQWlCLE1BQXFCO0FBQzNDLFNBQUssZ0JBQWdCO0FBQ3JCLFVBQU0sS0FBSyxlQUFlO0FBQUEsRUFDM0I7QUFBQTtBQUFBLEVBR0EsTUFBYyxhQUFhO0FBQzFCLFVBQU0saUJBQWlCLEtBQUssSUFBSSxVQUFVLGdCQUFnQixTQUFTO0FBQ25FLFFBQUksZUFBZSxTQUFTLEdBQUc7QUFDOUIsV0FBSyxJQUFJLFVBQVUsV0FBVyxlQUFlLENBQUMsQ0FBQztBQUMvQztBQUFBLElBQ0Q7QUFFQSxVQUFNLE9BQU8sS0FBSyxJQUFJLFVBQVUsUUFBUSxJQUFJO0FBQzVDLFVBQU0sS0FBSyxhQUFhO0FBQUEsTUFDdkIsTUFBTTtBQUFBLE1BQ04sUUFBUTtBQUFBLElBQ1QsQ0FBQztBQUFBLEVBQ0Y7QUFDRDsiLAogICJuYW1lcyI6IFsiaW1wb3J0X29ic2lkaWFuIiwgImltcG9ydF9vYnNpZGlhbiIsICJpbXBvcnRfb2JzaWRpYW4iLCAidHlwZSIsICJpbXBvcnRfb2JzaWRpYW4iLCAiaW1wb3J0X29ic2lkaWFuIiwgImltcG9ydF9vYnNpZGlhbiJdCn0K
